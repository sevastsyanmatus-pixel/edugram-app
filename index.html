<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EduGram - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∫—É—Ä—Å–æ–≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #4CAF50;
            --warning: #ff9800;
            --danger: #f44336;
            --dark: #1a1a2e;
            --light: #f5f5f5;
            --gold: #ffd700;
            --bg: #ffffff;
            --text: #333333;
            --card-bg: #ffffff;
            --border: #e0e0e0;
        }

        body.dark-mode {
            --bg: #1a1a2e;
            --text: #ffffff;
            --card-bg: #16213e;
            --light: #16213e;
            --border: #2a2a4a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            background: var(--bg);
            min-height: 100vh;
            position: relative;
            padding-bottom: 80px;
        }

        /* ===== –•–ï–î–ï–† ===== */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .back-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .back-btn.visible {
            display: flex;
        }

        .logo {
            font-size: 22px;
            font-weight: bold;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .header-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s;
        }

        .header-btn:active {
            transform: scale(0.9);
        }

        .user-xp {
            background: rgba(255,255,255,0.2);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .user-xp:hover {
            background: rgba(255,255,255,0.3);
        }

        .user-xp:active {
            transform: scale(0.95);
        }

        .xp-value {
            font-weight: bold;
            color: var(--gold);
        }

        .user-level {
            background: linear-gradient(135deg, var(--gold), #ffed4e);
            color: #333;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

        .streak-badge {
            background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }

        /* ===== –•–ï–î–ï–† –≠–ö–°–ü–ï–†–¢–ê ===== */
        .expert-header-stat {
            background: rgba(255,255,255,0.2);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .expert-header-messages {
            background: rgba(255,255,255,0.2);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 16px;
            cursor: pointer;
            position: relative;
        }

        .messages-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        /* ===== –ë–ê–ù–ù–ï–† –ü–û–î–ü–ò–°–ö–ò ===== */
        .subscription-banner {
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .subscription-banner.trial {
            background: linear-gradient(135deg, var(--warning), #f57c00);
            color: white;
        }

        .subscription-banner.active {
            background: linear-gradient(135deg, var(--success), #388e3c);
            color: white;
        }

        .subscription-banner.expired {
            background: linear-gradient(135deg, var(--danger), #d32f2f);
            color: white;
            animation: pulse-danger 2s infinite;
        }

        @keyframes pulse-danger {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .banner-text {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .banner-btn {
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        /* ===== –†–ï–ñ–ò–ú–´ ===== */
        .mode-switcher {
            display: flex;
            background: var(--light);
            padding: 5px;
            margin: 15px;
            border-radius: 12px;
            gap: 5px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: var(--card-bg);
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* ===== –¢–ê–ë–´ ===== */
        .tabs {
            display: flex;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            scrollbar-width: none;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            flex: 1;
            min-width: 80px;
            padding: 12px 8px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 12px;
            color: #999;
            position: relative;
            white-space: nowrap;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary);
            font-weight: 600;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary);
        }

        /* ===== –ö–ê–†–¢–û–ß–ö–ò –ö–£–†–°–û–í ===== */
        .courses-grid {
            padding: 15px;
            display: grid;
            gap: 15px;
        }

        .course-card {
            background: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: transform 0.2s;
            border: 1px solid var(--border);
        }

        .course-card:active {
            transform: scale(0.98);
        }

        .course-image {
            width: 100%;
            height: 160px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            position: relative;
        }

        .course-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--success);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
        }

        .course-rating {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
        }

        .course-content {
            padding: 15px;
        }

        .course-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .course-author {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .author-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: white;
            font-weight: bold;
        }

        .author-name {
            font-size: 13px;
            color: #666;
        }

        .course-stats {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: #666;
            margin-bottom: 12px;
        }

        .course-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .course-price {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
        }

        .course-price-old {
            font-size: 14px;
            color: #999;
            text-decoration: line-through;
            margin-left: 8px;
        }

        .buy-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .buy-btn:active {
            transform: scale(0.95);
        }

        .buy-btn.purchased {
            background: var(--success);
        }

        /* ===== –ü–†–û–ì–†–ï–°–° –ö–£–†–°–ê ===== */
        .course-progress {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            padding: 15px;
            margin: 15px;
            border-radius: 12px;
        }

        body.dark-mode .course-progress {
            background: linear-gradient(135deg, #1b4332, #2d6a4f);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .progress-title {
            font-weight: 600;
            font-size: 14px;
        }

        .progress-percent {
            font-size: 18px;
            font-weight: bold;
            color: var(--success);
        }

        .progress-bar-full {
            height: 8px;
            background: rgba(255,255,255,0.5);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--success);
            border-radius: 10px;
            transition: width 0.5s;
        }

        /* ===== –í–ò–î–ï–û–ü–õ–ï–ï–† ===== */
        .video-player {
            width: 100%;
            height: 220px;
            background: #000;
            position: relative;
        }

        .video-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
        }

        .play-btn {
            width: 70px;
            height: 70px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin: 0 auto 15px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .play-btn:hover {
            transform: scale(1.1);
        }

        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .video-control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        .progress-bar {
            flex: 1;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 2px;
            width: 0%;
            transition: width 0.1s;
        }

        .video-time {
            color: white;
            font-size: 12px;
            min-width: 80px;
            text-align: right;
        }

        /* ===== –¢–ê–ë–´ –£–†–û–ö–ê ===== */
        .lesson-tabs {
            display: flex;
            gap: 8px;
            padding: 15px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .lesson-tabs::-webkit-scrollbar {
            display: none;
        }

        .lesson-tab {
            padding: 8px 16px;
            background: var(--light);
            border: none;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            white-space: nowrap;
            color: var(--text);
            transition: all 0.2s;
        }

        .lesson-tab.active {
            background: var(--primary);
            color: white;
        }

        /* ===== –£–†–û–ö–ò ===== */
        .lessons-list {
            padding: 0 15px 15px;
        }

        .lesson-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--card-bg);
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }

        .lesson-item:active {
            transform: scale(0.98);
        }

        .lesson-item.completed {
            opacity: 0.7;
        }

        .lesson-item.current {
            border: 2px solid var(--primary);
        }

        .lesson-number {
            width: 36px;
            height: 36px;
            background: var(--light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }

        .lesson-item.completed .lesson-number {
            background: var(--success);
            color: white;
        }

        .lesson-info {
            flex: 1;
        }

        .lesson-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .lesson-duration {
            font-size: 12px;
            color: #666;
        }

        /* ===== –ö–í–ò–ó ===== */
        .quiz-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin: 15px;
            border: 1px solid var(--border);
        }

        .quiz-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .quiz-timer {
            background: var(--danger);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .quiz-question {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .quiz-options {
            display: grid;
            gap: 10px;
        }

        .quiz-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quiz-option:hover {
            border-color: var(--primary);
        }

        .quiz-option.selected {
            border-color: var(--primary);
            background: rgba(102, 126, 234, 0.1);
        }

        .quiz-option.correct {
            border-color: var(--success);
            background: rgba(76, 175, 80, 0.1);
        }

        .quiz-option.wrong {
            border-color: var(--danger);
            background: rgba(244, 67, 54, 0.1);
        }

        .option-letter {
            width: 32px;
            height: 32px;
            background: var(--light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .quiz-option.selected .option-letter {
            background: var(--primary);
            color: white;
        }

        .quiz-submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }

        /* ===== Q&A ===== */
        .qa-section {
            padding: 15px;
        }

        .qa-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .qa-title {
            font-size: 16px;
            font-weight: 600;
        }

        .qa-count {
            background: var(--light);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
        }

        .qa-input-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .qa-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 25px;
            font-size: 14px;
            background: var(--card-bg);
            color: var(--text);
            outline: none;
        }

        .qa-input:focus {
            border-color: var(--primary);
        }

        .qa-send-btn {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        .qa-item {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
        }

        .qa-question {
            display: flex;
            gap: 10px;
        }

        .qa-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 13px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .qa-content {
            flex: 1;
        }

        .qa-author {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .qa-text {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .qa-meta {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #666;
        }

        .qa-meta span {
            cursor: pointer;
        }

        .qa-meta span:hover {
            color: var(--primary);
        }

        .qa-answer {
            background: var(--light);
            border-radius: 10px;
            padding: 12px;
            margin: 12px 0 0 46px;
        }

        .expert-badge {
            background: var(--success);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            margin-left: 8px;
        }

        /* ===== –û–¢–ó–´–í–´ ===== */
        .reviews-section {
            padding: 15px;
        }

        .reviews-summary {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .rating-big {
            font-size: 48px;
            font-weight: bold;
        }

        .rating-stars {
            font-size: 24px;
            margin: 10px 0;
        }

        .rating-count {
            font-size: 14px;
            color: #666;
        }

        .rating-bars {
            margin-top: 15px;
            text-align: left;
        }

        .rating-bar-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .rating-bar-label {
            width: 20px;
            font-size: 12px;
            text-align: center;
        }

        .rating-bar-track {
            flex: 1;
            height: 6px;
            background: var(--light);
            border-radius: 3px;
        }

        .rating-bar-fill {
            height: 100%;
            background: var(--gold);
            border-radius: 3px;
        }

        .review-item {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .review-author-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .review-stars {
            color: var(--gold);
            font-size: 14px;
        }

        .add-review-btn {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        /* ===== –ó–ê–ú–ï–¢–ö–ò ===== */
        .notes-section {
            padding: 15px;
        }

        .note-item {
            background: #fffde7;
            border-left: 4px solid var(--gold);
            padding: 12px;
            border-radius: 0 10px 10px 0;
            margin-bottom: 10px;
        }

        body.dark-mode .note-item {
            background: #3d3d00;
        }

        .note-timestamp {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .note-timestamp span {
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
        }

        .note-text {
            font-size: 14px;
            line-height: 1.5;
        }

        .note-actions {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }

        .note-action-btn {
            background: none;
            border: none;
            color: #666;
            font-size: 12px;
            cursor: pointer;
        }

        .add-note-fab {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--gold), #ffed4e);
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 50;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .add-note-fab.visible {
            display: flex;
        }

        /* ===== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ===== */
        .stats-section {
            padding: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .stat-card:active {
            transform: scale(0.98);
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .achievements-section {
            margin-top: 20px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
        }

        .see-all-btn {
            color: var(--primary);
            font-size: 14px;
            cursor: pointer;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .achievement-item {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px 8px;
            text-align: center;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }

        .achievement-item:active {
            transform: scale(0.95);
        }

        .achievement-item.locked {
            opacity: 0.4;
        }

        .achievement-item.unlocked {
            background: linear-gradient(135deg, #fff9e6, #ffecb3);
            border-color: var(--gold);
        }

        body.dark-mode .achievement-item.unlocked {
            background: linear-gradient(135deg, #3d3d00, #4a4a00);
        }

        .achievement-icon {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .achievement-name {
            font-size: 10px;
            color: #666;
        }

        /* ===== –ü–ê–ù–ï–õ–¨ –≠–ö–°–ü–ï–†–¢–ê ===== */
        .expert-dashboard {
            padding: 15px;
        }

        .subscription-card {
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .subscription-card.trial {
            background: linear-gradient(135deg, var(--warning), #f57c00);
            color: white;
        }

        .subscription-card.active {
            background: linear-gradient(135deg, var(--success), #388E3C);
            color: white;
        }

        .subscription-card.expired {
            background: linear-gradient(135deg, var(--danger), #d32f2f);
            color: white;
        }

        .subscription-card::after {
            content: 'üëë';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 40px;
            opacity: 0.3;
        }

        .sub-status {
            font-size: 12px;
            opacity: 0.9;
        }

        .sub-value {
            font-size: 20px;
            font-weight: bold;
            margin: 5px 0;
        }

        .sub-btn {
            background: rgba(255,255,255,0.3);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        .expert-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .expert-stat {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 12px;
            padding: 15px 10px;
            text-align: center;
        }

        .expert-stat-value {
            font-size: 20px;
            font-weight: bold;
        }

        .expert-stat-label {
            font-size: 10px;
            opacity: 0.9;
        }

        .create-course-btn {
            width: 100%;
            padding: 15px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        .create-course-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .my-courses-list {
            background: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .my-course-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }

        .my-course-item:last-child {
            border-bottom: none;
        }

        .my-course-thumb {
            width: 50px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .my-course-info {
            flex: 1;
        }

        .my-course-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .my-course-stats {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: #666;
        }

        .share-link-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* ===== –ü–†–û–ú–û–ö–û–î–´ ===== */
        .promo-section {
            padding: 15px;
        }

        .promo-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .promo-code {
            font-family: monospace;
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
        }

        .promo-info {
            flex: 1;
            margin-left: 15px;
        }

        .promo-discount {
            background: var(--success);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .promo-uses {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .create-promo-btn {
            width: 100%;
            padding: 15px;
            background: var(--light);
            border: 2px dashed var(--border);
            border-radius: 12px;
            color: #666;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        /* ===== –ê–ù–ê–õ–ò–¢–ò–ö–ê ===== */
        .analytics-section {
            padding: 15px;
        }

        .chart-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
        }

        .chart-period {
            background: var(--light);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            border: none;
            cursor: pointer;
            color: var(--text);
        }

        .chart-bars {
            display: flex;
            align-items: flex-end;
            gap: 8px;
            height: 100px;
        }

        .chart-bar {
            flex: 1;
            background: linear-gradient(to top, var(--primary), var(--secondary));
            border-radius: 4px 4px 0 0;
            min-height: 10px;
            transition: height 0.3s;
        }

        .chart-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 11px;
            color: #666;
        }

        .metric-big {
            text-align: center;
            padding: 20px;
        }

        .metric-value {
            font-size: 48px;
            font-weight: bold;
            color: var(--success);
        }

        .metric-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .metric-change {
            color: var(--success);
            font-size: 14px;
            margin-top: 10px;
        }

        /* ===== –ù–ò–ñ–ù–Ø–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            display: flex;
            padding: 8px;
            z-index: 100;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            padding: 8px 4px;
            background: transparent;
            border: none;
            cursor: pointer;
            color: #999;
            font-size: 10px;
            transition: all 0.2s;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-icon {
            font-size: 20px;
        }

        /* ===== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ===== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
        }

        .modal-close {
            background: var(--light);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-body {
            padding: 20px;
        }

        /* ===== –ú–û–î–ê–õ–ö–ê –î–û–°–¢–ò–ñ–ï–ù–ò–ô ===== */
        .achievements-modal-header {
            background: linear-gradient(135deg, var(--gold), #ffed4e);
            padding: 25px;
            text-align: center;
            border-radius: 20px 20px 0 0;
        }

        .achievements-modal-header h2 {
            font-size: 24px;
            margin-bottom: 5px;
            color: #333;
        }

        .xp-display {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
        }

        .xp-item {
            text-align: center;
        }

        .xp-item-value {
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }

        .xp-item-label {
            font-size: 12px;
            color: #666;
        }

        .level-progress {
            margin-top: 20px;
            background: rgba(0,0,0,0.1);
            height: 8px;
            border-radius: 10px;
            overflow: hidden;
        }

        .level-progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 10px;
        }

        .level-text {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
        }

        .achievements-list {
            padding: 20px;
        }

        .achievement-category {
            margin-bottom: 20px;
        }

        .category-title {
            font-size: 14px;
            font-weight: 600;
            color: #666;
            margin-bottom: 10px;
        }

        .achievement-full {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--light);
            border-radius: 12px;
            margin-bottom: 8px;
        }

        .achievement-full.unlocked {
            background: linear-gradient(135deg, #fff9e6, #ffecb3);
        }

        body.dark-mode .achievement-full.unlocked {
            background: linear-gradient(135deg, #3d3d00, #4a4a00);
        }

        .achievement-full .achievement-icon {
            font-size: 32px;
            margin: 0;
        }

        .achievement-full.locked .achievement-icon {
            filter: grayscale(100%);
            opacity: 0.3;
        }

        .achievement-details {
            flex: 1;
        }

        .achievement-full-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .achievement-desc {
            font-size: 12px;
            color: #666;
        }

        .achievement-xp {
            background: var(--primary);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        /* ===== –ú–û–î–ê–õ–ö–ê –ü–û–î–ü–ò–°–ö–ò ===== */
        .pricing-header {
            background: linear-gradient(135deg, var(--gold), #ffed4e);
            padding: 30px 20px;
            text-align: center;
            border-radius: 20px 20px 0 0;
            position: relative;
        }

        .pricing-header::before {
            content: 'üëë';
            font-size: 50px;
            display: block;
            margin-bottom: 10px;
        }

        .pricing-header h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 5px;
        }

        .pricing-header p {
            font-size: 14px;
            color: #666;
        }

        .trial-info {
            background: white;
            margin: -15px 20px 0;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .trial-days {
            font-size: 48px;
            font-weight: bold;
            color: var(--primary);
        }

        .trial-label {
            font-size: 14px;
            color: #666;
        }

        .trial-progress {
            height: 6px;
            background: #eee;
            border-radius: 10px;
            margin-top: 15px;
            overflow: hidden;
        }

        .trial-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--warning), var(--danger));
            border-radius: 10px;
        }

        .pricing-plans {
            padding: 20px;
        }

        .plan-card {
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .plan-card:hover {
            border-color: var(--primary);
        }

        .plan-card.selected {
            border-color: var(--primary);
            background: rgba(102, 126, 234, 0.05);
        }

        .plan-card.popular {
            border-color: var(--gold);
            background: linear-gradient(135deg, #fffef0, #fff9e6);
        }

        .plan-card.popular::before {
            content: 'üî• –í–´–ì–û–î–ù–û';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--gold), #ffed4e);
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
        }

        .plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .plan-name {
            font-size: 16px;
            font-weight: 600;
        }

        .plan-badge {
            background: var(--success);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
        }

        .plan-price {
            margin-bottom: 10px;
        }

        .plan-price-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
        }

        .plan-price-old {
            font-size: 16px;
            color: #999;
            text-decoration: line-through;
            margin-left: 10px;
        }

        .plan-price-period {
            font-size: 14px;
            color: #666;
        }

        .plan-features {
            list-style: none;
            padding: 0;
        }

        .plan-features li {
            padding: 6px 0;
            font-size: 13px;
            color: #666;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .plan-features li::before {
            content: '‚úì';
            color: var(--success);
            font-weight: bold;
        }

        .subscribe-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        .payment-methods {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 15px;
            font-size: 24px;
            border-top: 1px solid var(--border);
        }

        .payment-note {
            text-align: center;
            font-size: 12px;
            color: #999;
            padding: 0 20px 20px;
        }

        /* ===== –ú–û–î–ê–õ–ö–ê –°–û–û–ë–©–ï–ù–ò–ô ===== */
        .messages-list {
            padding: 0;
        }

        .message-item {
            display: flex;
            gap: 12px;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.2s;
        }

        .message-item:hover {
            background: var(--light);
        }

        .message-item.unread {
            background: rgba(102, 126, 234, 0.05);
        }

        .message-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .message-content {
            flex: 1;
            min-width: 0;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .message-sender {
            font-weight: 600;
            font-size: 14px;
        }

        .message-time {
            font-size: 11px;
            color: #999;
        }

        .message-preview {
            font-size: 13px;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .message-course {
            font-size: 11px;
            color: var(--primary);
            margin-top: 4px;
        }

        .unread-dot {
            width: 10px;
            height: 10px;
            background: var(--primary);
            border-radius: 50%;
            flex-shrink: 0;
            align-self: center;
        }

        /* ===== –ú–û–î–ê–õ–ö–ê –£–ß–ï–ù–ò–ö–û–í ===== */
        .students-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .students-stat {
            text-align: center;
            color: white;
        }

        .students-stat-value {
            font-size: 24px;
            font-weight: bold;
        }

        .students-stat-label {
            font-size: 11px;
            opacity: 0.9;
        }

        .student-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
        }

        .student-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .student-info {
            flex: 1;
        }

        .student-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .student-course {
            font-size: 12px;
            color: #666;
        }

        .student-progress {
            text-align: right;
        }

        .student-progress-value {
            font-weight: bold;
            color: var(--success);
        }

        .student-progress-label {
            font-size: 11px;
            color: #666;
        }

        /* ===== –ß–ê–¢ ===== */
        .chat-modal-content {
            display: flex;
            flex-direction: column;
            height: 80vh;
            max-height: 600px;
        }

        .chat-header {
            padding: 15px 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
            border-radius: 20px 20px 0 0;
        }

        .chat-user-info {
            flex: 1;
        }

        .chat-user-name {
            font-weight: 600;
            font-size: 16px;
        }

        .chat-user-status {
            font-size: 12px;
            opacity: 0.8;
        }

        .chat-messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: var(--bg);
        }

        .chat-message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }

        .chat-message.incoming {
            align-self: flex-start;
            background: var(--light);
            border-bottom-left-radius: 4px;
        }

        .chat-message.outgoing {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-bottom-right-radius: 4px;
        }

        .chat-message-time {
            font-size: 10px;
            opacity: 0.7;
            margin-top: 4px;
        }

        .chat-input-container {
            padding: 15px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
            background: var(--card-bg);
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            background: var(--bg);
            color: var(--text);
        }

        .chat-input:focus {
            border-color: var(--primary);
        }

        .chat-send-btn {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        /* ===== –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø ===== */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 5000;
            padding: 20px;
        }

        .auth-screen.hidden {
            display: none;
        }

        .auth-logo {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .auth-title {
            font-size: 32px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }

        .auth-subtitle {
            font-size: 16px;
            color: rgba(255,255,255,0.8);
            margin-bottom: 40px;
            text-align: center;
        }

        .auth-card {
            background: white;
            border-radius: 24px;
            padding: 30px;
            width: 100%;
            max-width: 380px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .auth-tabs {
            display: flex;
            background: var(--light);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 25px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            color: #666;
            transition: all 0.3s;
        }

        .auth-tab.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-input-group {
            margin-bottom: 15px;
        }

        .auth-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .auth-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            transition: border-color 0.3s;
        }

        .auth-input:focus {
            border-color: var(--primary);
            outline: none;
        }

        .auth-role-select {
            display: flex;
            gap: 10px;
            margin: 15px 0 20px;
        }

        .auth-role {
            flex: 1;
            padding: 20px 15px;
            border: 2px solid var(--border);
            border-radius: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .auth-role:hover {
            border-color: var(--primary);
        }

        .auth-role.selected {
            border-color: var(--primary);
            background: rgba(102, 126, 234, 0.05);
        }

        .auth-role-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .auth-role-name {
            font-weight: 600;
            font-size: 14px;
        }

        .auth-role-desc {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
        }

        .auth-submit {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: transform 0.2s;
        }

        .auth-submit:hover {
            transform: translateY(-2px);
        }

        .auth-submit:active {
            transform: scale(0.98);
        }

        .auth-divider {
            display: flex;
            align-items: center;
            margin: 25px 0;
            color: #999;
            font-size: 13px;
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        .auth-divider span {
            padding: 0 15px;
        }

        .auth-telegram-btn {
            width: 100%;
            padding: 14px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .auth-footer {
            text-align: center;
            margin-top: 20px;
            font-size: 13px;
            color: #666;
        }

        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        /* ===== –°–ï–†–¢–ò–§–ò–ö–ê–¢ ===== */
        .certificate {
            background: linear-gradient(135deg, #fffef0, #fff9e6);
            border: 6px solid var(--gold);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .certificate-seal {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 50px;
            background: var(--gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .certificate-title {
            font-size: 24px;
            font-weight: bold;
            margin-top: 15px;
            color: #333;
        }

        .certificate-subtitle {
            color: #666;
            margin: 5px 0 20px;
        }

        .certificate-name {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary);
            font-family: Georgia, serif;
            margin: 15px 0;
        }

        .certificate-course {
            font-size: 16px;
            color: #333;
            line-height: 1.5;
        }

        .certificate-date {
            font-size: 14px;
            color: #666;
            margin-top: 20px;
        }

        .certificate-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .cert-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }

        .cert-btn.download {
            background: var(--primary);
            color: white;
        }

        .cert-btn.share {
            background: var(--light);
            color: #333;
        }

        /* ===== REVIEW MODAL ===== */
        .review-form {
            padding: 20px;
        }

        .rating-select {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .rating-star {
            font-size: 36px;
            cursor: pointer;
            transition: transform 0.2s;
            filter: grayscale(100%);
        }

        .rating-star:hover {
            transform: scale(1.2);
        }

        .rating-star.selected {
            filter: none;
        }

        .review-textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 14px;
            resize: none;
            background: var(--card-bg);
            color: var(--text);
        }

        .review-textarea:focus {
            border-color: var(--primary);
            outline: none;
        }

        .submit-review-btn {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
        }

        /* ===== PROMO MODAL ===== */
        .promo-form {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            background: var(--card-bg);
            color: var(--text);
        }

        .form-input:focus {
            border-color: var(--primary);
            outline: none;
        }

        .discount-options {
            display: flex;
            gap: 10px;
        }

        .discount-option {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .discount-option.selected {
            border-color: var(--primary);
            background: rgba(102, 126, 234, 0.1);
            color: var(--primary);
        }

        /* ===== TOAST ===== */
        .toast {
            position: fixed;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card-bg);
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 3000;
            transition: top 0.3s;
            max-width: 90%;
            border: 1px solid var(--border);
        }

        .toast.show {
            top: 20px;
        }

        .toast-icon {
            font-size: 20px;
        }

        .toast-text {
            font-size: 14px;
        }

        /* ===== SUCCESS OVERLAY ===== */
        .success-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(76, 175, 80, 0.95);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            color: white;
            text-align: center;
        }

        .success-overlay.active {
            display: flex;
        }

        .success-checkmark {
            font-size: 80px;
            animation: bounceIn 0.6s;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .success-title {
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0 10px;
        }

        .success-text {
            font-size: 16px;
            opacity: 0.9;
        }

        /* ===== BLOCKED OVERLAY ===== */
        .blocked-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.95);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 50;
            padding: 40px;
            text-align: center;
        }

        body.dark-mode .blocked-overlay {
            background: rgba(26, 26, 46, 0.95);
        }

        .blocked-overlay.active {
            display: flex;
        }

        .blocked-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .blocked-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .blocked-text {
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .blocked-btn {
            background: linear-gradient(135deg, var(--gold), #ffed4e);
            color: #333;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        /* ===== –°–¢–†–ê–ù–ò–¶–´ ===== */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }
    </style>
</head>
<body>

<!-- –≠–ö–†–ê–ù –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò -->
<div class="auth-screen" id="authScreen">
    <div class="auth-logo">üìö</div>
    <div class="auth-title">EduGram</div>
    <div class="auth-subtitle">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –∏ —É—á–µ–Ω–∏–∫–æ–≤</div>
    
    <div class="auth-card">
        <div class="auth-tabs">
            <button class="auth-tab active" onclick="switchAuthTab('login')">–í—Ö–æ–¥</button>
            <button class="auth-tab" onclick="switchAuthTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>
        
        <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
        <div class="auth-form active" id="loginForm">
            <div class="auth-input-group">
                <label class="auth-label">Email</label>
                <input type="email" class="auth-input" id="loginEmail" placeholder="email@example.com">
            </div>
            <div class="auth-input-group">
                <label class="auth-label">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" class="auth-input" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button class="auth-submit" onclick="handleLogin()">–í–æ–π—Ç–∏</button>
            
            <div class="auth-divider"><span>–∏–ª–∏</span></div>
            
            <button class="auth-telegram-btn" onclick="loginWithTelegram()">
                <span>üì±</span> –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram
            </button>
        </div>
        
        <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
        <div class="auth-form" id="registerForm">
            <div class="auth-input-group">
                <label class="auth-label">–í–∞—à–µ –∏–º—è</label>
                <input type="text" class="auth-input" id="registerName" placeholder="–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤">
            </div>
            <div class="auth-input-group">
                <label class="auth-label">Email</label>
                <input type="email" class="auth-input" id="registerEmail" placeholder="email@example.com">
            </div>
            <div class="auth-input-group">
                <label class="auth-label">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" class="auth-input" id="registerPassword" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤">
            </div>
            
            <label class="auth-label">–Ø —Ö–æ—á—É:</label>
            <div class="auth-role-select">
                <div class="auth-role selected" onclick="selectAuthRole('student', this)">
                    <div class="auth-role-icon">üéì</div>
                    <div class="auth-role-name">–£—á–∏—Ç—å—Å—è</div>
                    <div class="auth-role-desc">–ü–æ–∫—É–ø–∞—Ç—å –∫—É—Ä—Å—ã</div>
                </div>
                <div class="auth-role" onclick="selectAuthRole('expert', this)">
                    <div class="auth-role-icon">üë®‚Äçüè´</div>
                    <div class="auth-role-name">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç—å</div>
                    <div class="auth-role-desc">–ü—Ä–æ–¥–∞–≤–∞—Ç—å –∫—É—Ä—Å—ã</div>
                </div>
            </div>
            
            <button class="auth-submit" onclick="handleRegister()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
            
            <div class="auth-divider"><span>–∏–ª–∏</span></div>
            
            <button class="auth-telegram-btn" onclick="loginWithTelegram()">
                <span>üì±</span> –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
            </button>
        </div>
        
        <div class="auth-footer">
            –ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å <a href="#">—É—Å–ª–æ–≤–∏—è–º–∏</a>
        </div>
    </div>
</div>

<div class="container">
    <!-- –•–ï–î–ï–† -->
    <header>
        <div class="header-top">
            <div class="header-left">
                <button class="back-btn" id="backBtn" onclick="goBack()">‚Üê</button>
                <div class="logo" id="headerTitle">üìö EduGram</div>
            </div>
            
            <!-- –•–µ–¥–µ—Ä –¥–ª—è –£–ß–ï–ù–ò–ö–ê -->
            <div class="header-actions" id="headerStudent">
                <div class="streak-badge" onclick="showStreakInfo()">
                    üî• <span id="streakCount">7</span>
                </div>
                <div class="user-xp" onclick="showAchievementsModal()">
                    üèÜ <span class="xp-value" id="userXP">1,250</span>
                    <span class="user-level" id="userLevel">LVL 5</span>
                </div>
                <button class="header-btn" onclick="toggleDarkMode()">üåô</button>
            </div>
            
            <!-- –•–µ–¥–µ—Ä –¥–ª—è –≠–ö–°–ü–ï–†–¢–ê -->
            <div class="header-actions" id="headerExpert" style="display: none;">
                <div class="expert-header-stat" onclick="showStudentsModal()">
                    üë• <span id="headerStudentsCount">234</span>
                </div>
                <div class="expert-header-messages" onclick="showMessagesModal()">
                    üí¨
                    <span class="messages-badge" id="messagesBadge">5</span>
                </div>
                <button class="header-btn" onclick="toggleDarkMode()">üåô</button>
            </div>
        </div>
    </header>

    <!-- –ë–ê–ù–ù–ï–† –ü–û–î–ü–ò–°–ö–ò -->
    <div class="subscription-banner trial" id="subBanner" style="display: none;" onclick="showSubscriptionModal()">
        <div class="banner-text">
            <span>‚è∞</span>
            <span id="bannerText">–ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥: 10 –¥–Ω–µ–π</span>
        </div>
        <button class="banner-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
    </div>

    <!-- ===== –ì–õ–ê–í–ù–ê–Ø –°–¢–†–ê–ù–ò–¶–ê ===== -->
    <div id="mainPage" class="page active">
        <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–æ–≤ -->
        <div class="mode-switcher">
            <button class="mode-btn active" id="studentModeBtn" onclick="switchMode('student')">üéì –£—á–µ–Ω–∏–∫</button>
            <button class="mode-btn" id="expertModeBtn" onclick="switchMode('expert')">üë®‚Äçüè´ –≠–∫—Å–ø–µ—Ä—Ç</button>
        </div>

        <!-- === –†–ï–ñ–ò–ú –£–ß–ï–ù–ò–ö–ê === -->
        <div id="studentMode">
            <div class="tabs">
                <button class="tab active" onclick="switchStudentTab('catalog')">üè™ –ö–∞—Ç–∞–ª–æ–≥</button>
                <button class="tab" onclick="switchStudentTab('myCourses')">üìö –ú–æ–∏ –∫—É—Ä—Å—ã</button>
                <button class="tab" onclick="switchStudentTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            </div>

            <div id="catalogTab" class="tab-content">
                <div class="courses-grid" id="catalogCourses"></div>
            </div>

            <div id="myCoursesTab" class="tab-content" style="display: none;">
                <div class="courses-grid" id="purchasedCourses">
                    <p style="text-align: center; color: #666; padding: 40px;">
                        –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫—É—Ä—Å–æ–≤.<br>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–∞—Ç–∞–ª–æ–≥!
                    </p>
                </div>
            </div>

            <div id="statsTab" class="tab-content" style="display: none;">
                <div class="stats-section">
                    <div class="stats-grid">
                        <div class="stat-card" onclick="showAchievementsModal()">
                            <div class="stat-icon">üèÜ</div>
                            <div class="stat-value" id="statXP">1,250</div>
                            <div class="stat-label">–û—á–∫–∏ XP</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìö</div>
                            <div class="stat-value" id="statCourses">0</div>
                            <div class="stat-label">–ö—É—Ä—Å–æ–≤</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚è±</div>
                            <div class="stat-value">12—á</div>
                            <div class="stat-label">–í—Ä–µ–º–µ–Ω–∏</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üî•</div>
                            <div class="stat-value" id="statStreak">7</div>
                            <div class="stat-label">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
                        </div>
                    </div>
                    <div class="achievements-section">
                        <div class="section-header">
                            <span class="section-title">üèÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</span>
                            <span class="see-all-btn" onclick="showAchievementsModal()">–í—Å–µ ‚Üí</span>
                        </div>
                        <div class="achievements-grid" id="achievementsPreview"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- === –†–ï–ñ–ò–ú –≠–ö–°–ü–ï–†–¢–ê === -->
        <div id="expertMode" style="display: none; position: relative;">
            <div class="blocked-overlay" id="blockedOverlay">
                <div class="blocked-icon">üîí</div>
                <div class="blocked-title">–ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞</div>
                <div class="blocked-text">–ü—Ä–æ–¥–ª–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤</div>
                <button class="blocked-btn" onclick="showSubscriptionModal()">üëë –ü—Ä–æ–¥–ª–∏—Ç—å</button>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchExpertTab('dashboard')">üìä –ü–∞–Ω–µ–ª—å</button>
                <button class="tab" onclick="switchExpertTab('myCourses')">üìö –ö—É—Ä—Å—ã</button>
                <button class="tab" onclick="switchExpertTab('promo')">üè∑Ô∏è –ü—Ä–æ–º–æ</button>
                <button class="tab" onclick="switchExpertTab('analytics')">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
            </div>

            <div id="dashboardTab" class="expert-tab-content">
                <div class="expert-dashboard">
                    <div class="subscription-card trial" id="subCard" onclick="showSubscriptionModal()">
                        <div class="sub-status">–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏</div>
                        <div class="sub-value" id="subStatus">–ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥: 10 –¥–Ω–µ–π</div>
                        <button class="sub-btn">–£–ª—É—á—à–∏—Ç—å –ø–ª–∞–Ω ‚Üí</button>
                    </div>

                    <div class="expert-stats">
                        <div class="expert-stat">
                            <div class="expert-stat-value">45.6K ‚≠ê</div>
                            <div class="expert-stat-label">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                        </div>
                        <div class="expert-stat">
                            <div class="expert-stat-value" id="expertStudentsCount">234</div>
                            <div class="expert-stat-label">–£—á–µ–Ω–∏–∫–æ–≤</div>
                        </div>
                        <div class="expert-stat">
                            <div class="expert-stat-value" id="expertCoursesCount">2</div>
                            <div class="expert-stat-label">–ö—É—Ä—Å–æ–≤</div>
                        </div>
                    </div>

                    <button class="create-course-btn" id="createCourseBtn" onclick="createCourse()">
                        ‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫—É—Ä—Å
                    </button>

                    <div class="section-header">
                        <span class="section-title">üìö –ú–æ–∏ –∫—É—Ä—Å—ã</span>
                    </div>
                    <div class="my-courses-list" id="expertCoursesList"></div>
                </div>
            </div>

            <div id="myCoursesExpertTab" class="expert-tab-content" style="display: none;">
                <div style="padding: 15px;">
                    <button class="create-course-btn" onclick="createCourse()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—Å</button>
                    <div id="expertCoursesFullList"></div>
                </div>
            </div>

            <div id="promoTab" class="expert-tab-content" style="display: none;">
                <div class="promo-section">
                    <div class="section-header">
                        <span class="section-title">üè∑Ô∏è –ü—Ä–æ–º–æ–∫–æ–¥—ã</span>
                    </div>
                    <div id="promoList"></div>
                    <button class="create-promo-btn" onclick="showCreatePromoModal()">‚ûï –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
                </div>
            </div>

            <div id="analyticsTab" class="expert-tab-content" style="display: none;">
                <div class="analytics-section">
                    <div class="chart-card">
                        <div class="chart-header">
                            <span class="chart-title">üí∞ –ü—Ä–æ–¥–∞–∂–∏</span>
                            <select class="chart-period">
                                <option>7 –¥–Ω–µ–π</option>
                                <option>30 –¥–Ω–µ–π</option>
                            </select>
                        </div>
                        <div class="chart-bars">
                            <div class="chart-bar" style="height: 40%;"></div>
                            <div class="chart-bar" style="height: 65%;"></div>
                            <div class="chart-bar" style="height: 45%;"></div>
                            <div class="chart-bar" style="height: 80%;"></div>
                            <div class="chart-bar" style="height: 55%;"></div>
                            <div class="chart-bar" style="height: 90%;"></div>
                            <div class="chart-bar" style="height: 100%;"></div>
                        </div>
                        <div class="chart-labels">
                            <span>–ü–Ω</span><span>–í—Ç</span><span>–°—Ä</span><span>–ß—Ç</span><span>–ü—Ç</span><span>–°–±</span><span>–í—Å</span>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <span class="chart-title">üìä –ö–æ–Ω–≤–µ—Ä—Å–∏—è</span>
                        </div>
                        <div class="metric-big">
                            <div class="metric-value">12.4%</div>
                            <div class="metric-label">–∏–∑ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –≤ –ø–æ–∫—É–ø–∫–∏</div>
                            <div class="metric-change">‚Üë 2.3% –∑–∞ –Ω–µ–¥–µ–ª—é</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== –°–¢–†–ê–ù–ò–¶–ê –ö–£–†–°–ê ===== -->
    <div id="coursePage" class="page">
        <div class="video-player">
            <div class="video-placeholder" id="videoPlaceholder">
                <div class="play-btn" onclick="toggleVideo()">‚ñ∂Ô∏è</div>
                <div id="currentLessonTitle">–£—Ä–æ–∫ 1: –í–≤–µ–¥–µ–Ω–∏–µ</div>
            </div>
            <div class="video-controls">
                <button class="video-control-btn" id="playPauseBtn" onclick="toggleVideo()">‚ñ∂Ô∏è</button>
                <div class="progress-bar" onclick="seekVideo(event)">
                    <div class="progress-fill" id="videoProgress"></div>
                </div>
                <span class="video-time" id="videoTime">00:00 / 15:30</span>
            </div>
        </div>

        <div class="course-progress">
            <div class="progress-header">
                <span class="progress-title">üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –∫—É—Ä—Å–∞</span>
                <span class="progress-percent" id="courseProgressPercent">0%</span>
            </div>
            <div class="progress-bar-full">
                <div class="progress-bar-fill" id="courseProgressBar" style="width: 0%;"></div>
            </div>
        </div>

        <div class="lesson-tabs">
            <button class="lesson-tab active" onclick="switchLessonTab('lessons')">üìö –£—Ä–æ–∫–∏</button>
            <button class="lesson-tab" onclick="switchLessonTab('quiz')">üìù –¢–µ—Å—Ç</button>
            <button class="lesson-tab" onclick="switchLessonTab('qa')">‚ùì Q&A</button>
            <button class="lesson-tab" onclick="switchLessonTab('reviews')">‚≠ê –û—Ç–∑—ã–≤—ã</button>
            <button class="lesson-tab" onclick="switchLessonTab('notes')">üìå –ó–∞–º–µ—Ç–∫–∏</button>
        </div>

        <div id="lessonsContent" class="lesson-content">
            <div class="lessons-list" id="lessonsList"></div>
        </div>

        <div id="quizContent" class="lesson-content" style="display: none;">
            <div class="quiz-card">
                <div class="quiz-progress-header">
                    <span>–í–æ–ø—Ä–æ—Å <span id="quizQuestionNum">1</span>/5</span>
                    <span class="quiz-timer">‚è± 00:30</span>
                </div>
                <div class="quiz-question" id="quizQuestion"></div>
                <div class="quiz-options" id="quizOptions"></div>
                <button class="quiz-submit-btn" onclick="submitQuizAnswer()">–û—Ç–≤–µ—Ç–∏—Ç—å ‚Üí</button>
            </div>
        </div>

        <div id="qaContent" class="lesson-content" style="display: none;">
            <div class="qa-section">
                <div class="qa-header">
                    <span class="qa-title">‚ùì –í–æ–ø—Ä–æ—Å—ã</span>
                    <span class="qa-count" id="qaCount">24</span>
                </div>
                <div class="qa-input-box">
                    <input type="text" class="qa-input" placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å..." id="qaInput">
                    <button class="qa-send-btn" onclick="sendQuestion()">‚û§</button>
                </div>
                <div id="qaList"></div>
            </div>
        </div>

        <div id="reviewsContent" class="lesson-content" style="display: none;">
            <div class="reviews-section">
                <div class="reviews-summary">
                    <div class="rating-big">4.8</div>
                    <div class="rating-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    <div class="rating-count">234 –æ—Ç–∑—ã–≤–∞</div>
                </div>
                <div id="reviewsList"></div>
                <button class="add-review-btn" onclick="showReviewModal()">‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –æ—Ç–∑—ã–≤</button>
            </div>
        </div>

        <div id="notesContent" class="lesson-content" style="display: none;">
            <div class="notes-section">
                <div id="notesList"></div>
            </div>
        </div>

        <button class="add-note-fab" id="addNoteFab" onclick="showAddNoteModal()">üìù</button>
    </div>

    <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
    <div class="bottom-nav">
        <button class="nav-item active" onclick="navigateTo('home')">
            <span class="nav-icon">üè†</span>
            <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </button>
        <button class="nav-item" onclick="showSearch()">
            <span class="nav-icon">üîç</span>
            <span>–ü–æ–∏—Å–∫</span>
        </button>
        <button class="nav-item" onclick="showAchievementsModal()">
            <span class="nav-icon">üèÜ</span>
            <span>–ù–∞–≥—Ä–∞–¥—ã</span>
        </button>
        <button class="nav-item" onclick="showProfile()">
            <span class="nav-icon">üë§</span>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </button>
    </div>
</div>

<!-- ===== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ===== -->

<!-- –ú–æ–¥–∞–ª–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π -->
<div class="modal" id="achievementsModal" onclick="closeModalOnBackdrop(event, 'achievementsModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="achievements-modal-header">
            <h2>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
            <div class="xp-display">
                <div class="xp-item">
                    <div class="xp-item-value" id="modalXP">1,250</div>
                    <div class="xp-item-label">XP</div>
                </div>
                <div class="xp-item">
                    <div class="xp-item-value" id="modalLevel">5</div>
                    <div class="xp-item-label">–£—Ä–æ–≤–µ–Ω—å</div>
                </div>
                <div class="xp-item">
                    <div class="xp-item-value" id="modalAchievements">4</div>
                    <div class="xp-item-label">–ù–∞–≥—Ä–∞–¥—ã</div>
                </div>
            </div>
            <div class="level-progress">
                <div class="level-progress-fill" id="levelProgressFill" style="width: 60%;"></div>
            </div>
            <div class="level-text">250 XP –¥–æ —É—Ä–æ–≤–Ω—è 6</div>
        </div>
        <div class="achievements-list" id="achievementsList"></div>
        <div style="padding: 0 20px 20px;">
            <button class="add-review-btn" onclick="closeModal('achievementsModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ -->
<div class="modal" id="subscriptionModal" onclick="closeModalOnBackdrop(event, 'subscriptionModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="pricing-header">
            <h2>EduGram PRO</h2>
            <p>–†–∞–∑–º–µ—â–∞–π—Ç–µ –∫—É—Ä—Å—ã –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π</p>
        </div>
        <div class="trial-info">
            <div class="trial-days" id="trialDays">10</div>
            <div class="trial-label">–¥–Ω–µ–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ</div>
            <div class="trial-progress">
                <div class="trial-progress-fill" id="trialProgressFill" style="width: 100%;"></div>
            </div>
        </div>
        <div class="pricing-plans">
            <div class="plan-card" onclick="selectPlan('month')">
                <div class="plan-header">
                    <span class="plan-name">üìÖ 1 –º–µ—Å—è—Ü</span>
                </div>
                <div class="plan-price">
                    <span class="plan-price-value">990 ‚ÇΩ</span>
                    <div class="plan-price-period">990 ‚ÇΩ/–º–µ—Å</div>
                </div>
                <ul class="plan-features">
                    <li>–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –∫—É—Ä—Å—ã</li>
                    <li>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</li>
                    <li>–ü—Ä–æ–º–æ–∫–æ–¥—ã</li>
                </ul>
            </div>
            <div class="plan-card popular selected" onclick="selectPlan('year')">
                <div class="plan-header">
                    <span class="plan-name">üéâ 12 –º–µ—Å—è—Ü–µ–≤</span>
                    <span class="plan-badge">-40%</span>
                </div>
                <div class="plan-price">
                    <span class="plan-price-value">7,128 ‚ÇΩ</span>
                    <span class="plan-price-old">11,880 ‚ÇΩ</span>
                    <div class="plan-price-period">594 ‚ÇΩ/–º–µ—Å</div>
                </div>
                <ul class="plan-features">
                    <li>–í—Å–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞</li>
                    <li>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä</li>
                    <li>–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤</li>
                </ul>
            </div>
            <button class="subscribe-btn" onclick="processPayment()">
                üí≥ –û–ø–ª–∞—Ç–∏—Ç—å <span id="selectedPlanPrice">7,128 ‚ÇΩ</span>
            </button>
        </div>
        <div class="payment-methods">üí≥ üè¶ üíé ‚≠ê</div>
        <div class="payment-note">üîí –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞</div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π -->
<div class="modal" id="messagesModal" onclick="closeModalOnBackdrop(event, 'messagesModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <span class="modal-title">üí¨ –°–æ–æ–±—â–µ–Ω–∏—è</span>
            <button class="modal-close" onclick="closeModal('messagesModal')">‚úï</button>
        </div>
        <div class="messages-list" id="messagesList"></div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ —É—á–µ–Ω–∏–∫–æ–≤ -->
<div class="modal" id="studentsModal" onclick="closeModalOnBackdrop(event, 'studentsModal')">
    <div class="modal-content" onclick="event.stopPropagation()" style="padding: 0; overflow: hidden;">
        <div style="padding: 20px; background: var(--card-bg);">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span class="modal-title">üë• –£—á–µ–Ω–∏–∫–∏</span>
                <button class="modal-close" onclick="closeModal('studentsModal')">‚úï</button>
            </div>
        </div>
        <div class="students-stats">
            <div class="students-stat">
                <div class="students-stat-value" id="totalStudents">234</div>
                <div class="students-stat-label">–í—Å–µ–≥–æ</div>
            </div>
            <div class="students-stat">
                <div class="students-stat-value" id="activeStudents">156</div>
                <div class="students-stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
            </div>
            <div class="students-stat">
                <div class="students-stat-value" id="completedStudents">78</div>
                <div class="students-stat-label">–ó–∞–≤–µ—Ä—à–∏–ª–∏</div>
            </div>
        </div>
        <div id="studentsList" style="max-height: 400px; overflow-y: auto;"></div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ —á–∞—Ç–∞ -->
<div class="modal" id="chatModal" onclick="closeModalOnBackdrop(event, 'chatModal')">
    <div class="modal-content chat-modal-content" onclick="event.stopPropagation()" style="padding: 0;">
        <div class="chat-header">
            <div class="message-avatar" id="chatAvatar">–ú–°</div>
            <div class="chat-user-info">
                <div class="chat-user-name" id="chatUserName">–ú–∞—Ä–∏—è</div>
                <div class="chat-user-status">Telegram Mini Apps</div>
            </div>
            <button class="modal-close" style="background: rgba(255,255,255,0.2); color: white;" onclick="closeModal('chatModal')">‚úï</button>
        </div>
        <div class="chat-messages-container" id="chatMessagesContainer"></div>
        <div class="chat-input-container">
            <input type="text" class="chat-input" id="chatMessageInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
            <button class="chat-send-btn" onclick="sendChatMessage()">‚û§</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ -->
<div class="modal" id="certificateModal" onclick="closeModalOnBackdrop(event, 'certificateModal')">
    <div class="certificate" onclick="event.stopPropagation()">
        <div class="certificate-seal">üéì</div>
        <div class="certificate-title">–°–ï–†–¢–ò–§–ò–ö–ê–¢</div>
        <div class="certificate-subtitle">–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ –∫—É—Ä—Å–∞</div>
        <div class="certificate-name" id="certName">–ê—Ä—Ç–µ–º –ò–≤–∞–Ω–æ–≤</div>
        <div class="certificate-course">
            —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª<br><strong id="certCourse">"–ö—É—Ä—Å"</strong>
        </div>
        <div class="certificate-date" id="certDate">15 –¥–µ–∫–∞–±—Ä—è 2024</div>
        <div class="certificate-actions">
            <button class="cert-btn download" onclick="downloadCertificate()">üì• –°–∫–∞—á–∞—Ç—å</button>
            <button class="cert-btn share" onclick="closeModal('certificateModal')">‚úï</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –æ—Ç–∑—ã–≤–∞ -->
<div class="modal" id="reviewModal" onclick="closeModalOnBackdrop(event, 'reviewModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <span class="modal-title">‚úçÔ∏è –û—Ç–∑—ã–≤</span>
            <button class="modal-close" onclick="closeModal('reviewModal')">‚úï</button>
        </div>
        <div class="review-form">
            <p style="text-align: center;">–û—Ü–µ–Ω–∏—Ç–µ –∫—É—Ä—Å:</p>
            <div class="rating-select" id="ratingSelect">
                <span class="rating-star" onclick="selectRating(1)">‚≠ê</span>
                <span class="rating-star" onclick="selectRating(2)">‚≠ê</span>
                <span class="rating-star" onclick="selectRating(3)">‚≠ê</span>
                <span class="rating-star" onclick="selectRating(4)">‚≠ê</span>
                <span class="rating-star" onclick="selectRating(5)">‚≠ê</span>
            </div>
            <textarea class="review-textarea" id="reviewText" placeholder="–í–∞—à –æ—Ç–∑—ã–≤..."></textarea>
            <button class="submit-review-btn" onclick="submitReview()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞ -->
<div class="modal" id="promoModal" onclick="closeModalOnBackdrop(event, 'promoModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <span class="modal-title">üè∑Ô∏è –ü—Ä–æ–º–æ–∫–æ–¥</span>
            <button class="modal-close" onclick="closeModal('promoModal')">‚úï</button>
        </div>
        <div class="promo-form">
            <div class="form-group">
                <label class="form-label">–ö–æ–¥</label>
                <input type="text" class="form-input" id="promoCodeInput" placeholder="SALE20" style="text-transform: uppercase;">
            </div>
            <div class="form-group">
                <label class="form-label">–°–∫–∏–¥–∫–∞</label>
                <div class="discount-options">
                    <div class="discount-option" onclick="selectDiscount(10, this)">10%</div>
                    <div class="discount-option selected" onclick="selectDiscount(20, this)">20%</div>
                    <div class="discount-option" onclick="selectDiscount(30, this)">30%</div>
                    <div class="discount-option" onclick="selectDiscount(50, this)">50%</div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">–õ–∏–º–∏—Ç</label>
                <input type="number" class="form-input" id="promoLimitInput" value="100">
            </div>
            <button class="submit-review-btn" onclick="createPromoCode()">–°–æ–∑–¥–∞—Ç—å</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –∑–∞–º–µ—Ç–∫–∏ -->
<div class="modal" id="noteModal" onclick="closeModalOnBackdrop(event, 'noteModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <span class="modal-title">üìù –ó–∞–º–µ—Ç–∫–∞</span>
            <button class="modal-close" onclick="closeModal('noteModal')">‚úï</button>
        </div>
        <div style="padding: 20px;">
            <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
                üìπ –ú–æ–º–µ–Ω—Ç: <span id="noteTimestamp">00:00</span>
            </p>
            <textarea class="review-textarea" id="noteText" placeholder="–í–∞—à–∞ –∑–∞–º–µ—Ç–∫–∞..."></textarea>
            <button class="submit-review-btn" onclick="saveNote()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast">
    <span class="toast-icon">‚úÖ</span>
    <span class="toast-text">–°–æ–æ–±—â–µ–Ω–∏–µ</span>
</div>

<!-- SUCCESS OVERLAY -->
<div class="success-overlay" id="successOverlay">
    <div class="success-checkmark">‚úÖ</div>
    <div class="success-title">–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–∞!</div>
    <div class="success-text">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ PRO</div>
</div>

<script>
// ===== TELEGRAM WEBAPP =====
const tg = window.Telegram?.WebApp;
let videoTimer = null; // –§–∏–∫—Å —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏

// ===== TELEGRAM –§–£–ù–ö–¶–ò–ò =====
function initTelegramApp() {
    if (!tg) {
        console.warn('‚ö†Ô∏è Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –†–∞–±–æ—Ç–∞–µ–º –≤ standalone —Ä–µ–∂–∏–º–µ.');
        return;
    }
    
    // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    tg.ready();
    tg.expand(); // –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
    tg.enableClosingConfirmation(); // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
    
    // 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç–æ–≤—É—é —Å—Ö–µ–º—É Telegram
    applyTelegramTheme();
    
    // 3. –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const user = tg.initDataUnsafe?.user;
    if (user) {
        autoLoginFromTelegram(user);
    }
    
    // 4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
    setupBackButton();
    
    // 5. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å deep link (–µ—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª–∏ –ø–æ —Å—Å—ã–ª–∫–µ –Ω–∞ –∫—É—Ä—Å)
    handleDeepLink();
    
    console.log('‚úÖ Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
}

function applyTelegramTheme() {
    if (tg.colorScheme === 'dark') {
        state.darkMode = true;
        document.body.classList.add('dark-mode');
    }
    
    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç–∞ –∏–∑ —Ç–µ–º—ã Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    const root = document.documentElement;
    root.style.setProperty('--tg-bg', tg.backgroundColor || '#ffffff');
    root.style.setProperty('--tg-text', tg.themeParams?.text_color || '#000000');
    
    // –°–ª—É—à–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã
    tg.onEvent('themeChanged', () => {
        state.darkMode = tg.colorScheme === 'dark';
        document.body.classList.toggle('dark-mode', state.darkMode);
    });
}

function autoLoginFromTelegram(user) {
    state.user = {
        isLoggedIn: true,
        name: `${user.first_name}${user.last_name ? ' ' + user.last_name : ''}`,
        telegramId: user.id,
        username: user.username || '',
        photoUrl: user.photo_url || '',
        role: state.user.role || 'student'
    };
    
    document.getElementById('authScreen').classList.add('hidden');
    console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', state.user.name);
}

function setupBackButton() {
    tg.BackButton.onClick(() => {
        hapticFeedback('light');
        
        if (state.currentPage === 'course') {
            navigateTo('home');
        } else if (document.querySelector('.modal.active')) {
            const activeModal = document.querySelector('.modal.active');
            closeModal(activeModal.id);
        } else {
            tg.close();
        }
    });
}

function handleDeepLink() {
    const startParam = tg.initDataUnsafe?.start_param;
    if (startParam) {
        const match = startParam.match(/course_(\d+)/);
        if (match) {
            const courseId = parseInt(match[1]);
            setTimeout(() => openCourse(courseId), 1000);
        }
    }
}

function hapticFeedback(type = 'light') {
    if (!tg?.HapticFeedback) return;
    
    switch(type) {
        case 'light':
            tg.HapticFeedback.impactOccurred('light');
            break;
        case 'medium':
            tg.HapticFeedback.impactOccurred('medium');
            break;
        case 'heavy':
            tg.HapticFeedback.impactOccurred('heavy');
            break;
        case 'success':
            tg.HapticFeedback.notificationOccurred('success');
            break;
        case 'warning':
            tg.HapticFeedback.notificationOccurred('warning');
            break;
        case 'error':
            tg.HapticFeedback.notificationOccurred('error');
            break;
    }
}

function showMainButton(text, onClick) {
    if (!tg) return;
    
    tg.MainButton.setText(text);
    tg.MainButton.show();
    tg.MainButton.onClick(onClick);
}

function hideMainButton() {
    if (!tg) return;
    tg.MainButton.hide();
    tg.MainButton.offClick();
}
// ===== –î–ê–ù–ù–´–ï =====
const coursesData = [
    { id: 1, title: 'Telegram Mini Apps —Å –Ω—É–ª—è', author: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', authorInitials: '–ò–ü', price: 2999, rating: 4.8, students: 234, lessons: 15, hours: 12, badge: '–•–ò–¢', badgeColor: '#4CAF50', icon: 'üíª', gradient: 'linear-gradient(135deg, #667eea, #764ba2)' },
    { id: 2, title: '–ü—Ä–æ–¥–∞–∂–∏ —á–µ—Ä–µ–∑ —á–∞—Ç-–±–æ—Ç—ã', author: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', authorInitials: '–ú–°', price: 4999, oldPrice: 6999, rating: 4.9, students: 567, lessons: 20, hours: 8, badge: 'NEW', badgeColor: '#ff6b6b', icon: 'ü§ñ', gradient: 'linear-gradient(135deg, #f093fb, #f5576c)' },
    { id: 3, title: 'TON –ë–ª–æ–∫—á–µ–π–Ω', author: '–ê–ª–µ–∫—Å–µ–π –ö.', authorInitials: '–ê–ö', price: 9999, rating: 4.7, students: 89, lessons: 25, hours: 20, badge: null, icon: 'üíé', gradient: 'linear-gradient(135deg, #fa709a, #fee140)' }
];

const achievementsData = [
    { id: 1, icon: 'üéØ', name: '–ü–µ—Ä–≤—ã–π —É—Ä–æ–∫', desc: '–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —É—Ä–æ–∫', xp: 50, unlocked: true },
    { id: 2, icon: 'üìö', name: '–ö–Ω–∏–≥–æ–ª—é–±', desc: '–ö—É–ø–∏—Ç–µ –∫—É—Ä—Å', xp: 100, unlocked: true },
    { id: 3, icon: 'üî•', name: '7 –¥–Ω–µ–π', desc: '–£—á–∏—Ç–µ—Å—å –Ω–µ–¥–µ–ª—é', xp: 150, unlocked: true },
    { id: 4, icon: 'üí¨', name: '–ê–∫—Ç–∏–≤–∏—Å—Ç', desc: '5 –≤–æ–ø—Ä–æ—Å–æ–≤', xp: 100, unlocked: true },
    { id: 5, icon: '‚≠ê', name: '–ö—Ä–∏—Ç–∏–∫', desc: '3 –æ—Ç–∑—ã–≤–∞', xp: 100, unlocked: false },
    { id: 6, icon: 'üèÜ', name: '–ß–µ–º–ø–∏–æ–Ω', desc: '–ó–∞–≤–µ—Ä—à–∏—Ç–µ –∫—É—Ä—Å', xp: 500, unlocked: false },
    { id: 7, icon: 'üìù', name: '–û—Ç–ª–∏—á–Ω–∏–∫', desc: '–í—Å–µ —Ç–µ—Å—Ç—ã', xp: 200, unlocked: false },
    { id: 8, icon: 'üëë', name: '–õ–µ–≥–µ–Ω–¥–∞', desc: '5 –∫—É—Ä—Å–æ–≤', xp: 1000, unlocked: false }
];

const expertCoursesData = [
    { id: 1, title: 'Telegram Mini Apps', icon: 'üíª', students: 234, earnings: '701K ‚≠ê' },
    { id: 2, title: '–ü—Ä–æ–¥–∞–∂–∏ —á–µ—Ä–µ–∑ –±–æ—Ç—ã', icon: 'ü§ñ', students: 156, earnings: '468K ‚≠ê' }
];

const promoCodesData = [
    { code: 'NEWYEAR2024', discount: 20, uses: 45, limit: 100 },
    { code: 'WELCOME', discount: 10, uses: 128, limit: null }
];

const lessonsData = [
    { id: 1, title: '–í–≤–µ–¥–µ–Ω–∏–µ', duration: '15 –º–∏–Ω', completed: true },
    { id: 2, title: '–ù–∞—Å—Ç—Ä–æ–π–∫–∞', duration: '20 –º–∏–Ω', completed: true },
    { id: 3, title: 'Bot API', duration: '25 –º–∏–Ω', completed: false, current: true },
    { id: 4, title: 'Web Apps SDK', duration: '30 –º–∏–Ω', completed: false },
    { id: 5, title: '–°—Ç–∏–ª–∏–∑–∞—Ü–∏—è', duration: '25 –º–∏–Ω', completed: false }
];

const quizData = [
    { question: '–ö–∞–∫–æ–π –º–µ—Ç–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ?', options: ['sendMessage()', 'postMessage()', 'writeMessage()', 'pushMessage()'], correct: 0 },
    { question: '–ß—Ç–æ —Ç–∞–∫–æ–µ Webhook?', options: ['–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö', '–ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π', '–Ø–∑—ã–∫', '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞'], correct: 1 }
];

const qaData = [
    { author: '–ê–ª–µ–∫—Å–µ–π –ö.', initials: '–ê–ö', text: '–û—à–∏–±–∫–∞ 409 –ø—Ä–∏ webhook?', likes: 5, time: '2—á',
      answer: { author: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', initials: '–ò–ü', text: '–°–Ω–∞—á–∞–ª–∞ deleteWebhook().' } }
];

const reviewsData = [
    { author: '–ú–∞—Ä–∏—è –°.', initials: '–ú–°', rating: 5, text: '–û—Ç–ª–∏—á–Ω—ã–π –∫—É—Ä—Å!', time: '3 –¥–Ω—è' },
    { author: '–î–º–∏—Ç—Ä–∏–π –ü.', initials: '–î–ü', rating: 5, text: '–†–µ–∫–æ–º–µ–Ω–¥—É—é!', time: '1 –Ω–µ–¥' }
];

const messagesData = [
    { id: 1, sender: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', initials: '–ú–°', preview: '–í–æ–ø—Ä–æ—Å –ø–æ 3 —É—Ä–æ–∫—É...', course: 'Telegram Mini Apps', time: '5 –º–∏–Ω', unread: true,
      messages: [
        { text: '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –í–æ–ø—Ä–æ—Å –ø–æ 3 —É—Ä–æ–∫—É.', incoming: true, time: '14:30' },
        { text: '–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –°–ª—É—à–∞—é.', incoming: false, time: '14:32' }
    ]},
    { id: 2, sender: '–ê–ª–µ–∫—Å–µ–π –ö–æ–∑–ª–æ–≤', initials: '–ê–ö', preview: '–°–ø–∞—Å–∏–±–æ –∑–∞ –∫—É—Ä—Å!', course: '–ü—Ä–æ–¥–∞–∂–∏', time: '1 —á–∞—Å', unread: true,
      messages: [{ text: '–°–ø–∞—Å–∏–±–æ –∑–∞ –∫—É—Ä—Å!', incoming: true, time: '13:15' }]
    },
    { id: 3, sender: '–î–º–∏—Ç—Ä–∏–π –ü–µ—Ç—Ä–æ–≤', initials: '–î–ü', preview: '–ö–æ–≥–¥–∞ –Ω–æ–≤—ã–π —É—Ä–æ–∫?', course: 'Telegram Mini Apps', time: '2 —á–∞—Å–∞', unread: false,
      messages: [
        { text: '–ö–æ–≥–¥–∞ –Ω–æ–≤—ã–π —É—Ä–æ–∫?', incoming: true, time: '12:00' },
        { text: '–ó–∞–≤—Ç—Ä–∞ –≤ 18:00!', incoming: false, time: '12:05' }
    ]}
];

const studentsData = [
    { id: 1, name: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', initials: '–ú–°', course: 'Telegram Mini Apps', progress: 75, status: 'active' },
    { id: 2, name: '–ê–ª–µ–∫—Å–µ–π –ö–æ–∑–ª–æ–≤', initials: '–ê–ö', course: '–ü—Ä–æ–¥–∞–∂–∏', progress: 100, status: 'completed' },
    { id: 3, name: '–î–º–∏—Ç—Ä–∏–π –ü–µ—Ç—Ä–æ–≤', initials: '–î–ü', course: 'Telegram Mini Apps', progress: 45, status: 'active' },
    { id: 4, name: '–ê–Ω–Ω–∞ –ò–≤–∞–Ω–æ–≤–∞', initials: '–ê–ò', course: 'Telegram Mini Apps', progress: 90, status: 'active' },
    { id: 5, name: '–°–µ—Ä–≥–µ–π –í–æ–ª–∫–æ–≤', initials: '–°–í', course: '–ü—Ä–æ–¥–∞–∂–∏', progress: 100, status: 'completed' }
];

// ===== –°–û–°–¢–û–Ø–ù–ò–ï =====
let state = {
    currentMode: 'student',
    currentPage: 'main',
    currentCourse: null,
    darkMode: false,
    xp: 1250,
    level: 5,
    streak: 7,
    purchasedCourses: [],
    notes: [],
    selectedPlan: 'year',
    selectedRating: 0,
    selectedDiscount: 20,
    subscription: { status: 'trial', daysLeft: 10 },
    quizState: { currentQuestion: 0, score: 0, selectedAnswer: -1 },
    videoProgress: 0,
    isPlaying: false,
    user: { isLoggedIn: false, name: '', email: '', role: 'student' },
    currentChatUser: null,
    unreadMessages: 2
};

// ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
document.addEventListener('DOMContentLoaded', () => {
    initTelegramApp(); // –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è Telegram
    loadState();
    checkAuth();
    renderCatalog();
    renderAchievementsPreview();
    renderExpertCourses();
    renderPromoCodes();
    updateMessagesCount();
    
    if (state.user.isLoggedIn) {
        setTimeout(() => showToast('üëã', `–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, ${state.user.name}!`), 1000);
    }
});

function loadState() {
    const saved = localStorage.getItem('edugramState');
    if (saved) state = { ...state, ...JSON.parse(saved) };
}

function saveState() {
    localStorage.setItem('edugramState', JSON.stringify(state));
}

// ===== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø =====
function checkAuth() {
    document.getElementById('authScreen').classList.toggle('hidden', state.user.isLoggedIn);
}

function switchAuthTab(tab) {
    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
    document.getElementById(tab + 'Form').classList.add('active');
}

function selectAuthRole(role, el) {
    state.user.role = role;
    document.querySelectorAll('.auth-role').forEach(r => r.classList.remove('selected'));
    el.classList.add('selected');
}

function handleLogin() {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    if (!email || !password) { showToast('‚ö†Ô∏è', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); return; }
    
    state.user.isLoggedIn = true;
    state.user.email = email;
    state.user.name = email.split('@')[0];
    if (email.includes('expert')) state.user.role = 'expert';
    completeAuth();
}

function handleRegister() {
    const name = document.getElementById('registerName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    if (!name || !email || !password) { showToast('‚ö†Ô∏è', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è'); return; }
    if (password.length < 6) { showToast('‚ö†Ô∏è', '–ü–∞—Ä–æ–ª—å –º–∏–Ω. 6 —Å–∏–º–≤–æ–ª–æ–≤'); return; }
    
    state.user.isLoggedIn = true;
    state.user.name = name;
    state.user.email = email;
    completeAuth();
}

function loginWithTelegram() {
    state.user.isLoggedIn = true;
    state.user.name = 'Telegram User';
    showToast('üì±', '–í—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram...');
    setTimeout(completeAuth, 1000);
}

function completeAuth() {
    document.getElementById('authScreen').classList.add('hidden');
    saveState();
    if (state.user.role === 'expert') switchMode('expert');
    showToast('üëã', `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${state.user.name}!`);
}

// ===== –†–ï–ù–î–ï–† =====
function renderCatalog() {
    document.getElementById('catalogCourses').innerHTML = coursesData.map(c => `
        <div class="course-card" onclick="openCourse(${c.id})">
            <div class="course-image" style="background: ${c.gradient}">
                ${c.icon}
                ${c.badge ? `<div class="course-badge" style="background: ${c.badgeColor}">${c.badge}</div>` : ''}
                <div class="course-rating">‚≠ê ${c.rating}</div>
            </div>
            <div class="course-content">
                <h3 class="course-title">${c.title}</h3>
                <div class="course-author">
                    <div class="author-avatar">${c.authorInitials}</div>
                    <span class="author-name">${c.author}</span>
                </div>
                <div class="course-stats">
                    <span>üë• ${c.students}</span>
                    <span>üìö ${c.lessons}</span>
                    <span>‚è± ${c.hours}—á</span>
                </div>
                <div class="course-footer">
                    <div>
                        <span class="course-price">${c.price.toLocaleString()} ‚≠ê</span>
                        ${c.oldPrice ? `<span class="course-price-old">${c.oldPrice.toLocaleString()}</span>` : ''}
                    </div>
                    <button class="buy-btn ${state.purchasedCourses.includes(c.id) ? 'purchased' : ''}" onclick="buyCourse(event, ${c.id})">
                        ${state.purchasedCourses.includes(c.id) ? '‚úì' : '–ö—É–ø–∏—Ç—å'}
                    </button>
                </div>
            </div>
        </div>
    `).join('');
}

function renderPurchasedCourses() {
    const container = document.getElementById('purchasedCourses');
    if (state.purchasedCourses.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">–ù–µ—Ç –∫—É—Ä—Å–æ–≤</p>';
        return;
    }
    container.innerHTML = coursesData.filter(c => state.purchasedCourses.includes(c.id)).map(c => `
        <div class="course-card" onclick="openCourse(${c.id})">
            <div class="course-image" style="background: ${c.gradient}">${c.icon}</div>
            <div class="course-content">
                <h3 class="course-title">${c.title}</h3>
                <div class="course-progress">
                    <div class="progress-header">
                        <span class="progress-title">–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                        <span class="progress-percent">65%</span>
                    </div>
                    <div class="progress-bar-full"><div class="progress-bar-fill" style="width: 65%;"></div></div>
                </div>
                <button class="buy-btn" style="width: 100%; margin-top: 12px;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí</button>
            </div>
        </div>
    `).join('');
}

function renderAchievementsPreview() {
    document.getElementById('achievementsPreview').innerHTML = achievementsData.slice(0, 4).map(a => `
        <div class="achievement-item ${a.unlocked ? 'unlocked' : 'locked'}" onclick="showAchievementsModal()">
            <div class="achievement-icon">${a.icon}</div>
            <div class="achievement-name">${a.name}</div>
        </div>
    `).join('');
}

function renderAchievementsFull() {
    const unlocked = achievementsData.filter(a => a.unlocked);
    const locked = achievementsData.filter(a => !a.unlocked);
    document.getElementById('achievementsList').innerHTML = `
        <div class="achievement-category">
            <div class="category-title">üèÜ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ (${unlocked.length})</div>
            ${unlocked.map(a => `
                <div class="achievement-full unlocked">
                    <div class="achievement-icon">${a.icon}</div>
                    <div class="achievement-details">
                        <div class="achievement-full-name">${a.name}</div>
                        <div class="achievement-desc">${a.desc}</div>
                    </div>
                    <div class="achievement-xp">+${a.xp}</div>
                </div>
            `).join('')}
        </div>
        <div class="achievement-category">
            <div class="category-title">üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ (${locked.length})</div>
            ${locked.map(a => `
                <div class="achievement-full locked">
                    <div class="achievement-icon">${a.icon}</div>
                    <div class="achievement-details">
                        <div class="achievement-full-name">${a.name}</div>
                        <div class="achievement-desc">${a.desc}</div>
                    </div>
                    <div class="achievement-xp">+${a.xp}</div>
                </div>
            `).join('')}
        </div>
    `;
}

function renderExpertCourses() {
    document.getElementById('expertCoursesList').innerHTML = expertCoursesData.map(c => `
        <div class="my-course-item">
            <div class="my-course-thumb">${c.icon}</div>
            <div class="my-course-info">
                <div class="my-course-title">${c.title}</div>
                <div class="my-course-stats"><span>üë• ${c.students}</span><span>üí∞ ${c.earnings}</span></div>
            </div>
            <button class="share-link-btn" onclick="copyLink(event, ${c.id})">üìã</button>
        </div>
    `).join('');
}

function renderPromoCodes() {
    document.getElementById('promoList').innerHTML = promoCodesData.map(p => `
        <div class="promo-card">
            <div class="promo-code">${p.code}</div>
            <div class="promo-info"><div class="promo-uses">${p.uses}/${p.limit || '‚àû'}</div></div>
            <div class="promo-discount">-${p.discount}%</div>
        </div>
    `).join('');
}

function renderLessons() {
    document.getElementById('lessonsList').innerHTML = lessonsData.map((l, i) => `
        <div class="lesson-item ${l.completed ? 'completed' : ''} ${l.current ? 'current' : ''}" onclick="selectLesson(${i})">
            <div class="lesson-number">${l.completed ? '‚úì' : i + 1}</div>
            <div class="lesson-info">
                <div class="lesson-title">${l.title}</div>
                <div class="lesson-duration">${l.duration}</div>
            </div>
            <span>${l.completed ? '‚úÖ' : l.current ? '‚ñ∂Ô∏è' : 'üîí'}</span>
        </div>
    `).join('');
}

function renderQuiz() {
    const q = quizData[state.quizState.currentQuestion];
    if (!q) return;
    document.getElementById('quizQuestionNum').textContent = state.quizState.currentQuestion + 1;
    document.getElementById('quizQuestion').textContent = q.question;
    document.getElementById('quizOptions').innerHTML = q.options.map((opt, i) => `
        <div class="quiz-option" onclick="selectQuizOption(${i})">
            <span class="option-letter">${String.fromCharCode(65 + i)}</span>
            <span>${opt}</span>
        </div>
    `).join('');
}

function renderQA() {
    document.getElementById('qaList').innerHTML = qaData.map(q => `
        <div class="qa-item">
            <div class="qa-question">
                <div class="qa-avatar">${q.initials}</div>
                <div class="qa-content">
                    <div class="qa-author">${q.author}</div>
                    <div class="qa-text">${q.text}</div>
                    <div class="qa-meta"><span>üëç ${q.likes}</span><span>${q.time}</span></div>
                </div>
            </div>
            ${q.answer ? `<div class="qa-answer"><div class="qa-question"><div class="qa-avatar" style="background: var(--success)">${q.answer.initials}</div><div class="qa-content"><div class="qa-author">${q.answer.author} <span class="expert-badge">–≠–∫—Å–ø–µ—Ä—Ç</span></div><div class="qa-text">${q.answer.text}</div></div></div></div>` : ''}
        </div>
    `).join('');
}

function renderReviews() {
    document.getElementById('reviewsList').innerHTML = reviewsData.map(r => `
        <div class="review-item">
            <div class="review-header">
                <div class="review-author-info">
                    <div class="qa-avatar">${r.initials}</div>
                    <div><div class="qa-author">${r.author}</div><div class="review-stars">${'‚≠ê'.repeat(r.rating)}</div></div>
                </div>
                <span style="font-size: 12px; color: #666;">${r.time}</span>
            </div>
            <div class="qa-text">${r.text}</div>
        </div>
    `).join('');
}

function renderNotes() {
    const container = document.getElementById('notesList');
    if (state.notes.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">–ù–µ—Ç –∑–∞–º–µ—Ç–æ–∫</p>';
        return;
    }
    container.innerHTML = state.notes.map((n, i) => `
        <div class="note-item">
            <div class="note-timestamp">üìπ ${n.lesson} ‚Ä¢ <span>${n.timestamp}</span></div>
            <div class="note-text">${n.text}</div>
            <div class="note-actions"><button class="note-action-btn" onclick="deleteNote(${i})">üóë</button></div>
        </div>
    `).join('');
}

function renderMessages() {
    document.getElementById('messagesList').innerHTML = messagesData.map(m => `
        <div class="message-item ${m.unread ? 'unread' : ''}" onclick="openChat(${m.id})">
            <div class="message-avatar">${m.initials}</div>
            <div class="message-content">
                <div class="message-header">
                    <span class="message-sender">${m.sender}</span>
                    <span class="message-time">${m.time}</span>
                </div>
                <div class="message-preview">${m.preview}</div>
                <div class="message-course">üìö ${m.course}</div>
            </div>
            ${m.unread ? '<div class="unread-dot"></div>' : ''}
        </div>
    `).join('');
}

function renderStudents() {
    const total = studentsData.length;
    const active = studentsData.filter(s => s.status === 'active').length;
    const completed = studentsData.filter(s => s.status === 'completed').length;
    
    document.getElementById('totalStudents').textContent = total;
    document.getElementById('activeStudents').textContent = active;
    document.getElementById('completedStudents').textContent = completed;
    document.getElementById('headerStudentsCount').textContent = total;
    document.getElementById('expertStudentsCount').textContent = total;
    
    document.getElementById('studentsList').innerHTML = studentsData.map(s => `
        <div class="student-item">
            <div class="student-avatar">${s.initials}</div>
            <div class="student-info">
                <div class="student-name">${s.name}</div>
                <div class="student-course">üìö ${s.course}</div>
            </div>
            <div class="student-progress">
                <div class="student-progress-value">${s.progress}%</div>
                <div class="student-progress-label">${s.status === 'completed' ? '‚úÖ' : 'üìñ'}</div>
            </div>
        </div>
    `).join('');
}

// ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø =====
function navigateTo(page) {
    hapticFeedback('light'); // –ù–û–í–û–ï: –≤–∏–±—Ä–∞—Ü–∏—è
    
    if (page === 'home') {
        document.getElementById('mainPage').classList.add('active');
        document.getElementById('coursePage').classList.remove('active');
        document.getElementById('backBtn').classList.remove('visible');
        document.getElementById('headerTitle').textContent = 'üìö EduGram';
        document.getElementById('addNoteFab').classList.remove('visible');
        state.currentPage = 'main';
        
        // –ù–û–í–û–ï: —Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫–∏ Telegram
        if (tg) {
            tg.BackButton.hide();
            tg.MainButton.hide();
        }
    }
}

function goBack() { navigateTo('home'); }

function openCourse(id) {
    hapticFeedback('light'); // –ù–û–í–û–ï: –≤–∏–±—Ä–∞—Ü–∏—è
    
    state.currentCourse = coursesData.find(c => c.id === id);
    document.getElementById('mainPage').classList.remove('active');
    document.getElementById('coursePage').classList.add('active');
    document.getElementById('backBtn').classList.add('visible');
    document.getElementById('headerTitle').textContent = state.currentCourse.title;
    document.getElementById('addNoteFab').classList.add('visible');
    state.currentPage = 'course';
    
    // –ù–û–í–û–ï: Telegram –∫–Ω–æ–ø–∫–∏
    if (tg) {
        tg.BackButton.show();
        
        if (!state.purchasedCourses.includes(id)) {
            showMainButton(`–ö—É–ø–∏—Ç—å –∑–∞ ${state.currentCourse.price} ‚≠ê`, () => {
                buyCourse(null, id);
            });
        }
    }
    
    renderLessons(); 
    renderQuiz(); 
    renderQA(); 
    renderReviews(); 
    renderNotes();
    switchLessonTab('lessons');
}

function buyCourse(event, id) {
    event?.stopPropagation();
    if (state.purchasedCourses.includes(id)) { 
        openCourse(id); 
        return; 
    }
    
    hapticFeedback('medium'); // –ù–û–í–û–ï: –≤–∏–±—Ä–∞—Ü–∏—è
    
    state.purchasedCourses.push(id);
    addXP(100);
    saveState();
    renderCatalog(); 
    renderPurchasedCourses();
    document.getElementById('statCourses').textContent = state.purchasedCourses.length;
    showToast('‚úÖ', '–ö—É—Ä—Å –∫—É–ø–ª–µ–Ω! +100 XP');
    
    hideMainButton(); // –ù–û–í–û–ï: —Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É –ø–æ–∫—É–ø–∫–∏
}

// ===== –†–ï–ñ–ò–ú–´ –ò –¢–ê–ë–´ =====
function switchMode(mode) {
    state.currentMode = mode;
    document.getElementById('studentModeBtn').classList.toggle('active', mode === 'student');
    document.getElementById('expertModeBtn').classList.toggle('active', mode === 'expert');
    document.getElementById('studentMode').style.display = mode === 'student' ? 'block' : 'none';
    document.getElementById('expertMode').style.display = mode === 'expert' ? 'block' : 'none';
    document.getElementById('subBanner').style.display = mode === 'expert' ? 'flex' : 'none';
    document.getElementById('headerStudent').style.display = mode === 'student' ? 'flex' : 'none';
    document.getElementById('headerExpert').style.display = mode === 'expert' ? 'flex' : 'none';
    
    if (mode === 'expert') { updateSubscriptionUI(); updateMessagesCount(); }
}

function switchStudentTab(tab) {
    document.querySelectorAll('#studentMode .tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    document.querySelectorAll('#studentMode .tab-content').forEach(c => c.style.display = 'none');
    document.getElementById(tab + 'Tab').style.display = 'block';
    if (tab === 'myCourses') renderPurchasedCourses();
}

function switchExpertTab(tab) {
    document.querySelectorAll('#expertMode .tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    document.querySelectorAll('.expert-tab-content').forEach(c => c.style.display = 'none');
    const tabMap = { 'dashboard': 'dashboardTab', 'myCourses': 'myCoursesExpertTab', 'promo': 'promoTab', 'analytics': 'analyticsTab' };
    document.getElementById(tabMap[tab]).style.display = 'block';
}

function switchLessonTab(tab) {
    document.querySelectorAll('.lesson-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    document.querySelectorAll('.lesson-content').forEach(c => c.style.display = 'none');
    document.getElementById(tab + 'Content').style.display = 'block';
}

// ===== –í–ò–î–ï–û =====
function toggleVideo() {
    state.isPlaying = !state.isPlaying;
    
    if (state.isPlaying) {
        simulateVideoProgress();
        document.querySelector('.play-btn').textContent = '‚è∏Ô∏è';
        document.getElementById('playPauseBtn').textContent = '‚è∏Ô∏è';
    } else {
        // –ù–û–í–û–ï: –æ—á–∏—Å—Ç–∫–∞ —Ç–∞–π–º–µ—Ä–∞
        if (videoTimer) {
            clearTimeout(videoTimer);
            videoTimer = null;
        }
        document.querySelector('.play-btn').textContent = '‚ñ∂Ô∏è';
        document.getElementById('playPauseBtn').textContent = '‚ñ∂Ô∏è';
    }
}

function simulateVideoProgress() {
    if (!state.isPlaying) {
        if (videoTimer) clearTimeout(videoTimer); // –ù–û–í–û–ï: –æ—á–∏—Å—Ç–∫–∞ —Ç–∞–π–º–µ—Ä–∞
        return;
    }
    
    state.videoProgress += 1;
    document.getElementById('videoProgress').style.width = state.videoProgress + '%';
    
    const current = Math.floor(state.videoProgress * 9.3);
    const mins = Math.floor(current / 60);
    const secs = current % 60;
    document.getElementById('videoTime').textContent = 
        `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')} / 15:30`;
    
    if (state.videoProgress < 100) {
        videoTimer = setTimeout(simulateVideoProgress, 100); // –ù–û–í–û–ï: —Å–æ—Ö—Ä–∞–Ω—è–µ–º ID —Ç–∞–π–º–µ—Ä–∞
    } else {
        state.isPlaying = false;
        document.querySelector('.play-btn').textContent = '‚ñ∂Ô∏è';
        document.getElementById('playPauseBtn').textContent = '‚ñ∂Ô∏è';
        addXP(50);
        showToast('üéâ', '–£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω! +50 XP');
    }
}

function seekVideo(event) {
    const rect = event.currentTarget.getBoundingClientRect();
    state.videoProgress = ((event.clientX - rect.left) / rect.width) * 100;
    document.getElementById('videoProgress').style.width = state.videoProgress + '%';
}

function selectLesson(index) {
    lessonsData.forEach((l, i) => {
        l.current = i === index;
    });
    document.getElementById('currentLessonTitle').textContent = lessonsData[index].title;
    state.videoProgress = 0;
    renderLessons();
}

// ===== –ö–í–ò–ó =====
function selectQuizOption(index) {
    state.quizState.selectedAnswer = index;
    document.querySelectorAll('.quiz-option').forEach((o, i) => {
        o.classList.toggle('selected', i === index);
    });
}

function submitQuizAnswer() {
    if (state.quizState.selectedAnswer === -1) {
        showToast('‚ö†Ô∏è', '–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç');
        return;
    }
    
    const q = quizData[state.quizState.currentQuestion];
    const options = document.querySelectorAll('.quiz-option');
    
    if (state.quizState.selectedAnswer === q.correct) {
        options[state.quizState.selectedAnswer].classList.add('correct');
        state.quizState.score++;
        addXP(20);
        showToast('‚úÖ', '–ü—Ä–∞–≤–∏–ª—å–Ω–æ! +20 XP');
    } else {
        options[state.quizState.selectedAnswer].classList.add('wrong');
        options[q.correct].classList.add('correct');
        showToast('‚ùå', '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ');
    }
    
    setTimeout(() => {
        state.quizState.currentQuestion++;
        state.quizState.selectedAnswer = -1;
        
        if (state.quizState.currentQuestion >= quizData.length) {
            showToast('üéì', `–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω! –†–µ–∑—É–ª—å—Ç–∞—Ç: ${state.quizState.score}/${quizData.length}`);
            if (state.quizState.score === quizData.length) {
                setTimeout(() => showCertificate(), 1500);
            }
            state.quizState.currentQuestion = 0;
            state.quizState.score = 0;
        }
        renderQuiz();
    }, 1500);
}

// ===== Q&A =====
function sendQuestion() {
    const input = document.getElementById('qaInput');
    if (!input.value.trim()) return;
    
    qaData.unshift({
        author: '–í—ã',
        initials: '–í–´',
        text: input.value,
        likes: 0,
        time: '–¢–æ–ª—å–∫–æ —á—Ç–æ',
        answer: null
    });
    
    input.value = '';
    renderQA();
    addXP(5);
    showToast('‚úÖ', '–í–æ–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! +5 XP');
}

function likeQuestion(el) {
    const current = parseInt(el.textContent.split(' ')[1]);
    el.textContent = `üëç ${current + 1}`;
}

// ===== –û–¢–ó–´–í–´ =====
function showReviewModal() {
    document.getElementById('reviewModal').classList.add('active');
    state.selectedRating = 0;
    updateRatingStars();
}

function selectRating(rating) {
    state.selectedRating = rating;
    updateRatingStars();
}

function updateRatingStars() {
    document.querySelectorAll('#ratingSelect .rating-star').forEach((s, i) => {
        s.classList.toggle('selected', i < state.selectedRating);
    });
}

function submitReview() {
    const text = document.getElementById('reviewText').value;
    if (!text.trim() || state.selectedRating === 0) {
        showToast('‚ö†Ô∏è', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
        return;
    }
    
    reviewsData.unshift({
        author: '–í—ã',
        initials: '–í–´',
        rating: state.selectedRating,
        text: text,
        time: '–¢–æ–ª—å–∫–æ —á—Ç–æ'
    });
    
    document.getElementById('reviewText').value = '';
    closeModal('reviewModal');
    renderReviews();
    addXP(30);
    showToast('‚úÖ', '–û—Ç–∑—ã–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! +30 XP');
}

// ===== –ó–ê–ú–ï–¢–ö–ò =====
function showAddNoteModal() {
    const mins = Math.floor(state.videoProgress * 9.3 / 60);
    const secs = Math.floor(state.videoProgress * 9.3 % 60);
    document.getElementById('noteTimestamp').textContent = 
        `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    document.getElementById('noteModal').classList.add('active');
}

function saveNote() {
    const text = document.getElementById('noteText').value;
    if (!text.trim()) {
        showToast('‚ö†Ô∏è', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏');
        return;
    }
    
    state.notes.unshift({
        lesson: lessonsData.find(l => l.current)?.title || '–£—Ä–æ–∫',
        timestamp: document.getElementById('noteTimestamp').textContent,
        text: text
    });
    
    document.getElementById('noteText').value = '';
    closeModal('noteModal');
    renderNotes();
    saveState();
    showToast('üìù', '–ó–∞–º–µ—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');
}

function deleteNote(index) {
    state.notes.splice(index, 1);
    renderNotes();
    saveState();
    showToast('üóë', '–ó–∞–º–µ—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
}

// ===== –ü–†–û–ú–û–ö–û–î–´ =====
function showCreatePromoModal() {
    document.getElementById('promoModal').classList.add('active');
}

function selectDiscount(discount, el) {
    state.selectedDiscount = discount;
    document.querySelectorAll('.discount-option').forEach(o => o.classList.remove('selected'));
    el.classList.add('selected');
}

function createPromoCode() {
    const code = document.getElementById('promoCodeInput').value.toUpperCase();
    const limit = document.getElementById('promoLimitInput').value;
    
    if (!code) {
        showToast('‚ö†Ô∏è', '–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞');
        return;
    }
    
    promoCodesData.push({
        code: code,
        discount: state.selectedDiscount,
        uses: 0,
        limit: limit ? parseInt(limit) : null
    });
    
    document.getElementById('promoCodeInput').value = '';
    closeModal('promoModal');
    renderPromoCodes();
    showToast('‚úÖ', `–ü—Ä–æ–º–æ–∫–æ–¥ ${code} —Å–æ–∑–¥–∞–Ω!`);
}

// ===== –ü–û–î–ü–ò–°–ö–ê =====
function updateSubscriptionUI() {
    const banner = document.getElementById('subBanner');
    const bannerText = document.getElementById('bannerText');
    const subCard = document.getElementById('subCard');
    const subStatus = document.getElementById('subStatus');
    const blockedOverlay = document.getElementById('blockedOverlay');
    const createBtn = document.getElementById('createCourseBtn');
    
    switch (state.subscription.status) {
        case 'trial':
            banner.className = 'subscription-banner trial';
            bannerText.textContent = `‚è∞ –ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥: ${state.subscription.daysLeft} –¥–Ω–µ–π`;
            subCard.className = 'subscription-card trial';
            subStatus.textContent = `–ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥: ${state.subscription.daysLeft} –¥–Ω–µ–π`;
            blockedOverlay.classList.remove('active');
            createBtn.disabled = false;
            break;
        case 'active':
            banner.className = 'subscription-banner active';
            bannerText.textContent = 'üëë PRO –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞';
            subCard.className = 'subscription-card active';
            subStatus.textContent = 'PRO –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞';
            blockedOverlay.classList.remove('active');
            createBtn.disabled = false;
            break;
        case 'expired':
            banner.className = 'subscription-banner expired';
            bannerText.textContent = 'üîí –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞';
            subCard.className = 'subscription-card expired';
            subStatus.textContent = '–ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞';
            blockedOverlay.classList.add('active');
            createBtn.disabled = true;
            break;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–∞–ª–∫—É
    document.getElementById('trialDays').textContent = state.subscription.daysLeft;
    document.getElementById('trialProgressFill').style.width = (state.subscription.daysLeft / 10 * 100) + '%';
}

function selectPlan(plan) {
    state.selectedPlan = plan;
    document.querySelectorAll('.plan-card').forEach(c => c.classList.remove('selected'));
    event.currentTarget.classList.add('selected');
    document.getElementById('selectedPlanPrice').textContent = plan === 'year' ? '7,128 ‚ÇΩ' : '990 ‚ÇΩ';
}

function processPayment() {
    const btn = event.currentTarget;
    btn.innerHTML = '‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...';
    btn.disabled = true;
    
    setTimeout(() => {
        closeModal('subscriptionModal');
        document.getElementById('successOverlay').classList.add('active');
        
        state.subscription.status = 'active';
        state.subscription.daysLeft = state.selectedPlan === 'year' ? 365 : 30;
        saveState();
        
        setTimeout(() => {
            document.getElementById('successOverlay').classList.remove('active');
            updateSubscriptionUI();
            showToast('üéâ', '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ PRO!');
        }, 2500);
        
        btn.innerHTML = 'üí≥ –û–ø–ª–∞—Ç–∏—Ç—å <span id="selectedPlanPrice">7,128 ‚ÇΩ</span>';
        btn.disabled = false;
    }, 2000);
}

// ===== –î–û–°–¢–ò–ñ–ï–ù–ò–Ø –ò XP =====
function addXP(amount) {
    state.xp += amount;
    document.getElementById('userXP').textContent = state.xp.toLocaleString();
    document.getElementById('statXP').textContent = state.xp.toLocaleString();
    document.getElementById('modalXP').textContent = state.xp.toLocaleString();
    
    const newLevel = Math.floor(state.xp / 300) + 1;
    if (newLevel > state.level) {
        state.level = newLevel;
        document.getElementById('userLevel').textContent = `LVL ${state.level}`;
        document.getElementById('modalLevel').textContent = state.level;
        showToast('üéâ', `–ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å: ${state.level}!`);
    }
    saveState();
}

function showAchievementsModal() {
    document.getElementById('modalXP').textContent = state.xp.toLocaleString();
    document.getElementById('modalLevel').textContent = state.level;
    document.getElementById('modalAchievements').textContent = achievementsData.filter(a => a.unlocked).length;
    document.getElementById('levelProgressFill').style.width = ((state.xp % 300) / 300 * 100) + '%';
    renderAchievementsFull();
    document.getElementById('achievementsModal').classList.add('active');
}

function showStreakInfo() {
    showToast('üî•', `–í—ã —É—á–∏—Ç–µ—Å—å ${state.streak} –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥!`);
}

// ===== –°–ï–†–¢–ò–§–ò–ö–ê–¢ =====
function showCertificate() {
    document.getElementById('certName').textContent = '–ê—Ä—Ç–µ–º –ò–≤–∞–Ω–æ–≤';
    document.getElementById('certCourse').textContent = `"${state.currentCourse?.title || '–ö—É—Ä—Å'}"`;
    document.getElementById('certDate').textContent = new Date().toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' });
    document.getElementById('certificateModal').classList.add('active');
}

function downloadCertificate() {
    showToast('üì•', '–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è...');
}

function shareCertificate() {
    showToast('üì§', '–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º');
}

// ===== –ü–†–û–ß–ï–ï =====
function copyLink(event, id) {
    event.stopPropagation();
    const link = `t.me/EduGramBot/app?course=${id}`;
    navigator.clipboard?.writeText(link);
    showToast('üìã', `–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞: ${link}`);
}

function createCourse() {
    if (state.subscription.status === 'expired') {
        showSubscriptionModal();
        return;
    }
    const name = prompt('–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞:');
    if (name) {
        expertCoursesData.push({
            id: expertCoursesData.length + 1,
            title: name,
            icon: 'üìö',
            students: 0,
            earnings: '0 ‚≠ê'
        });
        renderExpertCourses();
        document.getElementById('expertCoursesCount').textContent = expertCoursesData.length;
        showToast('‚úÖ', `–ö—É—Ä—Å "${name}" —Å–æ–∑–¥–∞–Ω!`);
    }
}

function toggleDarkMode() {
    state.darkMode = !state.darkMode;
    document.body.classList.toggle('dark-mode', state.darkMode);
    saveState();
    showToast('üåô', state.darkMode ? '–¢–µ–º–Ω–∞—è —Ç–µ–º–∞' : '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞');
}

function showSearch() {
    showToast('üîç', '–ü–æ–∏—Å–∫ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω');
}

function showProfile() {
    switchMode('student');
    switchStudentTab('stats');
}

// ===== –ú–û–î–ê–õ–ö–ò =====
function showSubscriptionModal() {
    document.getElementById('subscriptionModal').classList.add('active');
}

function closeModal(id) {
    document.getElementById(id).classList.remove('active');
}

function closeModalOnBackdrop(event, id) {
    if (event.target === event.currentTarget) {
        closeModal(id);
    }
}

// ===== TOAST =====
function showToast(icon, text) {
    // –ù–û–í–û–ï: –≤–∏–±—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    if (icon === '‚úÖ') hapticFeedback('success');
    else if (icon === '‚ö†Ô∏è' || icon === '‚ùå') hapticFeedback('error');
    else hapticFeedback('light');
    
    const toast = document.getElementById('toast');
    toast.querySelector('.toast-icon').textContent = icon;
    toast.querySelector('.toast-text').textContent = text;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3000);
}
</script>

</body>
</html>