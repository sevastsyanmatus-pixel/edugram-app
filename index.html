<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EduGram - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∫—É—Ä—Å–æ–≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #4CAF50;
            --warning: #ff9800;
            --danger: #f44336;
            --dark: #1a1a2e;
            --light: #f5f5f5;
            --gold: #ffd700;
            --bg: #ffffff;
            --text: #333333;
            --card-bg: #ffffff;
            --border: #e0e0e0;
        }

        body.dark-mode {
            --bg: #1a1a2e;
            --text: #ffffff;
            --card-bg: #16213e;
            --light: #16213e;
            --border: #2a2a4a;
        }

        html {
    height: 100%;
    overflow: hidden;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg);
    color: var(--text);
    height: 100%;
    overflow: hidden;
    overscroll-behavior: none;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-x pan-y;
    position: fixed;
    width: 100%;
    top: 0;
    left: 0;
}

        .container {
    max-width: 480px;
    margin: 0 auto;
    background: var(--bg);
    height: 100%;
    position: relative;
    padding-bottom: 80px;
    overflow-y: auto;
    overflow-x: hidden;
    overscroll-behavior-y: contain;
    -webkit-overflow-scrolling: touch;
}

        /* ===== –•–ï–î–ï–† ===== */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .back-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .back-btn.visible {
            display: flex;
        }

        .logo {
            font-size: 22px;
            font-weight: bold;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .header-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s;
        }

        .header-btn:active {
            transform: scale(0.9);
        }

        .user-xp {
            background: rgba(255,255,255,0.2);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .user-xp:hover {
            background: rgba(255,255,255,0.3);
        }

        .user-xp:active {
            transform: scale(0.95);
        }

        .xp-value {
            font-weight: bold;
            color: var(--gold);
        }

        .user-level {
            background: linear-gradient(135deg, var(--gold), #ffed4e);
            color: #333;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

        .streak-badge {
            background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }

        /* ===== –•–ï–î–ï–† –≠–ö–°–ü–ï–†–¢–ê ===== */
        .expert-header-stat {
            background: rgba(255,255,255,0.2);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .expert-header-messages {
            background: rgba(255,255,255,0.2);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 16px;
            cursor: pointer;
            position: relative;
        }

        .messages-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        /* ===== –ë–ê–ù–ù–ï–† –ü–û–î–ü–ò–°–ö–ò ===== */
        .subscription-banner {
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .subscription-banner.trial {
            background: linear-gradient(135deg, var(--warning), #f57c00);
            color: white;
        }

        .subscription-banner.active {
            background: linear-gradient(135deg, var(--success), #388e3c);
            color: white;
        }

        .subscription-banner.expired {
            background: linear-gradient(135deg, var(--danger), #d32f2f);
            color: white;
            animation: pulse-danger 2s infinite;
        }

        @keyframes pulse-danger {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .banner-text {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .banner-btn {
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        /* ===== –†–ï–ñ–ò–ú–´ ===== */
        .mode-switcher {
            display: flex;
            background: var(--light);
            padding: 5px;
            margin: 15px;
            border-radius: 12px;
            gap: 5px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: var(--card-bg);
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* ===== –¢–ê–ë–´ ===== */
        .tabs {
            display: flex;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            scrollbar-width: none;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            flex: 1;
            min-width: 80px;
            padding: 12px 8px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 12px;
            color: #999;
            position: relative;
            white-space: nowrap;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary);
            font-weight: 600;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary);
        }

        /* ===== –ö–ê–†–¢–û–ß–ö–ò –ö–£–†–°–û–í ===== */
        .courses-grid {
            padding: 15px;
            display: grid;
            gap: 15px;
        }

        .course-card {
            background: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: transform 0.2s;
            border: 1px solid var(--border);
        }

        .course-card:active {
            transform: scale(0.98);
        }

        .course-image {
            width: 100%;
            height: 160px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            position: relative;
        }

        .course-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--success);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
        }

        .course-rating {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
        }

        .course-content {
            padding: 15px;
        }

        .course-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .course-author {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .author-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: white;
            font-weight: bold;
        }

        .author-name {
            font-size: 13px;
            color: #666;
        }

        .course-stats {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: #666;
            margin-bottom: 12px;
        }

        .course-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .course-price {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
        }

        .course-price-old {
            font-size: 14px;
            color: #999;
            text-decoration: line-through;
            margin-left: 8px;
        }

        .buy-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .buy-btn:active {
            transform: scale(0.95);
        }

        .buy-btn.purchased {
            background: var(--success);
        }

        /* ===== –ü–†–û–ì–†–ï–°–° –ö–£–†–°–ê ===== */
        .course-progress {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            padding: 15px;
            margin: 15px;
            border-radius: 12px;
        }

        body.dark-mode .course-progress {
            background: linear-gradient(135deg, #1b4332, #2d6a4f);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .progress-title {
            font-weight: 600;
            font-size: 14px;
        }

        .progress-percent {
            font-size: 18px;
            font-weight: bold;
            color: var(--success);
        }

        .progress-bar-full {
            height: 8px;
            background: rgba(255,255,255,0.5);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--success);
            border-radius: 10px;
            transition: width 0.5s;
        }

        /* ===== –í–ò–î–ï–û–ü–õ–ï–ï–† ===== */
        .video-player {
            width: 100%;
            height: 220px;
            background: #000;
            position: relative;
        }

        .video-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
        }

        .play-btn {
            width: 70px;
            height: 70px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin: 0 auto 15px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .play-btn:hover {
            transform: scale(1.1);
        }

        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .video-control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        .progress-bar {
            flex: 1;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 2px;
            width: 0%;
            transition: width 0.1s;
        }

        .video-time {
            color: white;
            font-size: 12px;
            min-width: 80px;
            text-align: right;
        }

        /* ===== –¢–ê–ë–´ –£–†–û–ö–ê ===== */
        .lesson-tabs {
            display: flex;
            gap: 8px;
            padding: 15px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .lesson-tabs::-webkit-scrollbar {
            display: none;
        }

        .lesson-tab {
            padding: 8px 16px;
            background: var(--light);
            border: none;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            white-space: nowrap;
            color: var(--text);
            transition: all 0.2s;
        }

        .lesson-tab.active {
            background: var(--primary);
            color: white;
        }

        /* ===== –£–†–û–ö–ò ===== */
        .lessons-list {
            padding: 0 15px 15px;
        }

        .lesson-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--card-bg);
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }

        .lesson-item:active {
            transform: scale(0.98);
        }

        .lesson-item.completed {
            opacity: 0.7;
        }

        .lesson-item.current {
            border: 2px solid var(--primary);
        }

        .lesson-number {
            width: 36px;
            height: 36px;
            background: var(--light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }

        .lesson-item.completed .lesson-number {
            background: var(--success);
            color: white;
        }

        .lesson-info {
            flex: 1;
        }

        .lesson-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .lesson-duration {
            font-size: 12px;
            color: #666;
        }

        /* ===== –ö–í–ò–ó ===== */
        .quiz-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin: 15px;
            border: 1px solid var(--border);
        }

        .quiz-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .quiz-timer {
            background: var(--danger);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .quiz-question {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .quiz-options {
            display: grid;
            gap: 10px;
        }

        .quiz-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quiz-option:hover {
            border-color: var(--primary);
        }

        .quiz-option.selected {
            border-color: var(--primary);
            background: rgba(102, 126, 234, 0.1);
        }

        .quiz-option.correct {
            border-color: var(--success);
            background: rgba(76, 175, 80, 0.1);
        }

        .quiz-option.wrong {
            border-color: var(--danger);
            background: rgba(244, 67, 54, 0.1);
        }

        .option-letter {
            width: 32px;
            height: 32px;
            background: var(--light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .quiz-option.selected .option-letter {
            background: var(--primary);
            color: white;
        }

        .quiz-submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }

        /* ===== Q&A ===== */
        .qa-section {
            padding: 15px;
        }

        .qa-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .qa-title {
            font-size: 16px;
            font-weight: 600;
        }

        .qa-count {
            background: var(--light);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
        }

        .qa-input-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .qa-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 25px;
            font-size: 14px;
            background: var(--card-bg);
            color: var(--text);
            outline: none;
        }

        .qa-input:focus {
            border-color: var(--primary);
        }

        .qa-send-btn {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        .qa-item {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
        }

        .qa-question {
            display: flex;
            gap: 10px;
        }

        .qa-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 13px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .qa-content {
            flex: 1;
        }

        .qa-author {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .qa-text {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .qa-meta {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #666;
        }

        .qa-meta span {
            cursor: pointer;
        }

        .qa-meta span:hover {
            color: var(--primary);
        }

        .qa-answer {
            background: var(--light);
            border-radius: 10px;
            padding: 12px;
            margin: 12px 0 0 46px;
        }

        .expert-badge {
            background: var(--success);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            margin-left: 8px;
        }

        /* ===== –û–¢–ó–´–í–´ ===== */
        .reviews-section {
            padding: 15px;
        }

        .reviews-summary {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .rating-big {
            font-size: 48px;
            font-weight: bold;
        }

        .rating-stars {
            font-size: 24px;
            margin: 10px 0;
        }

        .rating-count {
            font-size: 14px;
            color: #666;
        }

        .rating-bars {
            margin-top: 15px;
            text-align: left;
        }

        .rating-bar-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .rating-bar-label {
            width: 20px;
            font-size: 12px;
            text-align: center;
        }

        .rating-bar-track {
            flex: 1;
            height: 6px;
            background: var(--light);
            border-radius: 3px;
        }

        .rating-bar-fill {
            height: 100%;
            background: var(--gold);
            border-radius: 3px;
        }

        .review-item {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .review-author-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .review-stars {
            color: var(--gold);
            font-size: 14px;
        }

        .add-review-btn {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        /* ===== –ó–ê–ú–ï–¢–ö–ò ===== */
        .notes-section {
            padding: 15px;
        }

        .note-item {
            background: #fffde7;
            border-left: 4px solid var(--gold);
            padding: 12px;
            border-radius: 0 10px 10px 0;
            margin-bottom: 10px;
        }

        body.dark-mode .note-item {
            background: #3d3d00;
        }

        .note-timestamp {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .note-timestamp span {
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
        }

        .note-text {
            font-size: 14px;
            line-height: 1.5;
        }

        .note-actions {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }

        .note-action-btn {
            background: none;
            border: none;
            color: #666;
            font-size: 12px;
            cursor: pointer;
        }

        .add-note-fab {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--gold), #ffed4e);
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 50;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .add-note-fab.visible {
            display: flex;
        }

        /* ===== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ===== */
        .stats-section {
            padding: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .stat-card:active {
            transform: scale(0.98);
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .achievements-section {
            margin-top: 20px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
        }

        .see-all-btn {
            color: var(--primary);
            font-size: 14px;
            cursor: pointer;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .achievement-item {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px 8px;
            text-align: center;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }

        .achievement-item:active {
            transform: scale(0.95);
        }

        .achievement-item.locked {
            opacity: 0.4;
        }

        .achievement-item.unlocked {
            background: linear-gradient(135deg, #fff9e6, #ffecb3);
            border-color: var(--gold);
        }

        body.dark-mode .achievement-item.unlocked {
            background: linear-gradient(135deg, #3d3d00, #4a4a00);
        }

        .achievement-icon {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .achievement-name {
            font-size: 10px;
            color: #666;
        }

        /* ===== –ü–ê–ù–ï–õ–¨ –≠–ö–°–ü–ï–†–¢–ê ===== */
        .expert-dashboard {
            padding: 15px;
        }

        .subscription-card {
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .subscription-card.trial {
            background: linear-gradient(135deg, var(--warning), #f57c00);
            color: white;
        }

        .subscription-card.active {
            background: linear-gradient(135deg, var(--success), #388E3C);
            color: white;
        }

        .subscription-card.expired {
            background: linear-gradient(135deg, var(--danger), #d32f2f);
            color: white;
        }

        .subscription-card::after {
            content: 'üëë';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 40px;
            opacity: 0.3;
        }

        .sub-status {
            font-size: 12px;
            opacity: 0.9;
        }

        .sub-value {
            font-size: 20px;
            font-weight: bold;
            margin: 5px 0;
        }

        .sub-btn {
            background: rgba(255,255,255,0.3);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        .expert-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .expert-stat {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 12px;
            padding: 15px 10px;
            text-align: center;
        }

        .expert-stat-value {
            font-size: 20px;
            font-weight: bold;
        }

        .expert-stat-label {
            font-size: 10px;
            opacity: 0.9;
        }

        .create-course-btn {
            width: 100%;
            padding: 15px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        .create-course-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .my-courses-list {
            background: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .my-course-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }

        .my-course-item:last-child {
            border-bottom: none;
        }

        .my-course-thumb {
            width: 50px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .my-course-info {
            flex: 1;
        }

        .my-course-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .my-course-stats {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: #666;
        }

        .share-link-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* ===== –ü–†–û–ú–û–ö–û–î–´ ===== */
        .promo-section {
            padding: 15px;
        }

        .promo-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .promo-code {
            font-family: monospace;
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
        }

        .promo-info {
            flex: 1;
            margin-left: 15px;
        }

        .promo-discount {
            background: var(--success);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .promo-uses {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .create-promo-btn {
            width: 100%;
            padding: 15px;
            background: var(--light);
            border: 2px dashed var(--border);
            border-radius: 12px;
            color: #666;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        /* ===== –ê–ù–ê–õ–ò–¢–ò–ö–ê ===== */
        .analytics-section {
            padding: 15px;
        }

        .chart-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
        }

        .chart-period {
            background: var(--light);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            border: none;
            cursor: pointer;
            color: var(--text);
        }

        .chart-bars {
            display: flex;
            align-items: flex-end;
            gap: 8px;
            height: 100px;
        }

        .chart-bar {
            flex: 1;
            background: linear-gradient(to top, var(--primary), var(--secondary));
            border-radius: 4px 4px 0 0;
            min-height: 10px;
            transition: height 0.3s;
        }

        .chart-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 11px;
            color: #666;
        }

        .metric-big {
            text-align: center;
            padding: 20px;
        }

        .metric-value {
            font-size: 48px;
            font-weight: bold;
            color: var(--success);
        }

        .metric-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .metric-change {
            color: var(--success);
            font-size: 14px;
            margin-top: 10px;
        }

        /* ===== –ù–ò–ñ–ù–Ø–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            display: flex;
            padding: 8px;
            z-index: 100;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            padding: 8px 4px;
            background: transparent;
            border: none;
            cursor: pointer;
            color: #999;
            font-size: 10px;
            transition: all 0.2s;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-icon {
            font-size: 20px;
        }

/* ===== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê - –°–û–í–†–ï–ú–ï–ù–ù–´–ô –î–ò–ó–ê–ô–ù ===== */

.modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    display: none;
    align-items: flex-end;
    justify-content: center;
    z-index: 1000;
    padding: 0;
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
}

.modal.active {
    display: flex;
    animation: modalFadeIn 0.2s ease;
}

@keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-content {
    background: var(--card-bg);
    border-radius: 24px 24px 0 0;
    width: 100%;
    max-width: 480px;
    max-height: 92vh;
    display: flex;
    flex-direction: column;
    animation: modalSlideUp 0.35s cubic-bezier(0.32, 0.72, 0, 1);
    overflow: hidden;
}

@keyframes modalSlideUp {
    from {
        transform: translateY(100%);
    }
    to {
        transform: translateY(0);
    }
}

/* –ó–æ–Ω–∞ –¥–ª—è —Å–≤–∞–π–ø–∞ - –±–æ–ª—å—à–∞—è –∏ —É–¥–æ–±–Ω–∞—è */
.modal-drag-zone {
    padding: 12px 20px 8px;
    cursor: grab;
    touch-action: none;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.modal-drag-handle {
    width: 48px;
    height: 5px;
    background: var(--border);
    border-radius: 3px;
    margin-bottom: 8px;
    transition: all 0.2s;
}

.modal-drag-zone:active .modal-drag-handle {
    width: 56px;
    background: var(--text-secondary, #999);
}

/* –•–µ–¥–µ—Ä –º–æ–¥–∞–ª–∫–∏ */
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 20px 16px;
    border-bottom: 1px solid var(--border);
}

.modal-header-simple {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 20px 16px;
}

/* –ö–Ω–æ–ø–∫–∏ –≤ —Ö–µ–¥–µ—Ä–µ */
.modal-header-btn {
    padding: 8px 16px;
    border: none;
    background: transparent;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    border-radius: 10px;
    transition: all 0.2s;
    min-width: 70px;
}

.modal-header-btn.cancel {
    color: var(--primary);
}

.modal-header-btn.cancel:active {
    background: rgba(102, 126, 234, 0.1);
}

.modal-header-btn.save {
    color: white;
    background: var(--primary);
    font-weight: 600;
}

.modal-header-btn.save:active {
    background: var(--primary-dark, #5a6fd6);
    transform: scale(0.96);
}

.modal-header-btn.save:disabled {
    background: var(--border);
    color: var(--text-secondary, #999);
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
.modal-title {
    font-size: 17px;
    font-weight: 600;
    color: var(--text);
    text-align: center;
    flex: 1;
}

.modal-subtitle {
    font-size: 13px;
    color: var(--text-secondary, #999);
    text-align: center;
    margin-top: 2px;
}

/* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è - –±–æ–ª—å—à–∞—è –∏ —É–¥–æ–±–Ω–∞—è */
.modal-close {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--light);
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    color: var(--text-secondary, #666);
    transition: all 0.2s;
}

.modal-close:active {
    background: var(--border);
    transform: scale(0.9);
}

/* –¢–µ–ª–æ –º–æ–¥–∞–ª–∫–∏ */
.modal-body {
    flex: 1;
    overflow-y: auto;
    overscroll-behavior: contain;
    -webkit-overflow-scrolling: touch;
    padding: 20px;
}

.modal-body-no-padding {
    flex: 1;
    overflow-y: auto;
    overscroll-behavior: contain;
    -webkit-overflow-scrolling: touch;
}

/* –§—É—Ç–µ—Ä –º–æ–¥–∞–ª–∫–∏ */
.modal-footer {
    padding: 16px 20px;
    padding-bottom: calc(16px + env(safe-area-inset-bottom));
    border-top: 1px solid var(--border);
    background: var(--card-bg);
}

.modal-footer-buttons {
    display: flex;
    gap: 12px;
}

.modal-btn {
    flex: 1;
    padding: 16px;
    border: none;
    border-radius: 14px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.modal-btn.primary {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
}

.modal-btn.primary:active {
    transform: scale(0.98);
    opacity: 0.9;
}

.modal-btn.secondary {
    background: var(--light);
    color: var(--text);
}

.modal-btn.secondary:active {
    background: var(--border);
}

.modal-btn.danger {
    background: var(--danger);
    color: white;
}

.modal-btn.full {
    width: 100%;
}

/* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–∞–ª–∫–∏ (–¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –æ–∫–æ–Ω) */
.modal.modal-center {
    align-items: center;
    padding: 20px;
}

.modal.modal-center .modal-content {
    border-radius: 20px;
    max-height: 80vh;
    animation: modalScaleIn 0.25s cubic-bezier(0.32, 0.72, 0, 1);
}

@keyframes modalScaleIn {
    from {
        transform: scale(0.9);
        opacity: 0;
    }
    to {
        transform: scale(1);
        opacity: 1;
    }
}

.modal.modal-center .modal-drag-zone {
    display: none;
}

/* –ê–ª–µ—Ä—Ç/–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ */
.modal.modal-alert .modal-content {
    max-width: 320px;
    border-radius: 20px;
    text-align: center;
}

.modal-alert-icon {
    font-size: 48px;
    margin-bottom: 16px;
}

.modal-alert-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 8px;
}

.modal-alert-text {
    font-size: 14px;
    color: var(--text-secondary, #666);
    line-height: 1.5;
    margin-bottom: 20px;
}

.modal-alert-buttons {
    display: flex;
    gap: 12px;
}

/* ===== –°–ü–ï–¶–ò–§–ò–ß–ù–´–ï –ú–û–î–ê–õ–ö–ò ===== */

/* –ú–æ–¥–∞–ª–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π */
.achievements-modal-header {
    background: linear-gradient(135deg, var(--gold), #ffed4e);
    padding: 30px 20px;
    text-align: center;
    margin: -1px;
    border-radius: 24px 24px 0 0;
}

.achievements-modal-header h2 {
    font-size: 22px;
    margin-bottom: 5px;
    color: #333;
}

/* –ú–æ–¥–∞–ª–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ */
.pricing-modal .modal-content {
    max-height: 95vh;
}

.pricing-header {
    background: linear-gradient(135deg, var(--gold), #ffed4e);
    padding: 30px 20px 40px;
    text-align: center;
    position: relative;
    margin: -1px -1px 0;
    border-radius: 24px 24px 0 0;
}

.pricing-header::before {
    content: 'üëë';
    font-size: 48px;
    display: block;
    margin-bottom: 12px;
}

.pricing-header h2 {
    font-size: 24px;
    color: #333;
    margin-bottom: 8px;
}

.pricing-header p {
    font-size: 15px;
    color: #666;
}

/* –ú–æ–¥–∞–ª–∫–∞ –æ—Ç–∑—ã–≤–∞ */
.review-form {
    padding: 20px;
}

.rating-select {
    display: flex;
    justify-content: center;
    gap: 8px;
    padding: 20px 0;
}

.rating-star {
    font-size: 40px;
    cursor: pointer;
    transition: all 0.2s;
    filter: grayscale(100%);
    opacity: 0.4;
}

.rating-star:active {
    transform: scale(1.3);
}

.rating-star.selected {
    filter: none;
    opacity: 1;
    animation: starPop 0.3s ease;
}

@keyframes starPop {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
}

/* –ú–æ–¥–∞–ª–∫–∞ —á–∞—Ç–∞ */
.chat-modal-content {
    display: flex;
    flex-direction: column;
    height: 85vh;
    max-height: 700px;
}

.chat-header {
    padding: 16px 20px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    display: flex;
    align-items: center;
    gap: 12px;
    border-radius: 24px 24px 0 0;
}

.chat-header .modal-close {
    background: rgba(255, 255, 255, 0.2);
    color: white;
}

/* –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞ */
.promo-form {
    padding: 20px;
}

/* –ú–æ–¥–∞–ª–∫–∞ –∏–∫–æ–Ω–æ–∫ */
#iconPickerModal {
    align-items: center;
    padding: 20px;
}

#iconPickerModal .modal-content {
    max-width: 360px;
    border-radius: 20px;
}

.icon-picker-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 8px;
    padding: 20px;
}

.icon-item {
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    background: var(--light);
    border-radius: 14px;
    cursor: pointer;
    transition: all 0.2s;
}

.icon-item:active {
    transform: scale(0.9);
    background: var(--primary);
}

/* –ú–æ–¥–∞–ª–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ */
#certificateModal {
    align-items: center;
    padding: 20px;
}

#certificateModal .modal-content {
    border-radius: 20px;
    background: transparent;
    box-shadow: none;
}

.certificate {
    background: linear-gradient(135deg, #fffef0, #fff9e6);
    border: 6px solid var(--gold);
    border-radius: 20px;
    padding: 30px;
    text-align: center;
    position: relative;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
}

/* ===== –ü–û–õ–Ø –í–í–û–î–ê –í –ú–û–î–ê–õ–ö–ê–• ===== */

.modal-input-group {
    margin-bottom: 20px;
}

.modal-label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 8px;
}

.modal-input {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid var(--border);
    border-radius: 12px;
    font-size: 16px;
    background: var(--card-bg);
    color: var(--text);
    transition: all 0.2s;
    -webkit-appearance: none;
}

.modal-input:focus {
    outline: none;
    border-color: var(--primary);
}

.modal-textarea {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid var(--border);
    border-radius: 12px;
    font-size: 16px;
    background: var(--card-bg);
    color: var(--text);
    min-height: 120px;
    resize: none;
    font-family: inherit;
    transition: all 0.2s;
    -webkit-appearance: none;
}

.modal-textarea:focus {
    outline: none;
    border-color: var(--primary);
}

/* –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ–¥ –ø–æ–ª–µ–º */
.modal-input-hint {
    font-size: 13px;
    color: var(--text-secondary, #999);
    margin-top: 6px;
}

/* Toolbar –¥–ª—è –≤–≤–æ–¥–∞ (–Ω–∞–¥ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π) */
.input-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 16px;
    background: var(--light);
    border-top: 1px solid var(--border);
}

.input-toolbar-btn {
    padding: 8px 16px;
    border: none;
    background: transparent;
    color: var(--primary);
    font-size: 15px;
    font-weight: 500;
    cursor: pointer;
    border-radius: 8px;
}

.input-toolbar-btn:active {
    background: rgba(102, 126, 234, 0.1);
}

.input-toolbar-btn.done {
    font-weight: 600;
}

        /* ===== TOAST ===== */
        .toast {
            position: fixed;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card-bg);
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 3000;
            transition: top 0.3s;
            max-width: 90%;
            border: 1px solid var(--border);
        }

        .toast.show {
            top: 20px;
        }

        .toast-icon {
            font-size: 20px;
        }

        .toast-text {
            font-size: 14px;
        }

        /* ===== SUCCESS OVERLAY ===== */
        .success-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(76, 175, 80, 0.95);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            color: white;
            text-align: center;
        }

        .success-overlay.active {
            display: flex;
        }

        .success-checkmark {
            font-size: 80px;
            animation: bounceIn 0.6s;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .success-title {
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0 10px;
        }

        .success-text {
            font-size: 16px;
            opacity: 0.9;
        }

        /* ===== BLOCKED OVERLAY ===== */
        .blocked-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.95);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 50;
            padding: 40px;
            text-align: center;
        }

        body.dark-mode .blocked-overlay {
            background: rgba(26, 26, 46, 0.95);
        }

        .blocked-overlay.active {
            display: flex;
        }

        .blocked-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .blocked-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .blocked-text {
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .blocked-btn {
            background: linear-gradient(135deg, var(--gold), #ffed4e);
            color: #333;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        /* ===== –°–¢–†–ê–ù–ò–¶–´ ===== */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }
        /* ===== –°–¢–†–ê–ù–ò–¶–ê –ü–†–û–§–ò–õ–Ø ===== */
.profile-header {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    padding: 40px 20px;
    text-align: center;
    color: white;
}

.profile-avatar {
    width: 80px;
    height: 80px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
    margin: 0 auto 15px;
    border: 3px solid rgba(255,255,255,0.3);
}

.profile-name {
    font-size: 22px;
    font-weight: bold;
    margin-bottom: 5px;
}

.profile-email {
    font-size: 14px;
    opacity: 0.8;
}

.profile-stats {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-top: 20px;
}

.profile-stat {
    text-align: center;
}

.profile-stat-value {
    font-size: 24px;
    font-weight: bold;
}

.profile-stat-label {
    font-size: 12px;
    opacity: 0.8;
}

.profile-menu {
    padding: 15px;
}

.profile-menu-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 16px;
    background: var(--card-bg);
    border-radius: 12px;
    margin-bottom: 8px;
    cursor: pointer;
    border: 1px solid var(--border);
    transition: all 0.2s;
}

.profile-menu-item:active {
    transform: scale(0.98);
}

.profile-menu-item.expert-mode-btn {
    background: linear-gradient(135deg, #fff9e6, #ffecb3);
    border: 2px solid var(--gold);
}

body.dark-mode .profile-menu-item.expert-mode-btn {
    background: linear-gradient(135deg, #3d3d00, #4a4a00);
}

.profile-menu-item.logout {
    background: rgba(244, 67, 54, 0.1);
    border-color: var(--danger);
}

.profile-menu-icon {
    font-size: 24px;
    width: 40px;
    text-align: center;
}

.profile-menu-text {
    flex: 1;
}

.profile-menu-title {
    font-weight: 600;
    font-size: 15px;
    margin-bottom: 2px;
}

.profile-menu-desc {
    font-size: 12px;
    color: #666;
}

.profile-menu-arrow {
    font-size: 18px;
    color: #999;
}

.profile-menu-divider {
    height: 1px;
    background: var(--border);
    margin: 15px 0;
}

/* ===== –†–ï–ñ–ò–ú –≠–ö–°–ü–ï–†–¢–ê ===== */
.expert-mode-header {
    background: linear-gradient(135deg, var(--gold), #ffed4e);
    padding: 15px 20px;
    display: flex;
    align-items: center;
    gap: 15px;
}

.expert-back-btn {
    background: rgba(0,0,0,0.1);
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    color: #333;
}

.expert-mode-title {
    font-size: 18px;
    font-weight: bold;
    color: #333;
}

.expert-registration {
    padding: 40px 20px;
    text-align: center;
}

.expert-reg-icon {
    font-size: 64px;
    margin-bottom: 20px;
}

.expert-registration h2 {
    font-size: 24px;
    margin-bottom: 10px;
}

.expert-registration p {
    color: #666;
    margin-bottom: 30px;
}

.expert-benefits {
    text-align: left;
    max-width: 300px;
    margin: 0 auto 30px;
}

.benefit-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
    font-size: 14px;
}

.benefit-item span:first-child {
    font-size: 20px;
}

.become-expert-btn {
    width: 100%;
    max-width: 300px;
    padding: 16px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: transform 0.2s;
}

.become-expert-btn:active {
    transform: scale(0.98);
}

.expert-note {
    font-size: 12px;
    color: #999;
    margin-top: 15px;
}

/* –ü–∞–Ω–µ–ª—å —ç–∫—Å–ø–µ—Ä—Ç–∞ –≤–Ω—É—Ç—Ä–∏ —Ä–µ–∂–∏–º–∞ */
#expertPanel {
    padding-bottom: 20px;
}
/* ===== –ü–ê–ù–ï–õ–¨ –≠–ö–°–ü–ï–†–¢–ê (–ù–û–í–ê–Ø) ===== */
.expert-panel-tab {
    padding: 0;
}

.quick-actions {
    margin-top: 20px;
}

.quick-actions-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
}

.quick-action-item {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 15px 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
}

.quick-action-item:active {
    transform: scale(0.95);
}

.quick-action-icon {
    font-size: 24px;
    display: block;
    margin-bottom: 5px;
}

.quick-action-text {
    font-size: 11px;
    color: #666;
}

.quick-action-badge {
    position: absolute;
    top: 5px;
    right: 5px;
    background: var(--danger);
    color: white;
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 18px;
}

/* –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
.empty-state {
    text-align: center;
    padding: 40px 20px;
}

.empty-state.small {
    padding: 20px;
}

.empty-icon {
    font-size: 48px;
    margin-bottom: 15px;
    opacity: 0.5;
}

.empty-text {
    color: #666;
    font-size: 14px;
    margin-bottom: 15px;
}

.empty-btn {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 25px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
}

/* –ú–µ—Ç—Ä–∏–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ */
.metrics-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-bottom: 15px;
}

.metric-card {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
    text-align: center;
}

.metric-icon {
    font-size: 28px;
    margin-bottom: 8px;
}

.metric-value {
    font-size: 24px;
    font-weight: bold;
    color: var(--primary);
}

.metric-label {
    font-size: 12px;
    color: #666;
    margin-top: 4px;
}

.metric-change {
    font-size: 12px;
    margin-top: 8px;
    font-weight: 600;
}

.metric-change.positive {
    color: var(--success);
}

.metric-change.negative {
    color: var(--danger);
}

.metric-change.neutral {
    color: #666;
}

/* –¢–æ–ø –∫—É—Ä—Å—ã */
.top-courses-list {
    padding: 10px 0;
}

.top-course-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: var(--light);
    border-radius: 10px;
    margin-bottom: 8px;
}

.top-course-rank {
    width: 28px;
    height: 28px;
    background: var(--primary);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 12px;
}

.top-course-rank.gold {
    background: linear-gradient(135deg, var(--gold), #ffed4e);
    color: #333;
}

.top-course-info {
    flex: 1;
}

.top-course-title {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 2px;
}

.top-course-stats {
    font-size: 12px;
    color: #666;
}

.top-course-earnings {
    font-weight: bold;
    color: var(--success);
}

/* –ö–∞—Ä—Ç–æ—á–∫–∞ –∫—É—Ä—Å–∞ —ç–∫—Å–ø–µ—Ä—Ç–∞ */
.expert-course-card {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px;
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.2s;
}

.expert-course-card:active {
    transform: scale(0.98);
}

.expert-course-thumb {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
}

.expert-course-info {
    flex: 1;
}

.expert-course-title {
    font-weight: 600;
    font-size: 15px;
    margin-bottom: 4px;
}

.expert-course-meta {
    display: flex;
    gap: 12px;
    font-size: 12px;
    color: #666;
}

.expert-course-actions {
    display: flex;
    gap: 8px;
}

.expert-course-btn {
    width: 36px;
    height: 36px;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    font-size: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.expert-course-btn.edit {
    background: var(--light);
}

.expert-course-btn.share {
    background: var(--primary);
    color: white;
}

/* –ü—Ä–æ–º–æ–∫–æ–¥—ã */
.promo-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 10px;
}

.promo-code-text {
    font-family: monospace;
    font-size: 18px;
    font-weight: bold;
    color: var(--primary);
    background: var(--light);
    padding: 8px 16px;
    border-radius: 8px;
}

.promo-item-info {
    flex: 1;
}

.promo-item-discount {
    font-weight: bold;
    font-size: 16px;
    color: var(--success);
}

.promo-item-stats {
    font-size: 12px;
    color: #666;
    margin-top: 4px;
}

.promo-item-delete {
    background: none;
    border: none;
    font-size: 18px;
    cursor: pointer;
    padding: 8px;
}

/* ===== –†–ï–î–ê–ö–¢–û–† –ö–£–†–°–ê ===== */
.editor-header {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    padding: 15px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    color: white;
}

.editor-back-btn {
    background: rgba(255,255,255,0.2);
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    color: white;
}

.editor-title {
    font-size: 16px;
    font-weight: bold;
}

.editor-save-btn {
    background: rgba(255,255,255,0.2);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 18px;
    cursor: pointer;
}

.editor-tabs {
    display: flex;
    background: var(--card-bg);
    border-bottom: 1px solid var(--border);
    overflow-x: auto;
    scrollbar-width: none;
}

.editor-tabs::-webkit-scrollbar {
    display: none;
}

.editor-tab {
    flex: 1;
    min-width: 80px;
    padding: 14px 12px;
    border: none;
    background: transparent;
    font-size: 13px;
    font-weight: 500;
    color: #666;
    cursor: pointer;
    position: relative;
    white-space: nowrap;
    transition: all 0.2s;
}

.editor-tab.active {
    color: var(--primary);
    font-weight: 600;
}

.editor-tab.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--primary);
}

.editor-tab-content {
    padding: 0;
}

.editor-section {
    padding: 20px 15px;
}

.editor-field {
    margin-bottom: 20px;
}

.editor-label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text);
}

.editor-input {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid var(--border);
    border-radius: 12px;
    font-size: 15px;
    background: var(--card-bg);
    color: var(--text);
    transition: border-color 0.2s;
}

.editor-input:focus {
    outline: none;
    border-color: var(--primary);
}

.editor-textarea {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid var(--border);
    border-radius: 12px;
    font-size: 15px;
    background: var(--card-bg);
    color: var(--text);
    min-height: 100px;
    resize: vertical;
    font-family: inherit;
}

.editor-textarea.large {
    min-height: 200px;
}

.editor-textarea:focus {
    outline: none;
    border-color: var(--primary);
}

.editor-select {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid var(--border);
    border-radius: 12px;
    font-size: 15px;
    background: var(--card-bg);
    color: var(--text);
    cursor: pointer;
}

.field-hint {
    font-size: 12px;
    color: #666;
    margin-top: 6px;
}

/* –ò–∫–æ–Ω–∫–∞ –∫—É—Ä—Å–∞ */
.editor-icon-picker {
    text-align: center;
    margin-bottom: 25px;
}

.editor-icon-preview {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 24px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    cursor: pointer;
    transition: transform 0.2s;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.editor-icon-preview:active {
    transform: scale(0.95);
}

.editor-icon-hint {
    display: block;
    font-size: 12px;
    color: #666;
    margin-top: 8px;
}

/* –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ */
.editor-level-picker {
    display: flex;
    gap: 10px;
}

.level-option {
    flex: 1;
    padding: 15px 10px;
    border: 2px solid var(--border);
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
}

.level-option:hover {
    border-color: var(--primary);
}

.level-option.selected {
    border-color: var(--primary);
    background: rgba(102, 126, 234, 0.1);
}

.level-option span:first-child {
    font-size: 24px;
    display: block;
    margin-bottom: 5px;
}

.level-option span:last-child {
    font-size: 12px;
    font-weight: 600;
}

/* –£—Ä–æ–∫–∏ */
.add-lesson-btn {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    margin-bottom: 20px;
}

.lessons-editor-list {
    min-height: 200px;
}

.lesson-editor-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px;
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.2s;
}

.lesson-editor-item:active {
    transform: scale(0.98);
}

.lesson-drag-handle {
    color: #999;
    font-size: 18px;
    cursor: grab;
}

.lesson-editor-number {
    width: 32px;
    height: 32px;
    background: var(--primary);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 14px;
}

.lesson-editor-info {
    flex: 1;
}

.lesson-editor-title {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 2px;
}

.lesson-editor-meta {
    font-size: 12px;
    color: #666;
    display: flex;
    gap: 10px;
}

.lesson-editor-actions {
    display: flex;
    gap: 8px;
}

.lesson-action-btn {
    width: 32px;
    height: 32px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--light);
}

.lesson-action-btn.delete {
    background: rgba(244, 67, 54, 0.1);
}

/* –¶–µ–Ω–∞ */
.access-type-picker {
    display: flex;
    gap: 10px;
}

.access-option {
    flex: 1;
    padding: 20px;
    border: 2px solid var(--border);
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
}

.access-option.selected {
    border-color: var(--primary);
    background: rgba(102, 126, 234, 0.1);
}

.access-icon {
    font-size: 32px;
    display: block;
    margin-bottom: 8px;
}

.access-name {
    font-weight: 600;
}

.price-input-wrapper {
    position: relative;
}

.price-input {
    padding-right: 50px;
}

.price-currency {
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 18px;
}

.price-hint {
    font-size: 12px;
    color: #666;
    margin-top: 6px;
}

.price-preview {
    background: var(--light);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    margin-top: 20px;
}

.price-preview-label {
    font-size: 12px;
    color: #666;
    margin-bottom: 10px;
}

.price-preview-value .price-new {
    font-size: 28px;
    font-weight: bold;
    color: var(--primary);
}

.price-preview-value .price-old {
    font-size: 18px;
    color: #999;
    text-decoration: line-through;
    margin-left: 10px;
}

/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
.status-picker {
    display: flex;
    gap: 10px;
}

.status-option {
    flex: 1;
    padding: 20px 15px;
    border: 2px solid var(--border);
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
}

.status-option.selected {
    border-color: var(--primary);
}

.status-option.draft.selected {
    background: rgba(255, 152, 0, 0.1);
    border-color: var(--warning);
}

.status-option.published.selected {
    background: rgba(76, 175, 80, 0.1);
    border-color: var(--success);
}

.status-option span:first-child {
    font-size: 28px;
    display: block;
    margin-bottom: 5px;
}

.status-option span:nth-child(2) {
    font-weight: 600;
    display: block;
}

.status-option small {
    font-size: 11px;
    color: #666;
}

/* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ */
.editor-toggle-field {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px;
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 12px;
}

.toggle-info {
    flex: 1;
}

.toggle-title {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 2px;
}

.toggle-desc {
    font-size: 12px;
    color: #666;
}

.toggle-switch {
    position: relative;
    width: 50px;
    height: 28px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: #ccc;
    border-radius: 28px;
    transition: 0.3s;
}

.toggle-slider::before {
    position: absolute;
    content: '';
    height: 22px;
    width: 22px;
    left: 3px;
    bottom: 3px;
    background: white;
    border-radius: 50%;
    transition: 0.3s;
}

.toggle-switch input:checked + .toggle-slider {
    background: var(--success);
}

.toggle-switch input:checked + .toggle-slider::before {
    transform: translateX(22px);
}

/* –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞ */
.danger-zone {
    margin-top: 30px;
    padding: 20px;
    background: rgba(244, 67, 54, 0.05);
    border: 1px solid rgba(244, 67, 54, 0.2);
    border-radius: 12px;
}

.danger-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--danger);
    margin-bottom: 15px;
}

.delete-course-btn {
    width: 100%;
    padding: 14px;
    background: var(--danger);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
}

/* –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —É—Ä–æ–∫–∞ */
.lesson-editor-modal {
    max-height: 90vh;
    display: flex;
    flex-direction: column;
}

.lesson-editor-body {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
}

.lesson-editor-footer {
    padding: 15px 20px;
    border-top: 1px solid var(--border);
    display: flex;
    gap: 10px;
}

.editor-cancel-btn {
    flex: 1;
    padding: 14px;
    background: var(--light);
    border: none;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    color: var(--text);
}

.editor-submit-btn {
    flex: 2;
    padding: 14px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
}

/* –¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
.content-type-picker {
    display: flex;
    gap: 10px;
}

.content-type {
    flex: 1;
    padding: 15px 10px;
    border: 2px solid var(--border);
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
}

.content-type:hover {
    border-color: var(--primary);
}

.content-type.selected {
    border-color: var(--primary);
    background: rgba(102, 126, 234, 0.1);
}

.content-type span:first-child {
    font-size: 24px;
    display: block;
    margin-bottom: 5px;
}

.content-type span:last-child {
    font-size: 12px;
    font-weight: 600;
}

/* –†–µ–¥–∞–∫—Ç–æ—Ä —Ç–µ—Å—Ç–∞ */
.quiz-questions-list {
    margin-bottom: 15px;
}

.quiz-question-item {
    background: var(--light);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 12px;
}

.quiz-question-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.quiz-question-number {
    font-weight: 600;
    font-size: 14px;
}

.quiz-question-delete {
    background: none;
    border: none;
    font-size: 16px;
    cursor: pointer;
    padding: 5px;
}

.quiz-question-input {
    width: 100%;
    padding: 12px;
    border: 2px solid var(--border);
    border-radius: 10px;
    font-size: 14px;
    margin-bottom: 10px;
    background: var(--card-bg);
    color: var(--text);
}

.quiz-options-list {
    display: grid;
    gap: 8px;
}

.quiz-option-row {
    display: flex;
    gap: 8px;
    align-items: center;
}

.quiz-option-input {
    flex: 1;
    padding: 10px 12px;
    border: 2px solid var(--border);
    border-radius: 8px;
    font-size: 14px;
    background: var(--card-bg);
    color: var(--text);
}

.quiz-correct-btn {
    width: 36px;
    height: 36px;
    border: 2px solid var(--border);
    border-radius: 50%;
    background: var(--card-bg);
    cursor: pointer;
    font-size: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.quiz-correct-btn.selected {
    background: var(--success);
    border-color: var(--success);
    color: white;
}

.add-question-btn {
    width: 100%;
    padding: 14px;
    background: var(--light);
    border: 2px dashed var(--border);
    border-radius: 12px;
    font-size: 14px;
    cursor: pointer;
    color: #666;
}

/* –í—ã–±–æ—Ä –∏–∫–æ–Ω–∫–∏ */
.icon-picker-modal {
    max-width: 340px;
}

.icon-picker-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 10px;
    padding: 20px;
}

.icon-item {
    width: 100%;
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    background: var(--light);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s;
}

.icon-item:hover {
    background: var(--primary);
    transform: scale(1.1);
}

.icon-item:active {
    transform: scale(0.95);
}

/* ===== TELEGRAM MINI APP –ê–î–ê–ü–¢–ê–¶–ò–Ø ===== */

/* –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å –≤—ã—Ä–µ–∑–æ–º */
.container {
    padding-top: env(safe-area-inset-top);
}

header {
    padding-top: calc(15px + env(safe-area-inset-top));
}

.bottom-nav {
    padding-bottom: calc(8px + env(safe-area-inset-bottom));
}

/* –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ pull-to-refresh */
.page {
    overscroll-behavior: contain;
    height: 100%;
    overflow-y: auto;
}

/* –§–∏–∫—Å –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü */
.page.active {
    display: flex;
    flex-direction: column;
    height: calc(100% - 60px);
    overflow-y: auto;
    overscroll-behavior-y: contain;
}

#mainPage.active,
#profilePage.active,
#expertModePage.active,
#courseEditorPage.active {
    display: block;
    height: auto;
    min-height: calc(100vh - 140px);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

#coursePage.active {
    display: block;
}

/* ===== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê - –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï ===== */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: none;
    align-items: flex-end; /* –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–Ω–∏–∑—É –∫–∞–∫ –≤ Telegram */
    justify-content: center;
    z-index: 1000;
    padding: 0;
    overscroll-behavior: contain;
}

.modal.active {
    display: flex;
    animation: fadeIn 0.2s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-content {
    background: var(--card-bg);
    border-radius: 20px 20px 0 0;
    width: 100%;
    max-width: 480px;
    max-height: 90vh;
    overflow-y: auto;
    overscroll-behavior: contain;
    animation: slideUp 0.3s ease;
    -webkit-overflow-scrolling: touch;
}

@keyframes slideUp {
    from {
        transform: translateY(100%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

/* –ü–æ–ª–æ—Å–∫–∞ –¥–ª—è —Å–≤–∞–π–ø–∞ –º–æ–¥–∞–ª–∫–∏ */
.modal-content::before {
    content: '';
    display: block;
    width: 40px;
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    margin: 12px auto;
}

/* –ú–æ–¥–∞–ª–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ —Ü–µ–Ω—Ç—Ä—É */
.modal.center-modal .modal-content,
#iconPickerModal .modal-content,
#certificateModal .modal-content {
    border-radius: 20px;
    max-height: 80vh;
    margin: auto;
    animation: scaleIn 0.2s ease;
}

#iconPickerModal .modal-content::before,
#certificateModal .modal-content::before {
    display: none;
}

@keyframes scaleIn {
    from {
        transform: scale(0.9);
        opacity: 0;
    }
    to {
        transform: scale(1);
        opacity: 1;
    }
}

.modal.center-modal {
    align-items: center;
    padding: 20px;
}

#iconPickerModal,
#certificateModal {
    align-items: center;
    padding: 20px;
}

/* ===== –§–ò–ö–° –°–ö–†–û–õ–õ–ê –í–ù–£–¢–†–ò –ú–û–î–ê–õ–û–ö ===== */
.modal-body,
.achievements-list,
.messages-list,
.lesson-editor-body,
.pricing-plans {
    overflow-y: auto;
    overscroll-behavior: contain;
    -webkit-overflow-scrolling: touch;
    max-height: 60vh;
}

#studentsList {
    max-height: 50vh;
    overflow-y: auto;
    overscroll-behavior: contain;
}

/* ===== –•–ï–î–ï–† –†–ï–ñ–ò–ú–ê –≠–ö–°–ü–ï–†–¢–ê ===== */
.expert-mode-header {
    position: sticky;
    top: 0;
    z-index: 50;
    background: linear-gradient(135deg, var(--gold), #ffed4e);
    padding: 15px 20px;
    padding-top: calc(15px + env(safe-area-inset-top));
}

.editor-header {
    position: sticky;
    top: 0;
    z-index: 50;
    padding-top: calc(15px + env(safe-area-inset-top));
}

/* ===== TELEGRAM GRAB HANDLE (–ø–æ–ª–æ—Å–∫–∞ —Å–≤–µ—Ä—Ö—É) ===== */
.tg-grab-handle {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: env(safe-area-inset-top, 20px);
    min-height: 20px;
    background: transparent;
    z-index: 9999;
    touch-action: none;
}

/* ===== –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–ï –†–ï–ó–ò–ù–ö–ò ===== */
.courses-grid,
.lessons-list,
.reviews-section,
.qa-section,
.notes-section,
.stats-section,
.expert-dashboard,
.promo-section,
.analytics-section,
.profile-menu,
.editor-section {
    overscroll-behavior: contain;
}

/* ===== –£–õ–£–ß–®–ï–ù–ù–´–ï –¢–ê–ë–´ ===== */
.tabs,
.lesson-tabs,
.editor-tabs {
    position: sticky;
    top: 0;
    z-index: 40;
    background: var(--card-bg);
}

/* ===== –ü–õ–ê–í–ù–´–ô –°–ö–†–û–õ–õ ===== */
* {
    scroll-behavior: smooth;
}

/* ===== –§–ò–ö–° –î–õ–Ø –í–ò–î–ï–û–ü–õ–ï–ï–†–ê ===== */
.video-player {
    position: sticky;
    top: 0;
    z-index: 30;
}

/* ===== –ü–†–ê–í–ò–õ–¨–ù–´–ï –û–¢–°–¢–£–ü–´ –î–õ–Ø –ö–û–ù–¢–ï–ù–¢–ê ===== */
#coursePage .lesson-content {
    min-height: calc(100vh - 400px);
    padding-bottom: 100px;
}

/* ===== –§–ò–ö–° –ö–õ–ê–í–ò–ê–¢–£–†–´ ===== */
@supports (height: 100dvh) {
    html, body {
        height: 100dvh;
    }
    
    .container {
        height: 100dvh;
    }
}

/* –û–ø—Ü–∏–∏ —Å–∫–∏–¥–æ–∫ */
.discount-options {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
}

.discount-option {
    padding: 14px 10px;
    border: 2px solid var(--border);
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    font-weight: 600;
    font-size: 15px;
    transition: all 0.2s;
    background: var(--card-bg);
    color: var(--text);
}

.discount-option:active {
    transform: scale(0.95);
}

.discount-option.selected {
    border-color: var(--primary);
    background: rgba(102, 126, 234, 0.1);
    color: var(--primary);
}
    </style>
</head>
<body>

<!-- –≠–ö–†–ê–ù –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò -->
<div class="auth-screen" id="authScreen">
    <div class="auth-wrapper">
        <div class="auth-logo">üìö</div>
    <div class="auth-title">EduGram</div>
    <div class="auth-subtitle">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –∏ —É—á–µ–Ω–∏–∫–æ–≤</div>
    
    <div class="auth-card">
        <div class="auth-tabs">
            <button class="auth-tab active" onclick="switchAuthTab('login')">–í—Ö–æ–¥</button>
            <button class="auth-tab" onclick="switchAuthTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>
        
        <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
        <div class="auth-form active" id="loginForm">
            <div class="auth-input-group">
                <label class="auth-label">Email</label>
                <input type="email" class="auth-input" id="loginEmail" placeholder="email@example.com">
            </div>
            <div class="auth-input-group">
                <label class="auth-label">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" class="auth-input" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button class="auth-submit" onclick="handleLogin()">–í–æ–π—Ç–∏</button>
            
            <div class="auth-divider"><span>–∏–ª–∏</span></div>
            
            <button class="auth-telegram-btn" onclick="loginWithTelegram()">
                <span>üì±</span> –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram
            </button>
        </div>
        
        <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
        <div class="auth-form" id="registerForm">
            <div class="auth-input-group">
                <label class="auth-label">–í–∞—à–µ –∏–º—è</label>
                <input type="text" class="auth-input" id="registerName" placeholder="–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤">
            </div>
            <div class="auth-input-group">
                <label class="auth-label">Email</label>
                <input type="email" class="auth-input" id="registerEmail" placeholder="email@example.com">
            </div>
            <div class="auth-input-group">
                <label class="auth-label">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" class="auth-input" id="registerPassword" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤">
            </div>
            
        
            
            <button class="auth-submit" onclick="handleRegister()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
            
            <div class="auth-divider"><span>–∏–ª–∏</span></div>
            
            <button class="auth-telegram-btn" onclick="loginWithTelegram()">
                <span>üì±</span> –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
            </button>
        </div>
        
        <div class="auth-footer">
            –ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å <a href="#">—É—Å–ª–æ–≤–∏—è–º–∏</a>
                </div>
    </div>
    </div> <!-- –ó–∞–∫—Ä—ã–≤–∞–µ–º auth-wrapper -->
</div>

<div class="container">
    <!-- –•–ï–î–ï–† -->
    <header>
        <div class="header-top">
            <div class="header-left">
                <button class="back-btn" id="backBtn" onclick="goBack()">‚Üê</button>
                <div class="logo" id="headerTitle">üìö EduGram</div>
            </div>
            
            <!-- –•–µ–¥–µ—Ä –¥–ª—è –£–ß–ï–ù–ò–ö–ê -->
            <div class="header-actions" id="headerStudent">
                <div class="streak-badge" onclick="showStreakInfo()">
                    üî• <span id="streakCount">7</span>
                </div>
                <div class="user-xp" onclick="showAchievementsModal()">
                    üèÜ <span class="xp-value" id="userXP">1,250</span>
                    <span class="user-level" id="userLevel">LVL 5</span>
                </div>
                <button class="header-btn" onclick="toggleDarkMode()">üåô</button>
            </div>
            
            <!-- –•–µ–¥–µ—Ä –¥–ª—è –≠–ö–°–ü–ï–†–¢–ê -->
            <div class="header-actions" id="headerExpert" style="display: none;">
                <div class="expert-header-stat" onclick="showStudentsModal()">
                    üë• <span id="headerStudentsCount">234</span>
                </div>
                <div class="expert-header-messages" onclick="showMessagesModal()">
                    üí¨
                    <span class="messages-badge" id="messagesBadge">5</span>
                </div>
                <button class="header-btn" onclick="toggleDarkMode()">üåô</button>
            </div>
        </div>
    </header>

    <!-- –ë–ê–ù–ù–ï–† –ü–û–î–ü–ò–°–ö–ò -->
    <div class="subscription-banner trial" id="subBanner" style="display: none;" onclick="showSubscriptionModal()">
        <div class="banner-text">
            <span>‚è∞</span>
            <span id="bannerText">–ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥: 10 –¥–Ω–µ–π</span>
        </div>
        <button class="banner-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
    </div>

    <!-- ===== –ì–õ–ê–í–ù–ê–Ø –°–¢–†–ê–ù–ò–¶–ê ===== -->
    <div id="mainPage" class="page active">
        

        <!-- === –†–ï–ñ–ò–ú –£–ß–ï–ù–ò–ö–ê === -->
        <div id="studentMode">
            <div class="tabs">
                <button class="tab active" onclick="switchStudentTab('catalog')">üè™ –ö–∞—Ç–∞–ª–æ–≥</button>
                <button class="tab" onclick="switchStudentTab('myCourses')">üìö –ú–æ–∏ –∫—É—Ä—Å—ã</button>
                <button class="tab" onclick="switchStudentTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            </div>

            <div id="catalogTab" class="tab-content">
                <div class="courses-grid" id="catalogCourses"></div>
            </div>

            <div id="myCoursesTab" class="tab-content" style="display: none;">
                <div class="courses-grid" id="purchasedCourses">
                    <p style="text-align: center; color: #666; padding: 40px;">
                        –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫—É—Ä—Å–æ–≤.<br>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–∞—Ç–∞–ª–æ–≥!
                    </p>
                </div>
            </div>

            <div id="statsTab" class="tab-content" style="display: none;">
                <div class="stats-section">
                    <div class="stats-grid">
                        <div class="stat-card" onclick="showAchievementsModal()">
                            <div class="stat-icon">üèÜ</div>
                            <div class="stat-value" id="statXP">1,250</div>
                            <div class="stat-label">–û—á–∫–∏ XP</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìö</div>
                            <div class="stat-value" id="statCourses">0</div>
                            <div class="stat-label">–ö—É—Ä—Å–æ–≤</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚è±</div>
                            <div class="stat-value">12—á</div>
                            <div class="stat-label">–í—Ä–µ–º–µ–Ω–∏</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üî•</div>
                            <div class="stat-value" id="statStreak">7</div>
                            <div class="stat-label">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
                        </div>
                    </div>
                    <div class="achievements-section">
                        <div class="section-header">
                            <span class="section-title">üèÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</span>
                            <span class="see-all-btn" onclick="showAchievementsModal()">–í—Å–µ ‚Üí</span>
                        </div>
                        <div class="achievements-grid" id="achievementsPreview"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- === –†–ï–ñ–ò–ú –≠–ö–°–ü–ï–†–¢–ê === -->
        <div id="expertMode" style="display: none; position: relative;">
            <div class="blocked-overlay" id="blockedOverlay">
                <div class="blocked-icon">üîí</div>
                <div class="blocked-title">–ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞</div>
                <div class="blocked-text">–ü—Ä–æ–¥–ª–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤</div>
                <button class="blocked-btn" onclick="showSubscriptionModal()">üëë –ü—Ä–æ–¥–ª–∏—Ç—å</button>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchExpertTab('dashboard')">üìä –ü–∞–Ω–µ–ª—å</button>
                <button class="tab" onclick="switchExpertTab('myCourses')">üìö –ö—É—Ä—Å—ã</button>
                <button class="tab" onclick="switchExpertTab('promo')">üè∑Ô∏è –ü—Ä–æ–º–æ</button>
                <button class="tab" onclick="switchExpertTab('analytics')">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
            </div>

            <div id="dashboardTab" class="expert-tab-content">
                <div class="expert-dashboard">
                    <div class="subscription-card trial" id="subCard" onclick="showSubscriptionModal()">
                        <div class="sub-status">–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏</div>
                        <div class="sub-value" id="subStatus">–ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥: 10 –¥–Ω–µ–π</div>
                        <button class="sub-btn">–£–ª—É—á—à–∏—Ç—å –ø–ª–∞–Ω ‚Üí</button>
                    </div>

                    <div class="expert-stats">
                        <div class="expert-stat">
                            <div class="expert-stat-value">45.6K ‚≠ê</div>
                            <div class="expert-stat-label">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                        </div>
                        <div class="expert-stat">
                            <div class="expert-stat-value" id="expertStudentsCount">234</div>
                            <div class="expert-stat-label">–£—á–µ–Ω–∏–∫–æ–≤</div>
                        </div>
                        <div class="expert-stat">
                            <div class="expert-stat-value" id="expertCoursesCount">2</div>
                            <div class="expert-stat-label">–ö—É—Ä—Å–æ–≤</div>
                        </div>
                    </div>

                    <button class="create-course-btn" id="createCourseBtn" onclick="createCourse()">
                        ‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫—É—Ä—Å
                    </button>

                    <div class="section-header">
                        <span class="section-title">üìö –ú–æ–∏ –∫—É—Ä—Å—ã</span>
                    </div>
                    <div class="my-courses-list" id="expertCoursesList"></div>
                </div>
            </div>

            <div id="myCoursesExpertTab" class="expert-tab-content" style="display: none;">
                <div style="padding: 15px;">
                    <button class="create-course-btn" onclick="createCourse()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—Å</button>
                    <div id="expertCoursesFullList"></div>
                </div>
            </div>

            <div id="promoTab" class="expert-tab-content" style="display: none;">
                <div class="promo-section">
                    <div class="section-header">
                        <span class="section-title">üè∑Ô∏è –ü—Ä–æ–º–æ–∫–æ–¥—ã</span>
                    </div>
                    <div id="promoList"></div>
                    <button class="create-promo-btn" onclick="showCreatePromoModal()">‚ûï –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
                </div>
            </div>

            <div id="analyticsTab" class="expert-tab-content" style="display: none;">
                <div class="analytics-section">
                    <div class="chart-card">
                        <div class="chart-header">
                            <span class="chart-title">üí∞ –ü—Ä–æ–¥–∞–∂–∏</span>
                            <select class="chart-period">
                                <option>7 –¥–Ω–µ–π</option>
                                <option>30 –¥–Ω–µ–π</option>
                            </select>
                        </div>
                        <div class="chart-bars">
                            <div class="chart-bar" style="height: 40%;"></div>
                            <div class="chart-bar" style="height: 65%;"></div>
                            <div class="chart-bar" style="height: 45%;"></div>
                            <div class="chart-bar" style="height: 80%;"></div>
                            <div class="chart-bar" style="height: 55%;"></div>
                            <div class="chart-bar" style="height: 90%;"></div>
                            <div class="chart-bar" style="height: 100%;"></div>
                        </div>
                        <div class="chart-labels">
                            <span>–ü–Ω</span><span>–í—Ç</span><span>–°—Ä</span><span>–ß—Ç</span><span>–ü—Ç</span><span>–°–±</span><span>–í—Å</span>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <span class="chart-title">üìä –ö–æ–Ω–≤–µ—Ä—Å–∏—è</span>
                        </div>
                        <div class="metric-big">
                            <div class="metric-value">12.4%</div>
                            <div class="metric-label">–∏–∑ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –≤ –ø–æ–∫—É–ø–∫–∏</div>
                            <div class="metric-change">‚Üë 2.3% –∑–∞ –Ω–µ–¥–µ–ª—é</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== –°–¢–†–ê–ù–ò–¶–ê –ö–£–†–°–ê ===== -->
    <div id="coursePage" class="page">
        <div class="video-player">
            <div class="video-placeholder" id="videoPlaceholder">
                <div class="play-btn" onclick="toggleVideo()">‚ñ∂Ô∏è</div>
                <div id="currentLessonTitle">–£—Ä–æ–∫ 1: –í–≤–µ–¥–µ–Ω–∏–µ</div>
            </div>
            <div class="video-controls">
                <button class="video-control-btn" id="playPauseBtn" onclick="toggleVideo()">‚ñ∂Ô∏è</button>
                <div class="progress-bar" onclick="seekVideo(event)">
                    <div class="progress-fill" id="videoProgress"></div>
                </div>
                <span class="video-time" id="videoTime">00:00 / 15:30</span>
            </div>
        </div>

        <div class="course-progress">
            <div class="progress-header">
                <span class="progress-title">üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –∫—É—Ä—Å–∞</span>
                <span class="progress-percent" id="courseProgressPercent">0%</span>
            </div>
            <div class="progress-bar-full">
                <div class="progress-bar-fill" id="courseProgressBar" style="width: 0%;"></div>
            </div>
        </div>

        <div class="lesson-tabs">
            <button class="lesson-tab active" onclick="switchLessonTab('lessons')">üìö –£—Ä–æ–∫–∏</button>
            <button class="lesson-tab" onclick="switchLessonTab('quiz')">üìù –¢–µ—Å—Ç</button>
            <button class="lesson-tab" onclick="switchLessonTab('qa')">‚ùì Q&A</button>
            <button class="lesson-tab" onclick="switchLessonTab('reviews')">‚≠ê –û—Ç–∑—ã–≤—ã</button>
            <button class="lesson-tab" onclick="switchLessonTab('notes')">üìå –ó–∞–º–µ—Ç–∫–∏</button>
        </div>

        <div id="lessonsContent" class="lesson-content">
            <div class="lessons-list" id="lessonsList"></div>
        </div>

        <div id="quizContent" class="lesson-content" style="display: none;">
            <div class="quiz-card">
                <div class="quiz-progress-header">
                    <span>–í–æ–ø—Ä–æ—Å <span id="quizQuestionNum">1</span>/5</span>
                    <span class="quiz-timer">‚è± 00:30</span>
                </div>
                <div class="quiz-question" id="quizQuestion"></div>
                <div class="quiz-options" id="quizOptions"></div>
                <button class="quiz-submit-btn" onclick="submitQuizAnswer()">–û—Ç–≤–µ—Ç–∏—Ç—å ‚Üí</button>
            </div>
        </div>

        <div id="qaContent" class="lesson-content" style="display: none;">
            <div class="qa-section">
                <div class="qa-header">
                    <span class="qa-title">‚ùì –í–æ–ø—Ä–æ—Å—ã</span>
                    <span class="qa-count" id="qaCount">24</span>
                </div>
                <div class="qa-input-box">
                    <input type="text" class="qa-input" placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å..." id="qaInput">
                    <button class="qa-send-btn" onclick="sendQuestion()">‚û§</button>
                </div>
                <div id="qaList"></div>
            </div>
        </div>

        <div id="reviewsContent" class="lesson-content" style="display: none;">
            <div class="reviews-section">
                <div class="reviews-summary">
                    <div class="rating-big">4.8</div>
                    <div class="rating-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    <div class="rating-count">234 –æ—Ç–∑—ã–≤–∞</div>
                </div>
                <div id="reviewsList"></div>
                <button class="add-review-btn" onclick="showReviewModal()">‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –æ—Ç–∑—ã–≤</button>
            </div>
        </div>

        <div id="notesContent" class="lesson-content" style="display: none;">
            <div class="notes-section">
                <div id="notesList"></div>
            </div>
        </div>

        <button class="add-note-fab" id="addNoteFab" onclick="showAddNoteModal()">üìù</button>
    </div>
    <!-- ===== –°–¢–†–ê–ù–ò–¶–ê –ü–†–û–§–ò–õ–Ø ===== -->
    <div id="profilePage" class="page">
        <div class="profile-header">
            <div class="profile-avatar" id="profileAvatar">üë§</div>
            <div class="profile-name" id="profileName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
            <div class="profile-email" id="profileEmail">email@example.com</div>
            <div class="profile-stats">
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profileXP">0</div>
                    <div class="profile-stat-label">XP</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profileCourses">0</div>
                    <div class="profile-stat-label">–ö—É—Ä—Å–æ–≤</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profileStreak">0</div>
                    <div class="profile-stat-label">–î–Ω–µ–π</div>
                </div>
            </div>
        </div>

        <div class="profile-menu">
            <!-- –ö–Ω–æ–ø–∫–∞ —Ä–µ–∂–∏–º–∞ —ç–∫—Å–ø–µ—Ä—Ç–∞ -->
            <div class="profile-menu-item expert-mode-btn" id="expertModeBtn" onclick="openExpertMode()">
                <span class="profile-menu-icon">üë®‚Äçüè´</span>
                <div class="profile-menu-text">
                    <div class="profile-menu-title" id="expertBtnTitle">–°—Ç–∞—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–æ–º</div>
                    <div class="profile-menu-desc" id="expertBtnDesc">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏ –ø—Ä–æ–¥–∞–≤–∞–π—Ç–µ –∫—É—Ä—Å—ã</div>
                </div>
                <span class="profile-menu-arrow">‚Üí</span>
            </div>

            <div class="profile-menu-divider"></div>

            <div class="profile-menu-item" onclick="showAchievementsModal()">
                <span class="profile-menu-icon">üèÜ</span>
                <div class="profile-menu-text">
                    <div class="profile-menu-title">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
                    <div class="profile-menu-desc">–í–∞—à–∏ –Ω–∞–≥—Ä–∞–¥—ã –∏ XP</div>
                </div>
                <span class="profile-menu-arrow">‚Üí</span>
            </div>

            <div class="profile-menu-item" onclick="showMyPurchases()">
                <span class="profile-menu-icon">üìö</span>
                <div class="profile-menu-text">
                    <div class="profile-menu-title">–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏</div>
                    <div class="profile-menu-desc">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫ –∫—É—Ä—Å–æ–≤</div>
                </div>
                <span class="profile-menu-arrow">‚Üí</span>
            </div>

            <div class="profile-menu-item" onclick="showSettings()">
                <span class="profile-menu-icon">‚öôÔ∏è</span>
                <div class="profile-menu-text">
                    <div class="profile-menu-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                    <div class="profile-menu-desc">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, —Ç–µ–º–∞, —è–∑—ã–∫</div>
                </div>
                <span class="profile-menu-arrow">‚Üí</span>
            </div>

            <div class="profile-menu-divider"></div>

            <div class="profile-menu-item logout" onclick="logout()">
                <span class="profile-menu-icon">üö™</span>
                <div class="profile-menu-text">
                    <div class="profile-menu-title">–í—ã–π—Ç–∏</div>
                    <div class="profile-menu-desc">–í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== –†–ï–ñ–ò–ú –≠–ö–°–ü–ï–†–¢–ê (–æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω) ===== -->
    <div id="expertModePage" class="page">
        <!-- –•–µ–¥–µ—Ä —Ä–µ–∂–∏–º–∞ —ç–∫—Å–ø–µ—Ä—Ç–∞ -->
        <div class="expert-mode-header">
            <button class="expert-back-btn" onclick="closeExpertMode()">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="expert-mode-title">üë®‚Äçüè´ –†–µ–∂–∏–º —ç–∫—Å–ø–µ—Ä—Ç–∞</div>
        </div>

        <!-- –ï—Å–ª–∏ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ —ç–∫—Å–ø–µ—Ä—Ç -->
        <div id="expertRegistration" class="expert-registration">
            <div class="expert-reg-icon">üë®‚Äçüè´</div>
            <h2>–°—Ç–∞–Ω—å—Ç–µ —ç–∫—Å–ø–µ—Ä—Ç–æ–º</h2>
            <p>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫—É—Ä—Å—ã –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ</p>
            
            <div class="expert-benefits">
                <div class="benefit-item">
                    <span>üí∞</span>
                    <span>–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –Ω–∞ —Å–≤–æ–∏—Ö –∑–Ω–∞–Ω–∏—è—Ö</span>
                </div>
                <div class="benefit-item">
                    <span>üë•</span>
                    <span>–ù–∞–±–∏—Ä–∞–π—Ç–µ –∞—É–¥–∏—Ç–æ—Ä–∏—é</span>
                </div>
                <div class="benefit-item">
                    <span>üìä</span>
                    <span>–ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
                </div>
                <div class="benefit-item">
                    <span>üéÅ</span>
                    <span>10 –¥–Ω–µ–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                </div>
            </div>

            <button class="become-expert-btn" onclick="registerAsExpert()">
                üöÄ –ù–∞—á–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ
            </button>
            
            <p class="expert-note">–ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ 10 –¥–Ω–µ–π, –ø–æ—Ç–æ–º –æ—Ç 990‚ÇΩ/–º–µ—Å</p>
        </div>

        <!-- –ï—Å–ª–∏ —É–∂–µ —ç–∫—Å–ø–µ—Ä—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å -->
<div id="expertPanel" style="display: none;">
    
    <!-- –¢–∞–±—ã —ç–∫—Å–ø–µ—Ä—Ç–∞ -->
    <div class="tabs">
        <button class="tab active" onclick="switchExpertPanelTab('dashboard')">üìä –ü–∞–Ω–µ–ª—å</button>
        <button class="tab" onclick="switchExpertPanelTab('courses')">üìö –ö—É—Ä—Å—ã</button>
        <button class="tab" onclick="switchExpertPanelTab('promo')">üè∑Ô∏è –ü—Ä–æ–º–æ</button>
        <button class="tab" onclick="switchExpertPanelTab('analytics')">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
    </div>

    <!-- –¢–∞–±: –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div id="expertDashboardTab" class="expert-panel-tab">
        <div class="expert-dashboard">
            
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ -->
            <div class="subscription-card trial" id="expertSubCard" onclick="showSubscriptionModal()">
                <div class="sub-status">–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏</div>
                <div class="sub-value" id="expertSubStatus">–ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥: 10 –¥–Ω–µ–π</div>
                <button class="sub-btn">–£–ª—É—á—à–∏—Ç—å –ø–ª–∞–Ω ‚Üí</button>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="expert-stats">
                <div class="expert-stat" onclick="showEarningsDetails()">
                    <div class="expert-stat-value" id="expertEarnings">0 ‚≠ê</div>
                    <div class="expert-stat-label">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                </div>
                <div class="expert-stat" onclick="showStudentsModal()">
                    <div class="expert-stat-value" id="expertStudents">0</div>
                    <div class="expert-stat-label">–£—á–µ–Ω–∏–∫–æ–≤</div>
                </div>
                <div class="expert-stat">
                    <div class="expert-stat-value" id="expertCoursesNum">0</div>
                    <div class="expert-stat-label">–ö—É—Ä—Å–æ–≤</div>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫—É—Ä—Å–∞ -->
            <button class="create-course-btn" onclick="createNewCourse()">
                ‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫—É—Ä—Å
            </button>

            <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="quick-actions">
                <div class="section-header">
                    <span class="section-title">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</span>
                </div>
                <div class="quick-actions-grid">
                    <div class="quick-action-item" onclick="showMessagesModal()">
                        <span class="quick-action-icon">üí¨</span>
                        <span class="quick-action-text">–°–æ–æ–±—â–µ–Ω–∏—è</span>
                        <span class="quick-action-badge" id="quickMsgBadge">0</span>
                    </div>
                    <div class="quick-action-item" onclick="showStudentsModal()">
                        <span class="quick-action-icon">üë•</span>
                        <span class="quick-action-text">–£—á–µ–Ω–∏–∫–∏</span>
                    </div>
                    <div class="quick-action-item" onclick="showCreatePromoModal()">
                        <span class="quick-action-icon">üè∑Ô∏è</span>
                        <span class="quick-action-text">–ü—Ä–æ–º–æ–∫–æ–¥</span>
                    </div>
                    <div class="quick-action-item" onclick="showWithdrawModal()">
                        <span class="quick-action-icon">üí∞</span>
                        <span class="quick-action-text">–í—ã–≤–æ–¥</span>
                    </div>
                </div>
            </div>

            <!-- –ú–æ–∏ –∫—É—Ä—Å—ã -->
            <div class="section-header" style="margin-top: 20px;">
                <span class="section-title">üìö –ú–æ–∏ –∫—É—Ä—Å—ã</span>
                <span class="see-all-btn" onclick="switchExpertPanelTab('courses')">–í—Å–µ ‚Üí</span>
            </div>
            <div class="my-courses-list" id="expertCoursesDashboard">
                <div class="empty-state">
                    <div class="empty-icon">üìö</div>
                    <div class="empty-text">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫—É—Ä—Å–æ–≤</div>
                    <button class="empty-btn" onclick="createNewCourse()">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –∫—É—Ä—Å</button>
                </div>
            </div>

        </div>
    </div>

    <!-- –¢–∞–±: –ö—É—Ä—Å—ã -->
    <div id="expertCoursesTab" class="expert-panel-tab" style="display: none;">
        <div style="padding: 15px;">
            <button class="create-course-btn" onclick="createNewCourse()">
                ‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫—É—Ä—Å
            </button>
            
            <div id="expertCoursesFullList" class="my-courses-list" style="margin-top: 15px;">
                <div class="empty-state">
                    <div class="empty-icon">üìö</div>
                    <div class="empty-text">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∫—É—Ä—Å</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –¢–∞–±: –ü—Ä–æ–º–æ–∫–æ–¥—ã -->
    <div id="expertPromoTab" class="expert-panel-tab" style="display: none;">
        <div class="promo-section">
            <div class="section-header">
                <span class="section-title">üè∑Ô∏è –ú–æ–∏ –ø—Ä–æ–º–æ–∫–æ–¥—ã</span>
            </div>
            
            <div id="expertPromoList">
                <div class="empty-state">
                    <div class="empty-icon">üè∑Ô∏è</div>
                    <div class="empty-text">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤</div>
                </div>
            </div>
            
            <button class="create-promo-btn" onclick="showCreatePromoModal()">
                ‚ûï –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
            </button>
        </div>
    </div>

    <!-- –¢–∞–±: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
    <div id="expertAnalyticsTab" class="expert-panel-tab" style="display: none;">
        <div class="analytics-section">
            
            <!-- –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–¥–∞–∂ -->
            <div class="chart-card">
                <div class="chart-header">
                    <span class="chart-title">üí∞ –ü—Ä–æ–¥–∞–∂–∏</span>
                    <select class="chart-period" onchange="updateAnalytics(this.value)">
                        <option value="7">7 –¥–Ω–µ–π</option>
                        <option value="30">30 –¥–Ω–µ–π</option>
                        <option value="90">3 –º–µ—Å—è—Ü–∞</option>
                    </select>
                </div>
                <div class="chart-bars" id="salesChart">
                    <div class="chart-bar" style="height: 20%;"></div>
                    <div class="chart-bar" style="height: 45%;"></div>
                    <div class="chart-bar" style="height: 30%;"></div>
                    <div class="chart-bar" style="height: 60%;"></div>
                    <div class="chart-bar" style="height: 40%;"></div>
                    <div class="chart-bar" style="height: 75%;"></div>
                    <div class="chart-bar" style="height: 55%;"></div>
                </div>
                <div class="chart-labels">
                    <span>–ü–Ω</span><span>–í—Ç</span><span>–°—Ä</span><span>–ß—Ç</span><span>–ü—Ç</span><span>–°–±</span><span>–í—Å</span>
                </div>
            </div>

            <!-- –ú–µ—Ç—Ä–∏–∫–∏ -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon">üëÅÔ∏è</div>
                    <div class="metric-value" id="metricViews">0</div>
                    <div class="metric-label">–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div>
                    <div class="metric-change positive">+0%</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">üõí</div>
                    <div class="metric-value" id="metricSales">0</div>
                    <div class="metric-label">–ü—Ä–æ–¥–∞–∂</div>
                    <div class="metric-change positive">+0%</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">üìä</div>
                    <div class="metric-value" id="metricConversion">0%</div>
                    <div class="metric-label">–ö–æ–Ω–≤–µ—Ä—Å–∏—è</div>
                    <div class="metric-change neutral">0%</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">‚≠ê</div>
                    <div class="metric-value" id="metricRating">0.0</div>
                    <div class="metric-label">–†–µ–π—Ç–∏–Ω–≥</div>
                    <div class="metric-change positive">+0.0</div>
                </div>
            </div>

            <!-- –¢–æ–ø –∫—É—Ä—Å—ã -->
            <div class="chart-card">
                <div class="chart-header">
                    <span class="chart-title">üèÜ –¢–æ–ø –∫—É—Ä—Å—ã</span>
                </div>
                <div id="topCoursesList" class="top-courses-list">
                    <div class="empty-state small">
                        <div class="empty-text">–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
                    </div>
                </div>
            </div>

        </div>
    </div>

</div>
    </div>

<!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
<div class="bottom-nav" id="mainNav">
    <button class="nav-item active" onclick="navigateToTab('home')">
        <span class="nav-icon">üè†</span>
        <span>–ì–ª–∞–≤–Ω–∞—è</span>
    </button>
    <button class="nav-item" onclick="navigateToTab('search')">
        <span class="nav-icon">üîç</span>
        <span>–ü–æ–∏—Å–∫</span>
    </button>
    <button class="nav-item" onclick="navigateToTab('my-courses')">
        <span class="nav-icon">üìö</span>
        <span>–ú–æ–∏ –∫—É—Ä—Å—ã</span>
    </button>
    <button class="nav-item" onclick="navigateToTab('profile')">
        <span class="nav-icon">üë§</span>
        <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
    </button>
</div>
</div>
<!-- ===== –†–ï–î–ê–ö–¢–û–† –ö–£–†–°–ê ===== -->
<div id="courseEditorPage" class="page">
    
    <!-- –•–µ–¥–µ—Ä —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
    <div class="editor-header">
        <button class="editor-back-btn" onclick="closeCourseEditor()">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="editor-title">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä –∫—É—Ä—Å–∞</div>
        <button class="editor-save-btn" onclick="saveCourse()">üíæ</button>
    </div>

    <!-- –¢–∞–±—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
    <div class="editor-tabs">
        <button class="editor-tab active" onclick="switchEditorTab('info')">üìù –ò–Ω—Ñ–æ</button>
        <button class="editor-tab" onclick="switchEditorTab('lessons')">üìö –£—Ä–æ–∫–∏</button>
        <button class="editor-tab" onclick="switchEditorTab('pricing')">üí∞ –¶–µ–Ω–∞</button>
        <button class="editor-tab" onclick="switchEditorTab('settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    </div>

    <!-- –¢–∞–±: –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div id="editorInfoTab" class="editor-tab-content">
        <div class="editor-section">
            
            <!-- –ò–∫–æ–Ω–∫–∞ –∫—É—Ä—Å–∞ -->
            <div class="editor-icon-picker">
                <div class="editor-icon-preview" id="courseIconPreview" onclick="showIconPicker()">üìö</div>
                <span class="editor-icon-hint">–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å</span>
            </div>

            <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
            <div class="editor-field">
                <label class="editor-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞ *</label>
                <input type="text" class="editor-input" id="courseTitle" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: JavaScript —Å –Ω—É–ª—è">
            </div>

            <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
            <div class="editor-field">
                <label class="editor-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea class="editor-textarea" id="courseDescription" placeholder="–û–ø–∏—à–∏—Ç–µ —á–µ–º—É –Ω–∞—É—á–∏—Ç—Å—è —É—á–µ–Ω–∏–∫..."></textarea>
            </div>

            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
            <div class="editor-field">
                <label class="editor-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <select class="editor-select" id="courseCategory">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                    <option value="programming">üíª –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                    <option value="design">üé® –î–∏–∑–∞–π–Ω</option>
                    <option value="marketing">üìà –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥</option>
                    <option value="business">üíº –ë–∏–∑–Ω–µ—Å</option>
                    <option value="languages">üåç –Ø–∑—ã–∫–∏</option>
                    <option value="other">üì¶ –î—Ä—É–≥–æ–µ</option>
                </select>
            </div>

            <!-- –£—Ä–æ–≤–µ–Ω—å -->
            <div class="editor-field">
                <label class="editor-label">–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</label>
                <div class="editor-level-picker">
                    <div class="level-option selected" onclick="selectLevel('beginner', this)">
                        <span>üå±</span>
                        <span>–ù–∞—á–∏–Ω–∞—é—â–∏–π</span>
                    </div>
                    <div class="level-option" onclick="selectLevel('intermediate', this)">
                        <span>üåø</span>
                        <span>–°—Ä–µ–¥–Ω–∏–π</span>
                    </div>
                    <div class="level-option" onclick="selectLevel('advanced', this)">
                        <span>üå≥</span>
                        <span>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</span>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- –¢–∞–±: –£—Ä–æ–∫–∏ -->
    <div id="editorLessonsTab" class="editor-tab-content" style="display: none;">
        <div class="editor-section">
            
            <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—Ä–æ–∫–∞ -->
            <button class="add-lesson-btn" onclick="addLesson()">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫
            </button>

            <!-- –°–ø–∏—Å–æ–∫ —É—Ä–æ–∫–æ–≤ -->
            <div class="lessons-editor-list" id="lessonsEditorList">
                <div class="empty-state">
                    <div class="empty-icon">üìö</div>
                    <div class="empty-text">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫</div>
                </div>
            </div>

        </div>
    </div>

    <!-- –¢–∞–±: –¶–µ–Ω–∞ -->
    <div id="editorPricingTab" class="editor-tab-content" style="display: none;">
        <div class="editor-section">
            
            <!-- –¢–∏–ø –¥–æ—Å—Ç—É–ø–∞ -->
            <div class="editor-field">
                <label class="editor-label">–¢–∏–ø –¥–æ—Å—Ç—É–ø–∞</label>
                <div class="access-type-picker">
                    <div class="access-option" onclick="selectAccessType('paid', this)">
                        <span class="access-icon">üí∞</span>
                        <span class="access-name">–ü–ª–∞—Ç–Ω—ã–π</span>
                    </div>
                    <div class="access-option" onclick="selectAccessType('free', this)">
                        <span class="access-icon">üÜì</span>
                        <span class="access-name">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π</span>
                    </div>
                </div>
            </div>

            <!-- –¶–µ–Ω–∞ -->
            <div class="editor-field" id="priceField">
                <label class="editor-label">–¶–µ–Ω–∞ (–≤ Stars ‚≠ê)</label>
                <div class="price-input-wrapper">
                    <input type="number" class="editor-input price-input" id="coursePrice" placeholder="1990" min="0">
                    <span class="price-currency">‚≠ê</span>
                </div>
                <div class="price-hint">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞: 100 ‚≠ê (‚âà 100‚ÇΩ)</div>
            </div>

            <!-- –°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞ (—Å–∫–∏–¥–∫–∞) -->
            <div class="editor-field" id="oldPriceField">
                <label class="editor-label">–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞ (–¥–ª—è —Å–∫–∏–¥–∫–∏)</label>
                <div class="price-input-wrapper">
                    <input type="number" class="editor-input price-input" id="courseOldPrice" placeholder="2990" min="0">
                    <span class="price-currency">‚≠ê</span>
                </div>
                <div class="price-hint">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –µ—Å–ª–∏ –±–µ–∑ —Å–∫–∏–¥–∫–∏</div>
            </div>

            <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ü–µ–Ω—ã -->
            <div class="price-preview">
                <div class="price-preview-label">–ö–∞–∫ —É–≤–∏–¥–∏—Ç —É—á–µ–Ω–∏–∫:</div>
                <div class="price-preview-value">
                    <span class="price-new" id="pricePreviewNew">1990 ‚≠ê</span>
                    <span class="price-old" id="pricePreviewOld"></span>
                </div>
            </div>

        </div>
    </div>

    <!-- –¢–∞–±: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div id="editorSettingsTab" class="editor-tab-content" style="display: none;">
        <div class="editor-section">
            
            <!-- –°—Ç–∞—Ç—É—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ -->
            <div class="editor-field">
                <label class="editor-label">–°—Ç–∞—Ç—É—Å –∫—É—Ä—Å–∞</label>
                <div class="status-picker">
                    <div class="status-option draft" onclick="selectStatus('draft', this)">
                        <span>üìù</span>
                        <span>–ß–µ—Ä–Ω–æ–≤–∏–∫</span>
                        <small>–í–∏–¥–µ–Ω —Ç–æ–ª—å–∫–æ –≤–∞–º</small>
                    </div>
                    <div class="status-option published" onclick="selectStatus('published', this)">
                        <span>üåç</span>
                        <span>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω</span>
                        <small>–í–∏–¥–µ–Ω –≤—Å–µ–º</small>
                    </div>
                </div>
            </div>

            <!-- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç -->
            <div class="editor-toggle-field">
                <div class="toggle-info">
                    <div class="toggle-title">üéì –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</div>
                    <div class="toggle-desc">–í—ã–¥–∞–≤–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="courseCertificate" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
            <div class="editor-toggle-field">
                <div class="toggle-info">
                    <div class="toggle-title">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</div>
                    <div class="toggle-desc">–†–∞–∑—Ä–µ—à–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∫ —É—Ä–æ–∫–∞–º</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="courseComments" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <!-- –ü—Ä–µ–≤—å—é —É—Ä–æ–∫–æ–≤ -->
            <div class="editor-toggle-field">
                <div class="toggle-info">
                    <div class="toggle-title">üëÅÔ∏è –ü—Ä–µ–≤—å—é</div>
                    <div class="toggle-desc">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫ –±–µ—Å–ø–ª–∞—Ç–Ω–æ</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="coursePreview">
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <!-- –£–¥–∞–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞ -->
            <div class="danger-zone">
                <div class="danger-title">‚ö†Ô∏è –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</div>
                <button class="delete-course-btn" onclick="deleteCourse()">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å
                </button>
            </div>

        </div>
    </div>

</div>

<!-- ===== –†–ï–î–ê–ö–¢–û–† –£–†–û–ö–ê (–º–æ–¥–∞–ª–∫–∞) ===== -->
<div class="modal" id="lessonEditorModal" onclick="closeModalOnBackdrop(event, 'lessonEditorModal')">
    <div class="modal-content lesson-editor-modal" onclick="event.stopPropagation()">
        
        <div class="modal-header">
            <span class="modal-title" id="lessonEditorTitle">üìö –ù–æ–≤—ã–π —É—Ä–æ–∫</span>
            <button class="modal-close" onclick="closeModal('lessonEditorModal')">‚úï</button>
        </div>

        <div class="lesson-editor-body">
            
            <!-- –ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞ -->
            <div class="editor-field">
                <label class="editor-label">–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞ *</label>
                <input type="text" class="editor-input" id="lessonTitle" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –í–≤–µ–¥–µ–Ω–∏–µ –≤ –∫—É—Ä—Å">
            </div>

            <!-- –¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
            <div class="editor-field">
                <label class="editor-label">–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞</label>
                <div class="content-type-picker">
                    <div class="content-type selected" onclick="selectContentType('video', this)">
                        <span>üé¨</span>
                        <span>–í–∏–¥–µ–æ</span>
                    </div>
                    <div class="content-type" onclick="selectContentType('text', this)">
                        <span>üìù</span>
                        <span>–¢–µ–∫—Å—Ç</span>
                    </div>
                    <div class="content-type" onclick="selectContentType('quiz', this)">
                        <span>‚ùì</span>
                        <span>–¢–µ—Å—Ç</span>
                    </div>
                </div>
            </div>

            <!-- –í–∏–¥–µ–æ URL -->
            <div class="editor-field" id="videoUrlField">
                <label class="editor-label">–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ</label>
                <input type="url" class="editor-input" id="lessonVideoUrl" placeholder="https://youtube.com/... –∏–ª–∏ –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞">
                <div class="field-hint">YouTube, Vimeo –∏–ª–∏ –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ .mp4</div>
            </div>

            <!-- –¢–µ–∫—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <div class="editor-field" id="textContentField" style="display: none;">
                <label class="editor-label">–¢–µ–∫—Å—Ç —É—Ä–æ–∫–∞</label>
                <textarea class="editor-textarea large" id="lessonTextContent" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —É—Ä–æ–∫–∞..."></textarea>
            </div>

            <!-- –¢–µ—Å—Ç -->
            <div id="quizEditorField" style="display: none;">
                <label class="editor-label">–í–æ–ø—Ä–æ—Å—ã —Ç–µ—Å—Ç–∞</label>
                
                <div id="quizQuestionsList" class="quiz-questions-list">
                    <!-- –í–æ–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
                </div>
                
                <button class="add-question-btn" onclick="addQuizQuestion()">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
                </button>
            </div>

            <!-- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -->
            <div class="editor-field">
                <label class="editor-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω—É—Ç—ã)</label>
                <input type="number" class="editor-input" id="lessonDuration" placeholder="15" min="1">
            </div>

            <!-- –û–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–∞ -->
            <div class="editor-field">
                <label class="editor-label">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                <textarea class="editor-textarea" id="lessonDescription" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–∞..."></textarea>
            </div>

        </div>

        <div class="lesson-editor-footer">
            <button class="editor-cancel-btn" onclick="closeModal('lessonEditorModal')">–û—Ç–º–µ–Ω–∞</button>
            <button class="editor-submit-btn" onclick="saveLesson()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>

    </div>
</div>

<!-- –í—ã–±–æ—Ä –∏–∫–æ–Ω–∫–∏ (—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–∞–ª–∫–∞) -->
<div class="modal modal-center" id="iconPickerModal" onclick="closeModalOnBackdrop(event, 'iconPickerModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <div style="width: 36px;"></div>
            <div class="modal-title">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∫–æ–Ω–∫—É</div>
            <button class="modal-close" onclick="closeModal('iconPickerModal')">‚úï</button>
        </div>
        
        <div class="icon-picker-grid">
            <div class="icon-item" onclick="selectCourseIcon('üìö')">üìö</div>
            <div class="icon-item" onclick="selectCourseIcon('üíª')">üíª</div>
            <div class="icon-item" onclick="selectCourseIcon('üé®')">üé®</div>
            <div class="icon-item" onclick="selectCourseIcon('üìä')">üìä</div>
            <div class="icon-item" onclick="selectCourseIcon('üöÄ')">üöÄ</div>
            <div class="icon-item" onclick="selectCourseIcon('üí°')">üí°</div>
            <div class="icon-item" onclick="selectCourseIcon('üéØ')">üéØ</div>
            <div class="icon-item" onclick="selectCourseIcon('üîß')">üîß</div>
            <div class="icon-item" onclick="selectCourseIcon('üì±')">üì±</div>
            <div class="icon-item" onclick="selectCourseIcon('üåê')">üåê</div>
            <div class="icon-item" onclick="selectCourseIcon('ü§ñ')">ü§ñ</div>
            <div class="icon-item" onclick="selectCourseIcon('üíé')">üíé</div>
            <div class="icon-item" onclick="selectCourseIcon('üé¨')">üé¨</div>
            <div class="icon-item" onclick="selectCourseIcon('üéµ')">üéµ</div>
            <div class="icon-item" onclick="selectCourseIcon('üì∑')">üì∑</div>
            <div class="icon-item" onclick="selectCourseIcon('‚úèÔ∏è')">‚úèÔ∏è</div>
            <div class="icon-item" onclick="selectCourseIcon('üìà')">üìà</div>
            <div class="icon-item" onclick="selectCourseIcon('üíº')">üíº</div>
            <div class="icon-item" onclick="selectCourseIcon('üèÜ')">üèÜ</div>
            <div class="icon-item" onclick="selectCourseIcon('‚≠ê')">‚≠ê</div>
            <div class="icon-item" onclick="selectCourseIcon('üî•')">üî•</div>
            <div class="icon-item" onclick="selectCourseIcon('üí™')">üí™</div>
            <div class="icon-item" onclick="selectCourseIcon('üß†')">üß†</div>
            <div class="icon-item" onclick="selectCourseIcon('üìñ')">üìñ</div>
        </div>
    </div>
</div>

<!-- ===== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ===== -->

<!-- –ú–æ–¥–∞–ª–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π -->
<div class="modal" id="achievementsModal" onclick="closeModalOnBackdrop(event, 'achievementsModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-drag-zone" id="achievementsDragZone">
            <div class="modal-drag-handle"></div>
        </div>
        
        <div class="achievements-modal-header">
            <h2>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
            <div class="xp-display">
                <div class="xp-item">
                    <div class="xp-item-value" id="modalXP">1,250</div>
                    <div class="xp-item-label">XP</div>
                </div>
                <div class="xp-item">
                    <div class="xp-item-value" id="modalLevel">5</div>
                    <div class="xp-item-label">–£—Ä–æ–≤–µ–Ω—å</div>
                </div>
                <div class="xp-item">
                    <div class="xp-item-value" id="modalAchievements">4</div>
                    <div class="xp-item-label">–ù–∞–≥—Ä–∞–¥—ã</div>
                </div>
            </div>
            <div class="level-progress">
                <div class="level-progress-fill" id="levelProgressFill" style="width: 60%;"></div>
            </div>
            <div class="level-text">250 XP –¥–æ —É—Ä–æ–≤–Ω—è 6</div>
        </div>
        
        <div class="modal-body-no-padding">
            <div class="achievements-list" id="achievementsList"></div>
        </div>
        
        <div class="modal-footer">
            <button class="modal-btn primary full" onclick="closeModal('achievementsModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ -->
<div class="modal" id="subscriptionModal" onclick="closeModalOnBackdrop(event, 'subscriptionModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="pricing-header">
            <h2>EduGram PRO</h2>
            <p>–†–∞–∑–º–µ—â–∞–π—Ç–µ –∫—É—Ä—Å—ã –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π</p>
        </div>
        <div class="trial-info">
            <div class="trial-days" id="trialDays">10</div>
            <div class="trial-label">–¥–Ω–µ–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ</div>
            <div class="trial-progress">
                <div class="trial-progress-fill" id="trialProgressFill" style="width: 100%;"></div>
            </div>
        </div>
        <div class="pricing-plans">
            <div class="plan-card" onclick="selectPlan('month')">
                <div class="plan-header">
                    <span class="plan-name">üìÖ 1 –º–µ—Å—è—Ü</span>
                </div>
                <div class="plan-price">
                    <span class="plan-price-value">990 ‚ÇΩ</span>
                    <div class="plan-price-period">990 ‚ÇΩ/–º–µ—Å</div>
                </div>
                <ul class="plan-features">
                    <li>–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –∫—É—Ä—Å—ã</li>
                    <li>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</li>
                    <li>–ü—Ä–æ–º–æ–∫–æ–¥—ã</li>
                </ul>
            </div>
            <div class="plan-card popular selected" onclick="selectPlan('year')">
                <div class="plan-header">
                    <span class="plan-name">üéâ 12 –º–µ—Å—è—Ü–µ–≤</span>
                    <span class="plan-badge">-40%</span>
                </div>
                <div class="plan-price">
                    <span class="plan-price-value">7,128 ‚ÇΩ</span>
                    <span class="plan-price-old">11,880 ‚ÇΩ</span>
                    <div class="plan-price-period">594 ‚ÇΩ/–º–µ—Å</div>
                </div>
                <ul class="plan-features">
                    <li>–í—Å–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞</li>
                    <li>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä</li>
                    <li>–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤</li>
                </ul>
            </div>
            <button class="subscribe-btn" onclick="processPayment()">
                üí≥ –û–ø–ª–∞—Ç–∏—Ç—å <span id="selectedPlanPrice">7,128 ‚ÇΩ</span>
            </button>
        </div>
        <div class="payment-methods">üí≥ üè¶ üíé ‚≠ê</div>
        <div class="payment-note">üîí –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞</div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π -->
<div class="modal" id="messagesModal" onclick="closeModalOnBackdrop(event, 'messagesModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-drag-zone">
            <div class="modal-drag-handle"></div>
        </div>
        
        <div class="modal-header">
            <div style="width: 70px;"></div>
            <div class="modal-title">üí¨ –°–æ–æ–±—â–µ–Ω–∏—è</div>
            <button class="modal-close" onclick="closeModal('messagesModal')">‚úï</button>
        </div>
        
        <div class="modal-body-no-padding">
            <div class="messages-list" id="messagesList"></div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ —É—á–µ–Ω–∏–∫–æ–≤ -->
<div class="modal" id="studentsModal" onclick="closeModalOnBackdrop(event, 'studentsModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-drag-zone">
            <div class="modal-drag-handle"></div>
        </div>
        
        <div class="students-stats">
            <div class="students-stat">
                <div class="students-stat-value" id="totalStudents">234</div>
                <div class="students-stat-label">–í—Å–µ–≥–æ</div>
            </div>
            <div class="students-stat">
                <div class="students-stat-value" id="activeStudents">156</div>
                <div class="students-stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
            </div>
            <div class="students-stat">
                <div class="students-stat-value" id="completedStudents">78</div>
                <div class="students-stat-label">–ó–∞–≤–µ—Ä—à–∏–ª–∏</div>
            </div>
        </div>
        
        <div class="modal-body-no-padding">
            <div id="studentsList"></div>
        </div>
        
        <div class="modal-footer">
            <button class="modal-btn secondary full" onclick="closeModal('studentsModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ —á–∞—Ç–∞ -->
<div class="modal" id="chatModal" onclick="closeModalOnBackdrop(event, 'chatModal')">
    <div class="modal-content chat-modal-content" onclick="event.stopPropagation()" style="padding: 0;">
        <div class="chat-header">
            <div class="message-avatar" id="chatAvatar">–ú–°</div>
            <div class="chat-user-info">
                <div class="chat-user-name" id="chatUserName">–ú–∞—Ä–∏—è</div>
                <div class="chat-user-status">Telegram Mini Apps</div>
            </div>
            <button class="modal-close" style="background: rgba(255,255,255,0.2); color: white;" onclick="closeModal('chatModal')">‚úï</button>
        </div>
        <div class="chat-messages-container" id="chatMessagesContainer"></div>
        <div class="chat-input-container">
            <input type="text" class="chat-input" id="chatMessageInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
            <button class="chat-send-btn" onclick="sendChatMessage()">‚û§</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ -->
<div class="modal" id="certificateModal" onclick="closeModalOnBackdrop(event, 'certificateModal')">
    <div class="certificate" onclick="event.stopPropagation()">
        <div class="certificate-seal">üéì</div>
        <div class="certificate-title">–°–ï–†–¢–ò–§–ò–ö–ê–¢</div>
        <div class="certificate-subtitle">–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ –∫—É—Ä—Å–∞</div>
        <div class="certificate-name" id="certName">–ê—Ä—Ç–µ–º –ò–≤–∞–Ω–æ–≤</div>
        <div class="certificate-course">
            —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª<br><strong id="certCourse">"–ö—É—Ä—Å"</strong>
        </div>
        <div class="certificate-date" id="certDate">15 –¥–µ–∫–∞–±—Ä—è 2024</div>
        <div class="certificate-actions">
            <button class="cert-btn download" onclick="downloadCertificate()">üì• –°–∫–∞—á–∞—Ç—å</button>
            <button class="cert-btn share" onclick="closeModal('certificateModal')">‚úï</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –æ—Ç–∑—ã–≤–∞ -->
<div class="modal" id="reviewModal" onclick="closeModalOnBackdrop(event, 'reviewModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-drag-zone">
            <div class="modal-drag-handle"></div>
        </div>
        
        <div class="modal-header-simple">
            <button class="modal-header-btn cancel" onclick="closeModal('reviewModal')">–û—Ç–º–µ–Ω–∞</button>
            <div>
                <div class="modal-title">–û—Ç–∑—ã–≤</div>
            </div>
            <button class="modal-header-btn save" onclick="submitReview()">–ì–æ—Ç–æ–≤–æ</button>
        </div>
        
        <div class="modal-body">
            <p style="text-align: center; color: var(--text-secondary, #666); margin-bottom: 10px;">–û—Ü–µ–Ω–∏—Ç–µ –∫—É—Ä—Å</p>
            <div class="rating-select" id="ratingSelect">
                <span class="rating-star" onclick="selectRating(1)">‚≠ê</span>
                <span class="rating-star" onclick="selectRating(2)">‚≠ê</span>
                <span class="rating-star" onclick="selectRating(3)">‚≠ê</span>
                <span class="rating-star" onclick="selectRating(4)">‚≠ê</span>
                <span class="rating-star" onclick="selectRating(5)">‚≠ê</span>
            </div>
            
            <div class="modal-input-group">
                <label class="modal-label">–í–∞—à –æ—Ç–∑—ã–≤</label>
                <textarea class="modal-textarea" id="reviewText" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –≤–∞—à–µ–º –æ–ø—ã—Ç–µ..."></textarea>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞ -->
<div class="modal" id="promoModal" onclick="closeModalOnBackdrop(event, 'promoModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-drag-zone">
            <div class="modal-drag-handle"></div>
        </div>
        
        <div class="modal-header-simple">
            <button class="modal-header-btn cancel" onclick="closeModal('promoModal')">–û—Ç–º–µ–Ω–∞</button>
            <div>
                <div class="modal-title">–ù–æ–≤—ã–π –ø—Ä–æ–º–æ–∫–æ–¥</div>
            </div>
            <button class="modal-header-btn save" onclick="createPromoCode()">–°–æ–∑–¥–∞—Ç—å</button>
        </div>
        
        <div class="modal-body">
            <div class="modal-input-group">
                <label class="modal-label">–ö–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞</label>
                <input type="text" class="modal-input" id="promoCodeInput" placeholder="SALE20" style="text-transform: uppercase;">
                <div class="modal-input-hint">–õ–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã</div>
            </div>
            
            <div class="modal-input-group">
                <label class="modal-label">–†–∞–∑–º–µ—Ä —Å–∫–∏–¥–∫–∏</label>
                <div class="discount-options">
                    <div class="discount-option" onclick="selectDiscount(10, this)">10%</div>
                    <div class="discount-option selected" onclick="selectDiscount(20, this)">20%</div>
                    <div class="discount-option" onclick="selectDiscount(30, this)">30%</div>
                    <div class="discount-option" onclick="selectDiscount(50, this)">50%</div>
                </div>
            </div>
            
            <div class="modal-input-group">
                <label class="modal-label">–õ–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π</label>
                <input type="number" class="modal-input" id="promoLimitInput" placeholder="100" value="100">
                <div class="modal-input-hint">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –±–µ–∑–ª–∏–º–∏—Ç–∞</div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –∑–∞–º–µ—Ç–∫–∏ -->
<div class="modal" id="noteModal" onclick="closeModalOnBackdrop(event, 'noteModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-drag-zone">
            <div class="modal-drag-handle"></div>
        </div>
        
        <div class="modal-header-simple">
            <button class="modal-header-btn cancel" onclick="closeModal('noteModal')">–û—Ç–º–µ–Ω–∞</button>
            <div>
                <div class="modal-title">üìù –ó–∞–º–µ—Ç–∫–∞</div>
                <div class="modal-subtitle">–ú–æ–º–µ–Ω—Ç: <span id="noteTimestamp">00:00</span></div>
            </div>
            <button class="modal-header-btn save" onclick="saveNote()">–ì–æ—Ç–æ–≤–æ</button>
        </div>
        
        <div class="modal-body">
            <textarea class="modal-textarea" id="noteText" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É –∫ —ç—Ç–æ–º—É –º–æ–º–µ–Ω—Ç—É –≤–∏–¥–µ–æ..." style="min-height: 150px;"></textarea>
        </div>
    </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast">
    <span class="toast-icon">‚úÖ</span>
    <span class="toast-text">–°–æ–æ–±—â–µ–Ω–∏–µ</span>
</div>

<!-- SUCCESS OVERLAY -->
<div class="success-overlay" id="successOverlay">
    <div class="success-checkmark">‚úÖ</div>
    <div class="success-title">–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–∞!</div>
    <div class="success-text">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ PRO</div>
</div>

<script>
// ===== TELEGRAM WEBAPP =====
const tg = window.Telegram?.WebApp;
let videoTimer = null; // –§–∏–∫—Å —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏

// ===== TELEGRAM –§–£–ù–ö–¶–ò–ò =====
function initTelegramApp() {
    if (!tg) {
        console.warn('‚ö†Ô∏è Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –†–∞–±–æ—Ç–∞–µ–º –≤ standalone —Ä–µ–∂–∏–º–µ.');
        return;
    }
    
        // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    tg.ready();
    tg.expand(); // –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
    
    // –û—Ç–∫–ª—é—á–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–≤–∞–π–ø—ã –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è
    if (tg.disableVerticalSwipes) {
        tg.disableVerticalSwipes();
    }
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç —Ö–µ–¥–µ—Ä–∞
    if (tg.setHeaderColor) {
        tg.setHeaderColor('#667eea');
    }
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç —Ñ–æ–Ω–∞
    if (tg.setBackgroundColor) {
        tg.setBackgroundColor('#ffffff');
    }
    
    tg.enableClosingConfirmation(); // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
    
    // 4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
    setupBackButton();
    
    // 5. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å deep link (–µ—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª–∏ –ø–æ —Å—Å—ã–ª–∫–µ –Ω–∞ –∫—É—Ä—Å)
    handleDeepLink();
    
    console.log('‚úÖ Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        
    // 6. –ë–ª–æ–∫–∏—Ä—É–µ–º pull-to-close –∫—Ä–æ–º–µ –≤–µ—Ä—Ö–Ω–µ–π –ø–æ–ª–æ—Å–∫–∏
    preventPullToClose();
    
    console.log('‚úÖ Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
}

// –§—É–Ω–∫—Ü–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–≤–∞–π–ø–∞ –≤–Ω–∏–∑
function preventPullToClose() {
    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–æ—Å–∫—É –¥–ª—è —Å–≤–∞–π–ø–∞ —Å–≤–µ—Ä—Ö—É
    const grabHandle = document.createElement('div');
    grabHandle.className = 'tg-grab-handle';
    document.body.prepend(grabHandle);
    
    let startY = 0;
    let isScrolling = false;
    
    const container = document.querySelector('.container');
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–≤–∞–π–ø –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
    container.addEventListener('touchstart', (e) => {
        startY = e.touches[0].clientY;
        isScrolling = container.scrollTop > 0;
    }, { passive: true });
    
    container.addEventListener('touchmove', (e) => {
        const currentY = e.touches[0].clientY;
        const deltaY = currentY - startY;
        
        // –ï—Å–ª–∏ —Å–∫—Ä–æ–ª–ª–∏–º –≤–Ω–∏–∑ –∏ —É–∂–µ –≤ —Å–∞–º–æ–º –≤–µ—Ä—Ö—É - –±–ª–æ–∫–∏—Ä—É–µ–º
        if (deltaY > 0 && container.scrollTop <= 0 && !isScrolling) {
            e.preventDefault();
        }
    }, { passive: false });
    
    // –î–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
    document.querySelectorAll('.modal-content').forEach(modal => {
        modal.addEventListener('touchmove', (e) => {
            e.stopPropagation();
        }, { passive: true });
    });
}

function applyTelegramTheme() {
    if (tg.colorScheme === 'dark') {
        state.darkMode = true;
        document.body.classList.add('dark-mode');
    }
    
    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç–∞ –∏–∑ —Ç–µ–º—ã Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    const root = document.documentElement;
    root.style.setProperty('--tg-bg', tg.backgroundColor || '#ffffff');
    root.style.setProperty('--tg-text', tg.themeParams?.text_color || '#000000');
    
    // –°–ª—É—à–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã
    tg.onEvent('themeChanged', () => {
        state.darkMode = tg.colorScheme === 'dark';
        document.body.classList.toggle('dark-mode', state.darkMode);
    });
}

function autoLoginFromTelegram(user) {
    state.user = {
        isLoggedIn: true,
        name: `${user.first_name}${user.last_name ? ' ' + user.last_name : ''}`,
        telegramId: user.id,
        username: user.username || '',
        photoUrl: user.photo_url || '',
        role: state.user.role || 'student'
    };
    
    document.getElementById('authScreen').classList.add('hidden');
    console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', state.user.name);
}

function setupBackButton() {
    tg.BackButton.onClick(() => {
        hapticFeedback('light');
        
        // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫—É—Ä—Å–∞
        if (document.getElementById('courseEditorPage').classList.contains('active')) {
            if (confirm('–í—ã–π—Ç–∏ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è?')) {
                closeCourseEditor();
            }
            return;
        }
        
        // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç —Ä–µ–∂–∏–º —ç–∫—Å–ø–µ—Ä—Ç–∞
        if (state.isExpertModeOpen) {
            closeExpertMode();
            return;
        }
        
        // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç –∫—É—Ä—Å
        if (state.currentPage === 'course') {
            navigateTo('home');
            return;
        }
        
        // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ –º–æ–¥–∞–ª–∫–∞
        const activeModal = document.querySelector('.modal.active');
        if (activeModal) {
            closeModal(activeModal.id);
            return;
        }
        
        // –ò–Ω–∞—á–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        tg.close();
    });
}

function handleDeepLink() {
    const startParam = tg.initDataUnsafe?.start_param;
    if (startParam) {
        const match = startParam.match(/course_(\d+)/);
        if (match) {
            const courseId = parseInt(match[1]);
            setTimeout(() => openCourse(courseId), 1000);
        }
    }
}

function hapticFeedback(type = 'light') {
    if (!tg?.HapticFeedback) return;
    
    switch(type) {
        case 'light':
            tg.HapticFeedback.impactOccurred('light');
            break;
        case 'medium':
            tg.HapticFeedback.impactOccurred('medium');
            break;
        case 'heavy':
            tg.HapticFeedback.impactOccurred('heavy');
            break;
        case 'success':
            tg.HapticFeedback.notificationOccurred('success');
            break;
        case 'warning':
            tg.HapticFeedback.notificationOccurred('warning');
            break;
        case 'error':
            tg.HapticFeedback.notificationOccurred('error');
            break;
    }
}

function showMainButton(text, onClick) {
    if (!tg) return;
    
    tg.MainButton.setText(text);
    tg.MainButton.show();
    tg.MainButton.onClick(onClick);
}

function hideMainButton() {
    if (!tg) return;
    tg.MainButton.hide();
    tg.MainButton.offClick();
}
// ===== –î–ê–ù–ù–´–ï =====
const coursesData = [
    { id: 1, title: 'Telegram Mini Apps —Å –Ω—É–ª—è', author: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', authorInitials: '–ò–ü', price: 2999, rating: 4.8, students: 234, lessons: 15, hours: 12, badge: '–•–ò–¢', badgeColor: '#4CAF50', icon: 'üíª', gradient: 'linear-gradient(135deg, #667eea, #764ba2)' },
    { id: 2, title: '–ü—Ä–æ–¥–∞–∂–∏ —á–µ—Ä–µ–∑ —á–∞—Ç-–±–æ—Ç—ã', author: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', authorInitials: '–ú–°', price: 4999, oldPrice: 6999, rating: 4.9, students: 567, lessons: 20, hours: 8, badge: 'NEW', badgeColor: '#ff6b6b', icon: 'ü§ñ', gradient: 'linear-gradient(135deg, #f093fb, #f5576c)' },
    { id: 3, title: 'TON –ë–ª–æ–∫—á–µ–π–Ω', author: '–ê–ª–µ–∫—Å–µ–π –ö.', authorInitials: '–ê–ö', price: 9999, rating: 4.7, students: 89, lessons: 25, hours: 20, badge: null, icon: 'üíé', gradient: 'linear-gradient(135deg, #fa709a, #fee140)' }
];

const achievementsData = [
    { id: 1, icon: 'üéØ', name: '–ü–µ—Ä–≤—ã–π —É—Ä–æ–∫', desc: '–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —É—Ä–æ–∫', xp: 50, unlocked: true },
    { id: 2, icon: 'üìö', name: '–ö–Ω–∏–≥–æ–ª—é–±', desc: '–ö—É–ø–∏—Ç–µ –∫—É—Ä—Å', xp: 100, unlocked: true },
    { id: 3, icon: 'üî•', name: '7 –¥–Ω–µ–π', desc: '–£—á–∏—Ç–µ—Å—å –Ω–µ–¥–µ–ª—é', xp: 150, unlocked: true },
    { id: 4, icon: 'üí¨', name: '–ê–∫—Ç–∏–≤–∏—Å—Ç', desc: '5 –≤–æ–ø—Ä–æ—Å–æ–≤', xp: 100, unlocked: true },
    { id: 5, icon: '‚≠ê', name: '–ö—Ä–∏—Ç–∏–∫', desc: '3 –æ—Ç–∑—ã–≤–∞', xp: 100, unlocked: false },
    { id: 6, icon: 'üèÜ', name: '–ß–µ–º–ø–∏–æ–Ω', desc: '–ó–∞–≤–µ—Ä—à–∏—Ç–µ –∫—É—Ä—Å', xp: 500, unlocked: false },
    { id: 7, icon: 'üìù', name: '–û—Ç–ª–∏—á–Ω–∏–∫', desc: '–í—Å–µ —Ç–µ—Å—Ç—ã', xp: 200, unlocked: false },
    { id: 8, icon: 'üëë', name: '–õ–µ–≥–µ–Ω–¥–∞', desc: '5 –∫—É—Ä—Å–æ–≤', xp: 1000, unlocked: false }
];

const expertCoursesData = [
    { id: 1, title: 'Telegram Mini Apps', icon: 'üíª', students: 234, earnings: '701K ‚≠ê' },
    { id: 2, title: '–ü—Ä–æ–¥–∞–∂–∏ —á–µ—Ä–µ–∑ –±–æ—Ç—ã', icon: 'ü§ñ', students: 156, earnings: '468K ‚≠ê' }
];

const promoCodesData = [
    { code: 'NEWYEAR2024', discount: 20, uses: 45, limit: 100 },
    { code: 'WELCOME', discount: 10, uses: 128, limit: null }
];

const lessonsData = [
    { id: 1, title: '–í–≤–µ–¥–µ–Ω–∏–µ', duration: '15 –º–∏–Ω', completed: true },
    { id: 2, title: '–ù–∞—Å—Ç—Ä–æ–π–∫–∞', duration: '20 –º–∏–Ω', completed: true },
    { id: 3, title: 'Bot API', duration: '25 –º–∏–Ω', completed: false, current: true },
    { id: 4, title: 'Web Apps SDK', duration: '30 –º–∏–Ω', completed: false },
    { id: 5, title: '–°—Ç–∏–ª–∏–∑–∞—Ü–∏—è', duration: '25 –º–∏–Ω', completed: false }
];

const quizData = [
    { question: '–ö–∞–∫–æ–π –º–µ—Ç–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ?', options: ['sendMessage()', 'postMessage()', 'writeMessage()', 'pushMessage()'], correct: 0 },
    { question: '–ß—Ç–æ —Ç–∞–∫–æ–µ Webhook?', options: ['–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö', '–ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π', '–Ø–∑—ã–∫', '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞'], correct: 1 }
];

const qaData = [
    { author: '–ê–ª–µ–∫—Å–µ–π –ö.', initials: '–ê–ö', text: '–û—à–∏–±–∫–∞ 409 –ø—Ä–∏ webhook?', likes: 5, time: '2—á',
      answer: { author: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', initials: '–ò–ü', text: '–°–Ω–∞—á–∞–ª–∞ deleteWebhook().' } }
];

const reviewsData = [
    { author: '–ú–∞—Ä–∏—è –°.', initials: '–ú–°', rating: 5, text: '–û—Ç–ª–∏—á–Ω—ã–π –∫—É—Ä—Å!', time: '3 –¥–Ω—è' },
    { author: '–î–º–∏—Ç—Ä–∏–π –ü.', initials: '–î–ü', rating: 5, text: '–†–µ–∫–æ–º–µ–Ω–¥—É—é!', time: '1 –Ω–µ–¥' }
];

const messagesData = [
    { id: 1, sender: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', initials: '–ú–°', preview: '–í–æ–ø—Ä–æ—Å –ø–æ 3 —É—Ä–æ–∫—É...', course: 'Telegram Mini Apps', time: '5 –º–∏–Ω', unread: true,
      messages: [
        { text: '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –í–æ–ø—Ä–æ—Å –ø–æ 3 —É—Ä–æ–∫—É.', incoming: true, time: '14:30' },
        { text: '–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –°–ª—É—à–∞—é.', incoming: false, time: '14:32' }
    ]},
    { id: 2, sender: '–ê–ª–µ–∫—Å–µ–π –ö–æ–∑–ª–æ–≤', initials: '–ê–ö', preview: '–°–ø–∞—Å–∏–±–æ –∑–∞ –∫—É—Ä—Å!', course: '–ü—Ä–æ–¥–∞–∂–∏', time: '1 —á–∞—Å', unread: true,
      messages: [{ text: '–°–ø–∞—Å–∏–±–æ –∑–∞ –∫—É—Ä—Å!', incoming: true, time: '13:15' }]
    },
    { id: 3, sender: '–î–º–∏—Ç—Ä–∏–π –ü–µ—Ç—Ä–æ–≤', initials: '–î–ü', preview: '–ö–æ–≥–¥–∞ –Ω–æ–≤—ã–π —É—Ä–æ–∫?', course: 'Telegram Mini Apps', time: '2 —á–∞—Å–∞', unread: false,
      messages: [
        { text: '–ö–æ–≥–¥–∞ –Ω–æ–≤—ã–π —É—Ä–æ–∫?', incoming: true, time: '12:00' },
        { text: '–ó–∞–≤—Ç—Ä–∞ –≤ 18:00!', incoming: false, time: '12:05' }
    ]}
];

const studentsData = [
    { id: 1, name: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', initials: '–ú–°', course: 'Telegram Mini Apps', progress: 75, status: 'active' },
    { id: 2, name: '–ê–ª–µ–∫—Å–µ–π –ö–æ–∑–ª–æ–≤', initials: '–ê–ö', course: '–ü—Ä–æ–¥–∞–∂–∏', progress: 100, status: 'completed' },
    { id: 3, name: '–î–º–∏—Ç—Ä–∏–π –ü–µ—Ç—Ä–æ–≤', initials: '–î–ü', course: 'Telegram Mini Apps', progress: 45, status: 'active' },
    { id: 4, name: '–ê–Ω–Ω–∞ –ò–≤–∞–Ω–æ–≤–∞', initials: '–ê–ò', course: 'Telegram Mini Apps', progress: 90, status: 'active' },
    { id: 5, name: '–°–µ—Ä–≥–µ–π –í–æ–ª–∫–æ–≤', initials: '–°–í', course: '–ü—Ä–æ–¥–∞–∂–∏', progress: 100, status: 'completed' }
];

// ===== –°–û–°–¢–û–Ø–ù–ò–ï =====
let state = {
    currentPage: 'main',
    currentTab: 'home', // home, search, my-courses, profile
    currentCourse: null,
    darkMode: false,
    xp: 1250,
    level: 5,
    streak: 7,
    purchasedCourses: [],
    notes: [],
    selectedPlan: 'year',
    selectedRating: 0,
    selectedDiscount: 20,
    subscription: { status: 'trial', daysLeft: 10 },
    quizState: { currentQuestion: 0, score: 0, selectedAnswer: -1 },
    videoProgress: 0,
    isPlaying: false,
    user: { 
        isLoggedIn: false, 
        name: '', 
        email: '', 
        telegramId: null,
        isExpert: false, // –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ —ç–∫—Å–ø–µ—Ä—Ç?
        expertSince: null // –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —ç–∫—Å–ø–µ—Ä—Ç–∞
    },
    currentChatUser: null,
    unreadMessages: 2,
    isExpertModeOpen: false // –û—Ç–∫—Ä—ã—Ç –ª–∏ —Ä–µ–∂–∏–º —ç–∫—Å–ø–µ—Ä—Ç–∞
};

// ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
document.addEventListener('DOMContentLoaded', () => {
    initTelegramApp();
    loadState();
    checkAuth();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∂–∏–º —É—á–µ–Ω–∏–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    document.getElementById('studentMode').style.display = 'block';
    document.getElementById('expertMode').style.display = 'none';
    document.getElementById('subBanner').style.display = 'none';
    document.getElementById('headerStudent').style.display = 'flex';
    document.getElementById('headerExpert').style.display = 'none';
    
    renderCatalog();
    renderAchievementsPreview();
    renderExpertCourses();
    renderPromoCodes();
    
    if (state.user.isLoggedIn) {
        setTimeout(() => showToast('üëã', `–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, ${state.user.name}!`), 1000);
    }
});

function loadState() {
    const saved = localStorage.getItem('edugramState');
    if (saved) state = { ...state, ...JSON.parse(saved) };
}

function saveState() {
    localStorage.setItem('edugramState', JSON.stringify(state));
}

// ===== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø =====
function checkAuth() {
    document.getElementById('authScreen').classList.toggle('hidden', state.user.isLoggedIn);
}

function switchAuthTab(tab) {
    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
    document.getElementById(tab + 'Form').classList.add('active');
}

function selectAuthRole(role, el) {
    state.user.role = role;
    document.querySelectorAll('.auth-role').forEach(r => r.classList.remove('selected'));
    el.classList.add('selected');
}

function handleLogin() {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    if (!email || !password) { showToast('‚ö†Ô∏è', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); return; }
    
    state.user.isLoggedIn = true;
    state.user.email = email;
    state.user.name = email.split('@')[0];
    if (email.includes('expert')) state.user.role = 'expert';
    completeAuth();
}

function handleRegister() {
    const name = document.getElementById('registerName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    if (!name || !email || !password) { showToast('‚ö†Ô∏è', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è'); return; }
    if (password.length < 6) { showToast('‚ö†Ô∏è', '–ü–∞—Ä–æ–ª—å –º–∏–Ω. 6 —Å–∏–º–≤–æ–ª–æ–≤'); return; }
    
    state.user.isLoggedIn = true;
    state.user.name = name;
    state.user.email = email;
    completeAuth();
}

function loginWithTelegram() {
    state.user.isLoggedIn = true;
    state.user.name = 'Telegram User';
    showToast('üì±', '–í—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram...');
    setTimeout(completeAuth, 1000);
}

function completeAuth() {
    document.getElementById('authScreen').classList.add('hidden');
    saveState();
    if (state.user.role === 'expert') switchMode('expert');
    showToast('üëã', `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${state.user.name}!`);
}

// ===== –†–ï–ù–î–ï–† =====
function renderCatalog() {
    document.getElementById('catalogCourses').innerHTML = coursesData.map(c => `
        <div class="course-card" onclick="openCourse(${c.id})">
            <div class="course-image" style="background: ${c.gradient}">
                ${c.icon}
                ${c.badge ? `<div class="course-badge" style="background: ${c.badgeColor}">${c.badge}</div>` : ''}
                <div class="course-rating">‚≠ê ${c.rating}</div>
            </div>
            <div class="course-content">
                <h3 class="course-title">${c.title}</h3>
                <div class="course-author">
                    <div class="author-avatar">${c.authorInitials}</div>
                    <span class="author-name">${c.author}</span>
                </div>
                <div class="course-stats">
                    <span>üë• ${c.students}</span>
                    <span>üìö ${c.lessons}</span>
                    <span>‚è± ${c.hours}—á</span>
                </div>
                <div class="course-footer">
                    <div>
                        <span class="course-price">${c.price.toLocaleString()} ‚≠ê</span>
                        ${c.oldPrice ? `<span class="course-price-old">${c.oldPrice.toLocaleString()}</span>` : ''}
                    </div>
                    <button class="buy-btn ${state.purchasedCourses.includes(c.id) ? 'purchased' : ''}" onclick="buyCourse(event, ${c.id})">
                        ${state.purchasedCourses.includes(c.id) ? '‚úì' : '–ö—É–ø–∏—Ç—å'}
                    </button>
                </div>
            </div>
        </div>
    `).join('');
}

function renderPurchasedCourses() {
    const container = document.getElementById('purchasedCourses');
    if (state.purchasedCourses.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">–ù–µ—Ç –∫—É—Ä—Å–æ–≤</p>';
        return;
    }
    container.innerHTML = coursesData.filter(c => state.purchasedCourses.includes(c.id)).map(c => `
        <div class="course-card" onclick="openCourse(${c.id})">
            <div class="course-image" style="background: ${c.gradient}">${c.icon}</div>
            <div class="course-content">
                <h3 class="course-title">${c.title}</h3>
                <div class="course-progress">
                    <div class="progress-header">
                        <span class="progress-title">–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                        <span class="progress-percent">65%</span>
                    </div>
                    <div class="progress-bar-full"><div class="progress-bar-fill" style="width: 65%;"></div></div>
                </div>
                <button class="buy-btn" style="width: 100%; margin-top: 12px;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí</button>
            </div>
        </div>
    `).join('');
}

function renderAchievementsPreview() {
    document.getElementById('achievementsPreview').innerHTML = achievementsData.slice(0, 4).map(a => `
        <div class="achievement-item ${a.unlocked ? 'unlocked' : 'locked'}" onclick="showAchievementsModal()">
            <div class="achievement-icon">${a.icon}</div>
            <div class="achievement-name">${a.name}</div>
        </div>
    `).join('');
}

function renderAchievementsFull() {
    const unlocked = achievementsData.filter(a => a.unlocked);
    const locked = achievementsData.filter(a => !a.unlocked);
    document.getElementById('achievementsList').innerHTML = `
        <div class="achievement-category">
            <div class="category-title">üèÜ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ (${unlocked.length})</div>
            ${unlocked.map(a => `
                <div class="achievement-full unlocked">
                    <div class="achievement-icon">${a.icon}</div>
                    <div class="achievement-details">
                        <div class="achievement-full-name">${a.name}</div>
                        <div class="achievement-desc">${a.desc}</div>
                    </div>
                    <div class="achievement-xp">+${a.xp}</div>
                </div>
            `).join('')}
        </div>
        <div class="achievement-category">
            <div class="category-title">üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ (${locked.length})</div>
            ${locked.map(a => `
                <div class="achievement-full locked">
                    <div class="achievement-icon">${a.icon}</div>
                    <div class="achievement-details">
                        <div class="achievement-full-name">${a.name}</div>
                        <div class="achievement-desc">${a.desc}</div>
                    </div>
                    <div class="achievement-xp">+${a.xp}</div>
                </div>
            `).join('')}
        </div>
    `;
}

function renderExpertCourses() {
    document.getElementById('expertCoursesList').innerHTML = expertCoursesData.map(c => `
        <div class="my-course-item">
            <div class="my-course-thumb">${c.icon}</div>
            <div class="my-course-info">
                <div class="my-course-title">${c.title}</div>
                <div class="my-course-stats"><span>üë• ${c.students}</span><span>üí∞ ${c.earnings}</span></div>
            </div>
            <button class="share-link-btn" onclick="copyLink(event, ${c.id})">üìã</button>
        </div>
    `).join('');
}

function renderPromoCodes() {
    document.getElementById('promoList').innerHTML = promoCodesData.map(p => `
        <div class="promo-card">
            <div class="promo-code">${p.code}</div>
            <div class="promo-info"><div class="promo-uses">${p.uses}/${p.limit || '‚àû'}</div></div>
            <div class="promo-discount">-${p.discount}%</div>
        </div>
    `).join('');
}

function renderLessons() {
    document.getElementById('lessonsList').innerHTML = lessonsData.map((l, i) => `
        <div class="lesson-item ${l.completed ? 'completed' : ''} ${l.current ? 'current' : ''}" onclick="selectLesson(${i})">
            <div class="lesson-number">${l.completed ? '‚úì' : i + 1}</div>
            <div class="lesson-info">
                <div class="lesson-title">${l.title}</div>
                <div class="lesson-duration">${l.duration}</div>
            </div>
            <span>${l.completed ? '‚úÖ' : l.current ? '‚ñ∂Ô∏è' : 'üîí'}</span>
        </div>
    `).join('');
}

function renderQuiz() {
    const q = quizData[state.quizState.currentQuestion];
    if (!q) return;
    document.getElementById('quizQuestionNum').textContent = state.quizState.currentQuestion + 1;
    document.getElementById('quizQuestion').textContent = q.question;
    document.getElementById('quizOptions').innerHTML = q.options.map((opt, i) => `
        <div class="quiz-option" onclick="selectQuizOption(${i})">
            <span class="option-letter">${String.fromCharCode(65 + i)}</span>
            <span>${opt}</span>
        </div>
    `).join('');
}

function renderQA() {
    document.getElementById('qaList').innerHTML = qaData.map(q => `
        <div class="qa-item">
            <div class="qa-question">
                <div class="qa-avatar">${q.initials}</div>
                <div class="qa-content">
                    <div class="qa-author">${q.author}</div>
                    <div class="qa-text">${q.text}</div>
                    <div class="qa-meta"><span>üëç ${q.likes}</span><span>${q.time}</span></div>
                </div>
            </div>
            ${q.answer ? `<div class="qa-answer"><div class="qa-question"><div class="qa-avatar" style="background: var(--success)">${q.answer.initials}</div><div class="qa-content"><div class="qa-author">${q.answer.author} <span class="expert-badge">–≠–∫—Å–ø–µ—Ä—Ç</span></div><div class="qa-text">${q.answer.text}</div></div></div></div>` : ''}
        </div>
    `).join('');
}

function renderReviews() {
    document.getElementById('reviewsList').innerHTML = reviewsData.map(r => `
        <div class="review-item">
            <div class="review-header">
                <div class="review-author-info">
                    <div class="qa-avatar">${r.initials}</div>
                    <div><div class="qa-author">${r.author}</div><div class="review-stars">${'‚≠ê'.repeat(r.rating)}</div></div>
                </div>
                <span style="font-size: 12px; color: #666;">${r.time}</span>
            </div>
            <div class="qa-text">${r.text}</div>
        </div>
    `).join('');
}

function renderNotes() {
    const container = document.getElementById('notesList');
    if (state.notes.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">–ù–µ—Ç –∑–∞–º–µ—Ç–æ–∫</p>';
        return;
    }
    container.innerHTML = state.notes.map((n, i) => `
        <div class="note-item">
            <div class="note-timestamp">üìπ ${n.lesson} ‚Ä¢ <span>${n.timestamp}</span></div>
            <div class="note-text">${n.text}</div>
            <div class="note-actions"><button class="note-action-btn" onclick="deleteNote(${i})">üóë</button></div>
        </div>
    `).join('');
}

function renderMessages() {
    document.getElementById('messagesList').innerHTML = messagesData.map(m => `
        <div class="message-item ${m.unread ? 'unread' : ''}" onclick="openChat(${m.id})">
            <div class="message-avatar">${m.initials}</div>
            <div class="message-content">
                <div class="message-header">
                    <span class="message-sender">${m.sender}</span>
                    <span class="message-time">${m.time}</span>
                </div>
                <div class="message-preview">${m.preview}</div>
                <div class="message-course">üìö ${m.course}</div>
            </div>
            ${m.unread ? '<div class="unread-dot"></div>' : ''}
        </div>
    `).join('');
}

function renderStudents() {
    const total = studentsData.length;
    const active = studentsData.filter(s => s.status === 'active').length;
    const completed = studentsData.filter(s => s.status === 'completed').length;
    
    document.getElementById('totalStudents').textContent = total;
    document.getElementById('activeStudents').textContent = active;
    document.getElementById('completedStudents').textContent = completed;
    document.getElementById('headerStudentsCount').textContent = total;
    document.getElementById('expertStudentsCount').textContent = total;
    
    document.getElementById('studentsList').innerHTML = studentsData.map(s => `
        <div class="student-item">
            <div class="student-avatar">${s.initials}</div>
            <div class="student-info">
                <div class="student-name">${s.name}</div>
                <div class="student-course">üìö ${s.course}</div>
            </div>
            <div class="student-progress">
                <div class="student-progress-value">${s.progress}%</div>
                <div class="student-progress-label">${s.status === 'completed' ? '‚úÖ' : 'üìñ'}</div>
            </div>
        </div>
    `).join('');
}

// ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø –ü–û –¢–ê–ë–ê–ú =====
function navigateToTab(tab) {
    hapticFeedback('light');
    state.currentTab = tab;
    
    // –£–±–∏—Ä–∞–µ–º active —Å–æ –≤—Å–µ—Ö —Ç–∞–±–æ–≤
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.getElementById('mainPage').classList.remove('active');
    document.getElementById('coursePage').classList.remove('active');
    document.getElementById('profilePage').classList.remove('active');
    document.getElementById('expertModePage').classList.remove('active');
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω—É–∂–Ω—ã–π —Ç–∞–±
    const navItems = document.querySelectorAll('.nav-item');
    
    switch(tab) {
        case 'home':
            document.getElementById('mainPage').classList.add('active');
            document.getElementById('studentMode').style.display = 'block';
            document.getElementById('expertMode').style.display = 'none';
            switchStudentTab('catalog');
            navItems[0].classList.add('active');
            if (tg) tg.BackButton.hide();
            break;
            
        case 'search':
            showToast('üîç', '–ü–æ–∏—Å–∫ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω');
            navItems[1].classList.add('active');
            break;
            
        case 'my-courses':
            document.getElementById('mainPage').classList.add('active');
            document.getElementById('studentMode').style.display = 'block';
            document.getElementById('expertMode').style.display = 'none';
            switchStudentTab('myCourses');
            navItems[2].classList.add('active');
            if (tg) tg.BackButton.hide();
            break;
            
        case 'profile':
            document.getElementById('profilePage').classList.add('active');
            navItems[3].classList.add('active');
            updateProfilePage();
            if (tg) tg.BackButton.hide();
            break;
    }
    
    state.currentPage = 'main';
    document.getElementById('headerTitle').textContent = 'üìö EduGram';
}

function navigateTo(page) {
    hapticFeedback('light');
    
    if (page === 'home') {
        navigateToTab('home');
    }
}

// ===== –°–¢–†–ê–ù–ò–¶–ê –ü–†–û–§–ò–õ–Ø =====
function updateProfilePage() {
    document.getElementById('profileName').textContent = state.user.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
    document.getElementById('profileEmail').textContent = state.user.email || '–ù–µ —É–∫–∞–∑–∞–Ω';
    document.getElementById('profileXP').textContent = state.xp.toLocaleString();
    document.getElementById('profileCourses').textContent = state.purchasedCourses.length;
    document.getElementById('profileStreak').textContent = state.streak;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —ç–∫—Å–ø–µ—Ä—Ç–∞
    const expertBtn = document.getElementById('expertModeBtn');
    const expertTitle = document.getElementById('expertBtnTitle');
    const expertDesc = document.getElementById('expertBtnDesc');
    
    if (state.user.isExpert) {
        expertTitle.textContent = '–†–µ–∂–∏–º —ç–∫—Å–ø–µ—Ä—Ç–∞';
        expertDesc.textContent = '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞–º–∏ –∏ —É—á–µ–Ω–∏–∫–∞–º–∏';
    } else {
        expertTitle.textContent = '–°—Ç–∞—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–æ–º';
        expertDesc.textContent = '–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏ –ø—Ä–æ–¥–∞–≤–∞–π—Ç–µ –∫—É—Ä—Å—ã';
    }
}

function showProfile() {
    navigateToTab('profile');
}

function showMyPurchases() {
    navigateToTab('my-courses');
}

function showSettings() {
    showToast('‚öôÔ∏è', '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
}

// ===== –†–ï–ñ–ò–ú –≠–ö–°–ü–ï–†–¢–ê =====
function openExpertMode() {
    hapticFeedback('medium');
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —ç–∫—Å–ø–µ—Ä—Ç–∞
    document.getElementById('expertModePage').classList.add('active');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
    if (state.user.isExpert) {
        // –£–∂–µ —ç–∫—Å–ø–µ—Ä—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å
        document.getElementById('expertRegistration').style.display = 'none';
        document.getElementById('expertPanel').style.display = 'block';
        updateExpertPanel();
        switchExpertPanelTab('dashboard');
    } else {
        // –ù–µ —ç–∫—Å–ø–µ—Ä—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
        document.getElementById('expertRegistration').style.display = 'block';
        document.getElementById('expertPanel').style.display = 'none';
    }
    
    state.isExpertModeOpen = true;
    
    // –°–∫—Ä—ã–≤–∞–µ–º –Ω–∏–∂–Ω—é—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é
    document.getElementById('mainNav').style.display = 'none';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞–∑–∞–¥ Telegram
    if (tg) tg.BackButton.show();
}

function closeExpertMode() {
    hapticFeedback('light');
    
    state.isExpertModeOpen = false;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
    document.getElementById('mainNav').style.display = 'flex';
    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª—å
    navigateToTab('profile');
}

function registerAsExpert() {
    hapticFeedback('success');
    
    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–∞–∫ —ç–∫—Å–ø–µ—Ä—Ç–∞
    state.user.isExpert = true;
    state.user.expertSince = new Date().toISOString();
    state.subscription = { status: 'trial', daysLeft: 10 };
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–µ—Ä—Ç–∞
    if (!state.expertData) {
        state.expertData = {
            courses: [],
            students: 0,
            earnings: 0,
            promoCodes: [],
            messages: []
        };
    }
    
    saveState();
    
    showToast('üéâ', '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —ç–∫—Å–ø–µ—Ä—Ç—ã!');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —ç–∫—Å–ø–µ—Ä—Ç–∞
    setTimeout(() => {
        document.getElementById('expertRegistration').style.display = 'none';
        document.getElementById('expertPanel').style.display = 'block';
        updateExpertPanel();
    }, 500);
}



// ===== –í–´–•–û–î –ò–ó –ê–ö–ö–ê–£–ù–¢–ê =====
function logout() {
    if (confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) {
        hapticFeedback('medium');
        
        state.user = { 
            isLoggedIn: false, 
            name: '', 
            email: '', 
            telegramId: null,
            isExpert: false,
            expertSince: null
        };
        
        saveState();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        document.getElementById('authScreen').classList.remove('hidden');
        navigateToTab('home');
        
        showToast('üëã', '–î–æ —Å–≤–∏–¥–∞–Ω–∏—è!');
    }
}

// ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø =====
function navigateTo(page) {
    hapticFeedback('light'); // –ù–û–í–û–ï: –≤–∏–±—Ä–∞—Ü–∏—è
    
    if (page === 'home') {
        document.getElementById('mainPage').classList.add('active');
        document.getElementById('coursePage').classList.remove('active');
        document.getElementById('backBtn').classList.remove('visible');
        document.getElementById('headerTitle').textContent = 'üìö EduGram';
        document.getElementById('addNoteFab').classList.remove('visible');
        state.currentPage = 'main';
        
        // –ù–û–í–û–ï: —Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫–∏ Telegram
        if (tg) {
            tg.BackButton.hide();
            tg.MainButton.hide();
        }
    }
}

function goBack() { navigateTo('home'); }

function openCourse(id) {
    hapticFeedback('light'); // –ù–û–í–û–ï: –≤–∏–±—Ä–∞—Ü–∏—è
    
    state.currentCourse = coursesData.find(c => c.id === id);
    document.getElementById('mainPage').classList.remove('active');
    document.getElementById('coursePage').classList.add('active');
    document.getElementById('backBtn').classList.add('visible');
    document.getElementById('headerTitle').textContent = state.currentCourse.title;
    document.getElementById('addNoteFab').classList.add('visible');
    state.currentPage = 'course';
    
    // –ù–û–í–û–ï: Telegram –∫–Ω–æ–ø–∫–∏
    if (tg) {
        tg.BackButton.show();
        
        if (!state.purchasedCourses.includes(id)) {
            showMainButton(`–ö—É–ø–∏—Ç—å –∑–∞ ${state.currentCourse.price} ‚≠ê`, () => {
                buyCourse(null, id);
            });
        }
    }
    
    renderLessons(); 
    renderQuiz(); 
    renderQA(); 
    renderReviews(); 
    renderNotes();
    switchLessonTab('lessons');
}

function buyCourse(event, id) {
    event?.stopPropagation();
    if (state.purchasedCourses.includes(id)) { 
        openCourse(id); 
        return; 
    }
    
    hapticFeedback('medium'); // –ù–û–í–û–ï: –≤–∏–±—Ä–∞—Ü–∏—è
    
    state.purchasedCourses.push(id);
    addXP(100);
    saveState();
    renderCatalog(); 
    renderPurchasedCourses();
    document.getElementById('statCourses').textContent = state.purchasedCourses.length;
    showToast('‚úÖ', '–ö—É—Ä—Å –∫—É–ø–ª–µ–Ω! +100 XP');
    
    hideMainButton(); // –ù–û–í–û–ï: —Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É –ø–æ–∫—É–ø–∫–∏
}

// ===== –†–ï–ñ–ò–ú–´ –ò –¢–ê–ë–´ =====
function switchMode(mode) {
    state.currentMode = mode;
    document.getElementById('studentModeBtn').classList.toggle('active', mode === 'student');
    document.getElementById('expertModeBtn').classList.toggle('active', mode === 'expert');
    document.getElementById('studentMode').style.display = mode === 'student' ? 'block' : 'none';
    document.getElementById('expertMode').style.display = mode === 'expert' ? 'block' : 'none';
    document.getElementById('subBanner').style.display = mode === 'expert' ? 'flex' : 'none';
    document.getElementById('headerStudent').style.display = mode === 'student' ? 'flex' : 'none';
    document.getElementById('headerExpert').style.display = mode === 'expert' ? 'flex' : 'none';
    
    if (mode === 'expert') { updateSubscriptionUI(); updateMessagesCount(); }
}

function switchStudentTab(tab) {
    document.querySelectorAll('#studentMode .tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    document.querySelectorAll('#studentMode .tab-content').forEach(c => c.style.display = 'none');
    document.getElementById(tab + 'Tab').style.display = 'block';
    if (tab === 'myCourses') renderPurchasedCourses();
}

function switchExpertTab(tab) {
    // –ò—â–µ–º —Ç–∞–±—ã –≤–Ω—É—Ç—Ä–∏ expertPanel –µ—Å–ª–∏ —Ä–µ–∂–∏–º –æ—Ç–∫—Ä—ã—Ç, –∏–Ω–∞—á–µ –≤ expertMode
    const container = state.isExpertModeOpen ? 
        document.getElementById('expertPanel') : 
        document.getElementById('expertMode');
    
    if (!container) return;
    
    container.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    
    // –ù–∞—Ö–æ–¥–∏–º –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω—É–∂–Ω—ã–π —Ç–∞–±
    const tabs = container.querySelectorAll('.tab');
    const tabIndex = { 'dashboard': 0, 'myCourses': 1, 'promo': 2, 'analytics': 3 };
    if (tabs[tabIndex[tab]]) {
        tabs[tabIndex[tab]].classList.add('active');
    }
    
    container.querySelectorAll('.expert-tab-content').forEach(c => c.style.display = 'none');
    
    const tabMap = { 
        'dashboard': 'dashboardTab', 
        'myCourses': 'myCoursesExpertTab', 
        'promo': 'promoTab', 
        'analytics': 'analyticsTab' 
    };
    
    const tabElement = container.querySelector('#' + tabMap[tab]);
    if (tabElement) {
        tabElement.style.display = 'block';
    }
}

function switchLessonTab(tab) {
    document.querySelectorAll('.lesson-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    document.querySelectorAll('.lesson-content').forEach(c => c.style.display = 'none');
    document.getElementById(tab + 'Content').style.display = 'block';
}

// ===== –í–ò–î–ï–û =====
function toggleVideo() {
    state.isPlaying = !state.isPlaying;
    
    if (state.isPlaying) {
        simulateVideoProgress();
        document.querySelector('.play-btn').textContent = '‚è∏Ô∏è';
        document.getElementById('playPauseBtn').textContent = '‚è∏Ô∏è';
    } else {
        // –ù–û–í–û–ï: –æ—á–∏—Å—Ç–∫–∞ —Ç–∞–π–º–µ—Ä–∞
        if (videoTimer) {
            clearTimeout(videoTimer);
            videoTimer = null;
        }
        document.querySelector('.play-btn').textContent = '‚ñ∂Ô∏è';
        document.getElementById('playPauseBtn').textContent = '‚ñ∂Ô∏è';
    }
}

function simulateVideoProgress() {
    if (!state.isPlaying) {
        if (videoTimer) clearTimeout(videoTimer); // –ù–û–í–û–ï: –æ—á–∏—Å—Ç–∫–∞ —Ç–∞–π–º–µ—Ä–∞
        return;
    }
    
    state.videoProgress += 1;
    document.getElementById('videoProgress').style.width = state.videoProgress + '%';
    
    const current = Math.floor(state.videoProgress * 9.3);
    const mins = Math.floor(current / 60);
    const secs = current % 60;
    document.getElementById('videoTime').textContent = 
        `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')} / 15:30`;
    
    if (state.videoProgress < 100) {
        videoTimer = setTimeout(simulateVideoProgress, 100); // –ù–û–í–û–ï: —Å–æ—Ö—Ä–∞–Ω—è–µ–º ID —Ç–∞–π–º–µ—Ä–∞
    } else {
        state.isPlaying = false;
        document.querySelector('.play-btn').textContent = '‚ñ∂Ô∏è';
        document.getElementById('playPauseBtn').textContent = '‚ñ∂Ô∏è';
        addXP(50);
        showToast('üéâ', '–£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω! +50 XP');
    }
}

function seekVideo(event) {
    const rect = event.currentTarget.getBoundingClientRect();
    state.videoProgress = ((event.clientX - rect.left) / rect.width) * 100;
    document.getElementById('videoProgress').style.width = state.videoProgress + '%';
}

function selectLesson(index) {
    lessonsData.forEach((l, i) => {
        l.current = i === index;
    });
    document.getElementById('currentLessonTitle').textContent = lessonsData[index].title;
    state.videoProgress = 0;
    renderLessons();
}

// ===== –ö–í–ò–ó =====
function selectQuizOption(index) {
    state.quizState.selectedAnswer = index;
    document.querySelectorAll('.quiz-option').forEach((o, i) => {
        o.classList.toggle('selected', i === index);
    });
}

function submitQuizAnswer() {
    if (state.quizState.selectedAnswer === -1) {
        showToast('‚ö†Ô∏è', '–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç');
        return;
    }
    
    const q = quizData[state.quizState.currentQuestion];
    const options = document.querySelectorAll('.quiz-option');
    
    if (state.quizState.selectedAnswer === q.correct) {
        options[state.quizState.selectedAnswer].classList.add('correct');
        state.quizState.score++;
        addXP(20);
        showToast('‚úÖ', '–ü—Ä–∞–≤–∏–ª—å–Ω–æ! +20 XP');
    } else {
        options[state.quizState.selectedAnswer].classList.add('wrong');
        options[q.correct].classList.add('correct');
        showToast('‚ùå', '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ');
    }
    
    setTimeout(() => {
        state.quizState.currentQuestion++;
        state.quizState.selectedAnswer = -1;
        
        if (state.quizState.currentQuestion >= quizData.length) {
            showToast('üéì', `–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω! –†–µ–∑—É–ª—å—Ç–∞—Ç: ${state.quizState.score}/${quizData.length}`);
            if (state.quizState.score === quizData.length) {
                setTimeout(() => showCertificate(), 1500);
            }
            state.quizState.currentQuestion = 0;
            state.quizState.score = 0;
        }
        renderQuiz();
    }, 1500);
}

// ===== Q&A =====
function sendQuestion() {
    const input = document.getElementById('qaInput');
    if (!input.value.trim()) return;
    
    qaData.unshift({
        author: '–í—ã',
        initials: '–í–´',
        text: input.value,
        likes: 0,
        time: '–¢–æ–ª—å–∫–æ —á—Ç–æ',
        answer: null
    });
    
    input.value = '';
    renderQA();
    addXP(5);
    showToast('‚úÖ', '–í–æ–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! +5 XP');
}

function likeQuestion(el) {
    const current = parseInt(el.textContent.split(' ')[1]);
    el.textContent = `üëç ${current + 1}`;
}

// ===== –û–¢–ó–´–í–´ =====
function showReviewModal() {
    hapticFeedback('light');
    state.selectedRating = 0;
    updateRatingStars();
    document.getElementById('reviewText').value = '';
    document.getElementById('reviewModal').classList.add('active');
}

function selectRating(rating) {
    state.selectedRating = rating;
    updateRatingStars();
}

function updateRatingStars() {
    document.querySelectorAll('#ratingSelect .rating-star').forEach((s, i) => {
        s.classList.toggle('selected', i < state.selectedRating);
    });
}

function submitReview() {
    const text = document.getElementById('reviewText').value;
    if (!text.trim() || state.selectedRating === 0) {
        showToast('‚ö†Ô∏è', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
        return;
    }
    
    reviewsData.unshift({
        author: '–í—ã',
        initials: '–í–´',
        rating: state.selectedRating,
        text: text,
        time: '–¢–æ–ª—å–∫–æ —á—Ç–æ'
    });
    
    document.getElementById('reviewText').value = '';
    closeModal('reviewModal');
    renderReviews();
    addXP(30);
    showToast('‚úÖ', '–û—Ç–∑—ã–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! +30 XP');
}

// ===== –ó–ê–ú–ï–¢–ö–ò =====
function showAddNoteModal() {
    hapticFeedback('light');
    const mins = Math.floor(state.videoProgress * 9.3 / 60);
    const secs = Math.floor(state.videoProgress * 9.3 % 60);
    document.getElementById('noteTimestamp').textContent = 
        `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    document.getElementById('noteText').value = '';
    document.getElementById('noteModal').classList.add('active');
    
    // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
    setTimeout(() => {
        document.getElementById('noteText').focus();
    }, 400);
}

function saveNote() {
    const text = document.getElementById('noteText').value;
    if (!text.trim()) {
        showToast('‚ö†Ô∏è', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏');
        return;
    }
    
    state.notes.unshift({
        lesson: lessonsData.find(l => l.current)?.title || '–£—Ä–æ–∫',
        timestamp: document.getElementById('noteTimestamp').textContent,
        text: text
    });
    
    document.getElementById('noteText').value = '';
    closeModal('noteModal');
    renderNotes();
    saveState();
    showToast('üìù', '–ó–∞–º–µ—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');
}

function deleteNote(index) {
    state.notes.splice(index, 1);
    renderNotes();
    saveState();
    showToast('üóë', '–ó–∞–º–µ—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
}

// ===== –ü–†–û–ú–û–ö–û–î–´ =====
function showCreatePromoModal() {
    hapticFeedback('light');
    document.getElementById('promoCodeInput').value = '';
    document.getElementById('promoLimitInput').value = '100';
    document.getElementById('promoModal').classList.add('active');
}

function selectDiscount(discount, el) {
    state.selectedDiscount = discount;
    document.querySelectorAll('.discount-option').forEach(o => o.classList.remove('selected'));
    el.classList.add('selected');
}

function createPromoCode() {
    const code = document.getElementById('promoCodeInput').value.toUpperCase();
    const limit = document.getElementById('promoLimitInput').value;
    
    if (!code) {
        showToast('‚ö†Ô∏è', '–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞');
        return;
    }
    
    promoCodesData.push({
        code: code,
        discount: state.selectedDiscount,
        uses: 0,
        limit: limit ? parseInt(limit) : null
    });
    
    document.getElementById('promoCodeInput').value = '';
    closeModal('promoModal');
    renderPromoCodes();
    showToast('‚úÖ', `–ü—Ä–æ–º–æ–∫–æ–¥ ${code} —Å–æ–∑–¥–∞–Ω!`);
}

// ===== –ü–û–î–ü–ò–°–ö–ê =====
function updateSubscriptionUI() {
    const banner = document.getElementById('subBanner');
    const bannerText = document.getElementById('bannerText');
    const subCard = document.getElementById('subCard');
    const subStatus = document.getElementById('subStatus');
    const blockedOverlay = document.getElementById('blockedOverlay');
    const createBtn = document.getElementById('createCourseBtn');
    
    switch (state.subscription.status) {
        case 'trial':
            banner.className = 'subscription-banner trial';
            bannerText.textContent = `‚è∞ –ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥: ${state.subscription.daysLeft} –¥–Ω–µ–π`;
            subCard.className = 'subscription-card trial';
            subStatus.textContent = `–ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥: ${state.subscription.daysLeft} –¥–Ω–µ–π`;
            blockedOverlay.classList.remove('active');
            createBtn.disabled = false;
            break;
        case 'active':
            banner.className = 'subscription-banner active';
            bannerText.textContent = 'üëë PRO –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞';
            subCard.className = 'subscription-card active';
            subStatus.textContent = 'PRO –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞';
            blockedOverlay.classList.remove('active');
            createBtn.disabled = false;
            break;
        case 'expired':
            banner.className = 'subscription-banner expired';
            bannerText.textContent = 'üîí –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞';
            subCard.className = 'subscription-card expired';
            subStatus.textContent = '–ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞';
            blockedOverlay.classList.add('active');
            createBtn.disabled = true;
            break;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–∞–ª–∫—É
    document.getElementById('trialDays').textContent = state.subscription.daysLeft;
    document.getElementById('trialProgressFill').style.width = (state.subscription.daysLeft / 10 * 100) + '%';
}

function selectPlan(plan) {
    state.selectedPlan = plan;
    document.querySelectorAll('.plan-card').forEach(c => c.classList.remove('selected'));
    event.currentTarget.classList.add('selected');
    document.getElementById('selectedPlanPrice').textContent = plan === 'year' ? '7,128 ‚ÇΩ' : '990 ‚ÇΩ';
}

function processPayment() {
    const btn = event.currentTarget;
    btn.innerHTML = '‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...';
    btn.disabled = true;
    
    setTimeout(() => {
        closeModal('subscriptionModal');
        document.getElementById('successOverlay').classList.add('active');
        
        state.subscription.status = 'active';
        state.subscription.daysLeft = state.selectedPlan === 'year' ? 365 : 30;
        saveState();
        
        setTimeout(() => {
            document.getElementById('successOverlay').classList.remove('active');
            updateSubscriptionUI();
            showToast('üéâ', '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ PRO!');
        }, 2500);
        
        btn.innerHTML = 'üí≥ –û–ø–ª–∞—Ç–∏—Ç—å <span id="selectedPlanPrice">7,128 ‚ÇΩ</span>';
        btn.disabled = false;
    }, 2000);
}

// ===== –î–û–°–¢–ò–ñ–ï–ù–ò–Ø –ò XP =====
function addXP(amount) {
    state.xp += amount;
    document.getElementById('userXP').textContent = state.xp.toLocaleString();
    document.getElementById('statXP').textContent = state.xp.toLocaleString();
    document.getElementById('modalXP').textContent = state.xp.toLocaleString();
    
    const newLevel = Math.floor(state.xp / 300) + 1;
    if (newLevel > state.level) {
        state.level = newLevel;
        document.getElementById('userLevel').textContent = `LVL ${state.level}`;
        document.getElementById('modalLevel').textContent = state.level;
        showToast('üéâ', `–ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å: ${state.level}!`);
    }
    saveState();
}

function showAchievementsModal() {
    hapticFeedback('light');
    document.getElementById('modalXP').textContent = state.xp.toLocaleString();
    document.getElementById('modalLevel').textContent = state.level;
    document.getElementById('modalAchievements').textContent = achievementsData.filter(a => a.unlocked).length;
    document.getElementById('levelProgressFill').style.width = ((state.xp % 300) / 300 * 100) + '%';
    renderAchievementsFull();
    document.getElementById('achievementsModal').classList.add('active');
}

function showStreakInfo() {
    showToast('üî•', `–í—ã —É—á–∏—Ç–µ—Å—å ${state.streak} –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥!`);
}

// ===== –°–ï–†–¢–ò–§–ò–ö–ê–¢ =====
function showCertificate() {
    document.getElementById('certName').textContent = '–ê—Ä—Ç–µ–º –ò–≤–∞–Ω–æ–≤';
    document.getElementById('certCourse').textContent = `"${state.currentCourse?.title || '–ö—É—Ä—Å'}"`;
    document.getElementById('certDate').textContent = new Date().toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' });
    document.getElementById('certificateModal').classList.add('active');
}

function downloadCertificate() {
    showToast('üì•', '–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è...');
}

function shareCertificate() {
    showToast('üì§', '–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º');
}

// ===== –ü–†–û–ß–ï–ï =====
function copyLink(event, id) {
    event.stopPropagation();
    const link = `t.me/EduGramBot/app?course=${id}`;
    navigator.clipboard?.writeText(link);
    showToast('üìã', `–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞: ${link}`);
}

function createCourse() {
    if (state.subscription.status === 'expired') {
        showSubscriptionModal();
        return;
    }
    const name = prompt('–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞:');
    if (name) {
        expertCoursesData.push({
            id: expertCoursesData.length + 1,
            title: name,
            icon: 'üìö',
            students: 0,
            earnings: '0 ‚≠ê'
        });
        renderExpertCourses();
        document.getElementById('expertCoursesCount').textContent = expertCoursesData.length;
        showToast('‚úÖ', `–ö—É—Ä—Å "${name}" —Å–æ–∑–¥–∞–Ω!`);
    }
}

function toggleDarkMode() {
    state.darkMode = !state.darkMode;
    document.body.classList.toggle('dark-mode', state.darkMode);
    saveState();
    showToast('üåô', state.darkMode ? '–¢–µ–º–Ω–∞—è —Ç–µ–º–∞' : '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞');
}

function showSearch() {
    showToast('üîç', '–ü–æ–∏—Å–∫ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω');
}

function showProfile() {
    switchMode('student');
    switchStudentTab('stats');
}

// ===== –ú–û–î–ê–õ–ö–ò =====
function showSubscriptionModal() {
    document.getElementById('subscriptionModal').classList.add('active');
}

function showMessagesModal() {
    hapticFeedback('light');
    renderMessages();
    document.getElementById('messagesModal').classList.add('active');
}

function showStudentsModal() {
    hapticFeedback('light');
    renderStudents();
    document.getElementById('studentsModal').classList.add('active');
}

function closeModal(id) {
    document.getElementById(id).classList.remove('active');
}

function closeModalOnBackdrop(event, id) {
    if (event.target === event.currentTarget) {
        closeModal(id);
    }
}

// ===== TOAST =====
function showToast(icon, text) {
    // –ù–û–í–û–ï: –≤–∏–±—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    if (icon === '‚úÖ') hapticFeedback('success');
    else if (icon === '‚ö†Ô∏è' || icon === '‚ùå') hapticFeedback('error');
    else hapticFeedback('light');
    
    const toast = document.getElementById('toast');
    toast.querySelector('.toast-icon').textContent = icon;
    toast.querySelector('.toast-text').textContent = text;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3000);
}
// ===== –ü–ê–ù–ï–õ–¨ –≠–ö–°–ü–ï–†–¢–ê =====

function switchExpertPanelTab(tab) {
    hapticFeedback('light');
    
    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö —Ç–∞–±–æ–≤
    document.querySelectorAll('#expertPanel .tab').forEach(t => t.classList.remove('active'));
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ç–∞–±—ã
    document.querySelectorAll('.expert-panel-tab').forEach(t => t.style.display = 'none');
    
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω—É–∂–Ω—ã–π —Ç–∞–±
    const tabIndex = { 'dashboard': 0, 'courses': 1, 'promo': 2, 'analytics': 3 };
    const tabs = document.querySelectorAll('#expertPanel .tab');
    if (tabs[tabIndex[tab]]) {
        tabs[tabIndex[tab]].classList.add('active');
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Ç–∞–±–∞
    const tabMap = {
        'dashboard': 'expertDashboardTab',
        'courses': 'expertCoursesTab',
        'promo': 'expertPromoTab',
        'analytics': 'expertAnalyticsTab'
    };
    
    const tabElement = document.getElementById(tabMap[tab]);
    if (tabElement) {
        tabElement.style.display = 'block';
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–∞–±–∞
    if (tab === 'dashboard') updateExpertDashboard();
    if (tab === 'courses') updateExpertCourses();
    if (tab === 'promo') updateExpertPromo();
    if (tab === 'analytics') updateExpertAnalytics();
}

function updateExpertPanel() {
    updateExpertDashboard();
    updateSubscriptionUIExpert();
}

function updateExpertDashboard() {
    const data = state.expertData || { courses: [], students: 0, earnings: 0 };
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    document.getElementById('expertEarnings').textContent = data.earnings.toLocaleString() + ' ‚≠ê';
    document.getElementById('expertStudents').textContent = data.students;
    document.getElementById('expertCoursesNum').textContent = data.courses.length;
    document.getElementById('quickMsgBadge').textContent = state.unreadMessages || 0;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫—É—Ä—Å–æ–≤
    const coursesList = document.getElementById('expertCoursesDashboard');
    
    if (data.courses.length === 0) {
        coursesList.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">üìö</div>
                <div class="empty-text">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫—É—Ä—Å–æ–≤</div>
                <button class="empty-btn" onclick="createNewCourse()">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –∫—É—Ä—Å</button>
            </div>
        `;
    } else {
        coursesList.innerHTML = data.courses.slice(0, 3).map(course => `
            <div class="expert-course-card" onclick="editCourse(${course.id})">
                <div class="expert-course-thumb">${course.icon || 'üìö'}</div>
                <div class="expert-course-info">
                    <div class="expert-course-title">${course.title}</div>
                    <div class="expert-course-meta">
                        <span>üë• ${course.students || 0}</span>
                        <span>üí∞ ${(course.earnings || 0).toLocaleString()} ‚≠ê</span>
                    </div>
                </div>
                <div class="expert-course-actions">
                    <button class="expert-course-btn share" onclick="event.stopPropagation(); shareCourse(${course.id})">üì§</button>
                </div>
            </div>
        `).join('');
    }
}

function updateExpertCourses() {
    const data = state.expertData || { courses: [] };
    const coursesList = document.getElementById('expertCoursesFullList');
    
    if (data.courses.length === 0) {
        coursesList.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">üìö</div>
                <div class="empty-text">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∫—É—Ä—Å</div>
            </div>
        `;
    } else {
        coursesList.innerHTML = data.courses.map(course => `
            <div class="expert-course-card" onclick="editCourse(${course.id})">
                <div class="expert-course-thumb">${course.icon || 'üìö'}</div>
                <div class="expert-course-info">
                    <div class="expert-course-title">${course.title}</div>
                    <div class="expert-course-meta">
                        <span>üë• ${course.students || 0}</span>
                        <span>‚≠ê ${course.rating || 0}</span>
                        <span>üí∞ ${(course.earnings || 0).toLocaleString()} ‚≠ê</span>
                    </div>
                </div>
                <div class="expert-course-actions">
                    <button class="expert-course-btn edit" onclick="event.stopPropagation(); editCourse(${course.id})">‚úèÔ∏è</button>
                    <button class="expert-course-btn share" onclick="event.stopPropagation(); shareCourse(${course.id})">üì§</button>
                </div>
            </div>
        `).join('');
    }
}

function updateExpertPromo() {
    const data = state.expertData || { promoCodes: [] };
    const promoList = document.getElementById('expertPromoList');
    
    if (data.promoCodes.length === 0) {
        promoList.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">üè∑Ô∏è</div>
                <div class="empty-text">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤</div>
            </div>
        `;
    } else {
        promoList.innerHTML = data.promoCodes.map((promo, index) => `
            <div class="promo-item">
                <div class="promo-code-text">${promo.code}</div>
                <div class="promo-item-info">
                    <div class="promo-item-discount">-${promo.discount}%</div>
                    <div class="promo-item-stats">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${promo.uses || 0}/${promo.limit || '‚àû'}</div>
                </div>
                <button class="promo-item-delete" onclick="deletePromo(${index})">üóëÔ∏è</button>
            </div>
        `).join('');
    }
}

function updateExpertAnalytics() {
    const data = state.expertData || { courses: [] };
    
    // –°–∏–º—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ - —Å —Å–µ—Ä–≤–µ—Ä–∞)
    document.getElementById('metricViews').textContent = Math.floor(Math.random() * 1000);
    document.getElementById('metricSales').textContent = Math.floor(Math.random() * 50);
    document.getElementById('metricConversion').textContent = (Math.random() * 15).toFixed(1) + '%';
    document.getElementById('metricRating').textContent = (4 + Math.random()).toFixed(1);
    
    // –¢–æ–ø –∫—É—Ä—Å—ã
    const topList = document.getElementById('topCoursesList');
    if (data.courses.length === 0) {
        topList.innerHTML = `<div class="empty-state small"><div class="empty-text">–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div></div>`;
    } else {
        topList.innerHTML = data.courses
            .sort((a, b) => (b.earnings || 0) - (a.earnings || 0))
            .slice(0, 3)
            .map((course, index) => `
                <div class="top-course-item">
                    <div class="top-course-rank ${index === 0 ? 'gold' : ''}">${index + 1}</div>
                    <div class="top-course-info">
                        <div class="top-course-title">${course.title}</div>
                        <div class="top-course-stats">üë• ${course.students || 0} —É—á–µ–Ω–∏–∫–æ–≤</div>
                    </div>
                    <div class="top-course-earnings">${(course.earnings || 0).toLocaleString()} ‚≠ê</div>
                </div>
            `).join('');
    }
}

function updateSubscriptionUIExpert() {
    const subCard = document.getElementById('expertSubCard');
    const subStatus = document.getElementById('expertSubStatus');
    
    if (!subCard || !subStatus) return;
    
    switch (state.subscription.status) {
        case 'trial':
            subCard.className = 'subscription-card trial';
            subStatus.textContent = `–ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥: ${state.subscription.daysLeft} –¥–Ω–µ–π`;
            break;
        case 'active':
            subCard.className = 'subscription-card active';
            subStatus.textContent = 'PRO –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞';
            break;
        case 'expired':
            subCard.className = 'subscription-card expired';
            subStatus.textContent = '–ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞';
            break;
    }
}

// ===== –î–ï–ô–°–¢–í–ò–Ø –≠–ö–°–ü–ï–†–¢–ê =====

function createNewCourse() {
    hapticFeedback('medium');
    
    const title = prompt('–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞:');
    if (!title || !title.trim()) return;
    
    const icons = ['üìö', 'üíª', 'üé®', 'üìä', 'üöÄ', 'üí°', 'üéØ', 'üîß'];
    const randomIcon = icons[Math.floor(Math.random() * icons.length)];
    
    if (!state.expertData) {
        state.expertData = { courses: [], students: 0, earnings: 0, promoCodes: [] };
    }
    
    const newCourse = {
        id: Date.now(),
        title: title.trim(),
        icon: randomIcon,
        price: 1990,
        students: 0,
        earnings: 0,
        rating: 0,
        lessons: [],
        createdAt: new Date().toISOString()
    };
    
    state.expertData.courses.push(newCourse);
    saveState();
    
    updateExpertDashboard();
    updateExpertCourses();
    
    showToast('‚úÖ', `–ö—É—Ä—Å "${title}" —Å–æ–∑–¥–∞–Ω!`);
}

function editCourse(courseId) {
    hapticFeedback('light');
    const course = state.expertData?.courses.find(c => c.id === courseId);
    if (course) {
        showToast('‚úèÔ∏è', `–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: ${course.title}`);
        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∫—É—Ä—Å–∞
    }
}

function shareCourse(courseId) {
    hapticFeedback('light');
    const link = `t.me/YourBot/app?startapp=course_${courseId}`;
    
    if (navigator.clipboard) {
        navigator.clipboard.writeText(link);
        showToast('üìã', '–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
    } else {
        showToast('üîó', link);
    }
}

function deletePromo(index) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥?')) {
        state.expertData.promoCodes.splice(index, 1);
        saveState();
        updateExpertPromo();
        showToast('üóëÔ∏è', '–ü—Ä–æ–º–æ–∫–æ–¥ —É–¥–∞–ª—ë–Ω');
    }
}

function showEarningsDetails() {
    showToast('üí∞', `–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: ${state.expertData?.earnings || 0} ‚≠ê`);
}

function showWithdrawModal() {
    showToast('üí∞', '–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
}

function updateAnalytics(period) {
    hapticFeedback('light');
    showToast('üìä', `–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∑–∞ ${period} –¥–Ω–µ–π`);
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
}

// –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
function createPromoCode() {
    const code = document.getElementById('promoCodeInput').value.toUpperCase();
    const limit = document.getElementById('promoLimitInput').value;
    
    if (!code) {
        showToast('‚ö†Ô∏è', '–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞');
        return;
    }
    
    if (!state.expertData) {
        state.expertData = { courses: [], students: 0, earnings: 0, promoCodes: [] };
    }
    
    state.expertData.promoCodes.push({
        code: code,
        discount: state.selectedDiscount,
        uses: 0,
        limit: limit ? parseInt(limit) : null,
        createdAt: new Date().toISOString()
    });
    
    document.getElementById('promoCodeInput').value = '';
    closeModal('promoModal');
    
    if (state.isExpertModeOpen) {
        updateExpertPromo();
    }
    
    saveState();
    showToast('‚úÖ', `–ü—Ä–æ–º–æ–∫–æ–¥ ${code} —Å–æ–∑–¥–∞–Ω!`);
}

// ===== –†–ï–î–ê–ö–¢–û–† –ö–£–†–°–ê =====

// –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
let editorState = {
    courseId: null,
    isNewCourse: true,
    currentLessonIndex: null,
    selectedIcon: 'üìö',
    selectedLevel: 'beginner',
    selectedAccessType: 'paid',
    selectedStatus: 'draft',
    selectedContentType: 'video',
    lessons: [],
    quizQuestions: []
};

// –û—Ç–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä
function openCourseEditor(courseId = null) {
    hapticFeedback('medium');
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä
    document.getElementById('courseEditorPage').classList.add('active');
    
    if (courseId) {
        // –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫—É—Ä—Å
        editorState.isNewCourse = false;
        editorState.courseId = courseId;
        loadCourseToEditor(courseId);
    } else {
        // –ù–æ–≤—ã–π –∫—É—Ä—Å
        editorState.isNewCourse = true;
        editorState.courseId = null;
        resetEditor();
    }
    
    // –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
    document.getElementById('mainNav').style.display = 'none';
    
    if (tg) tg.BackButton.show();
}

function closeCourseEditor() {
    hapticFeedback('light');
    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ —Ä–µ–∂–∏–º —ç–∫—Å–ø–µ—Ä—Ç–∞
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('expertModePage').classList.add('active');
    
    updateExpertDashboard();
    updateExpertCourses();
}

function resetEditor() {
    editorState = {
        courseId: null,
        isNewCourse: true,
        currentLessonIndex: null,
        selectedIcon: 'üìö',
        selectedLevel: 'beginner',
        selectedAccessType: 'paid',
        selectedStatus: 'draft',
        selectedContentType: 'video',
        lessons: [],
        quizQuestions: []
    };
    
    // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
    document.getElementById('courseTitle').value = '';
    document.getElementById('courseDescription').value = '';
    document.getElementById('courseCategory').value = '';
    document.getElementById('coursePrice').value = '';
    document.getElementById('courseOldPrice').value = '';
    document.getElementById('courseIconPreview').textContent = 'üìö';
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
    document.querySelectorAll('.level-option').forEach(el => el.classList.remove('selected'));
    document.querySelector('.level-option').classList.add('selected');
    
    document.querySelectorAll('.access-option').forEach(el => el.classList.remove('selected'));
    
    document.querySelectorAll('.status-option').forEach(el => el.classList.remove('selected'));
    document.querySelector('.status-option.draft').classList.add('selected');
    
    updatePricePreview();
    renderLessonsEditor();
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø–µ—Ä–≤—ã–π —Ç–∞–±
    switchEditorTab('info');
}

function loadCourseToEditor(courseId) {
    const course = state.expertData?.courses.find(c => c.id === courseId);
    if (!course) return;
    
    editorState.selectedIcon = course.icon || 'üìö';
    editorState.selectedLevel = course.level || 'beginner';
    editorState.selectedAccessType = course.price > 0 ? 'paid' : 'free';
    editorState.selectedStatus = course.status || 'draft';
    editorState.lessons = course.lessons || [];
    
    document.getElementById('courseTitle').value = course.title || '';
    document.getElementById('courseDescription').value = course.description || '';
    document.getElementById('courseCategory').value = course.category || '';
    document.getElementById('coursePrice').value = course.price || '';
    document.getElementById('courseOldPrice').value = course.oldPrice || '';
    document.getElementById('courseIconPreview').textContent = editorState.selectedIcon;
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É—Ä–æ–≤–µ–Ω—å
    document.querySelectorAll('.level-option').forEach(el => el.classList.remove('selected'));
    const levelIndex = { 'beginner': 0, 'intermediate': 1, 'advanced': 2 };
    document.querySelectorAll('.level-option')[levelIndex[editorState.selectedLevel]]?.classList.add('selected');
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–ø –¥–æ—Å—Ç—É–ø–∞
    document.querySelectorAll('.access-option').forEach(el => el.classList.remove('selected'));
    if (editorState.selectedAccessType === 'free') {
        document.querySelectorAll('.access-option')[1].classList.add('selected');
        document.getElementById('priceField').style.display = 'none';
        document.getElementById('oldPriceField').style.display = 'none';
    } else {
        document.querySelectorAll('.access-option')[0].classList.add('selected');
    }
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
    document.querySelectorAll('.status-option').forEach(el => el.classList.remove('selected'));
    if (editorState.selectedStatus === 'published') {
        document.querySelector('.status-option.published').classList.add('selected');
    } else {
        document.querySelector('.status-option.draft').classList.add('selected');
    }
    
    updatePricePreview();
    renderLessonsEditor();
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
function switchEditorTab(tab) {
    hapticFeedback('light');
    
    document.querySelectorAll('.editor-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.editor-tab-content').forEach(c => c.style.display = 'none');
    
    const tabIndex = { 'info': 0, 'lessons': 1, 'pricing': 2, 'settings': 3 };
    document.querySelectorAll('.editor-tab')[tabIndex[tab]]?.classList.add('active');
    
    const tabMap = {
        'info': 'editorInfoTab',
        'lessons': 'editorLessonsTab',
        'pricing': 'editorPricingTab',
        'settings': 'editorSettingsTab'
    };
    
    document.getElementById(tabMap[tab]).style.display = 'block';
}

// –í—ã–±–æ—Ä –∏–∫–æ–Ω–∫–∏
function showIconPicker() {
    hapticFeedback('light');
    document.getElementById('iconPickerModal').classList.add('active');
}

function selectCourseIcon(icon) {
    hapticFeedback('light');
    editorState.selectedIcon = icon;
    document.getElementById('courseIconPreview').textContent = icon;
    closeModal('iconPickerModal');
}

// –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è
function selectLevel(level, el) {
    hapticFeedback('light');
    editorState.selectedLevel = level;
    document.querySelectorAll('.level-option').forEach(o => o.classList.remove('selected'));
    el.classList.add('selected');
}

// –¢–∏–ø –¥–æ—Å—Ç—É–ø–∞
function selectAccessType(type, el) {
    hapticFeedback('light');
    editorState.selectedAccessType = type;
    document.querySelectorAll('.access-option').forEach(o => o.classList.remove('selected'));
    el.classList.add('selected');
    
    const priceFields = document.getElementById('priceField');
    const oldPriceFields = document.getElementById('oldPriceField');
    
    if (type === 'free') {
        priceFields.style.display = 'none';
        oldPriceFields.style.display = 'none';
        document.getElementById('coursePrice').value = 0;
    } else {
        priceFields.style.display = 'block';
        oldPriceFields.style.display = 'block';
    }
    
    updatePricePreview();
}

// –°—Ç–∞—Ç—É—Å
function selectStatus(status, el) {
    hapticFeedback('light');
    editorState.selectedStatus = status;
    document.querySelectorAll('.status-option').forEach(o => o.classList.remove('selected'));
    el.classList.add('selected');
}

// –ü—Ä–µ–≤—å—é —Ü–µ–Ω—ã
function updatePricePreview() {
    const price = document.getElementById('coursePrice').value || 0;
    const oldPrice = document.getElementById('courseOldPrice').value;
    
    document.getElementById('pricePreviewNew').textContent = 
        editorState.selectedAccessType === 'free' ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : `${price} ‚≠ê`;
    
    document.getElementById('pricePreviewOld').textContent = 
        oldPrice ? `${oldPrice} ‚≠ê` : '';
}

// –î–æ–±–∞–≤–∏—Ç—å —Å–ª—É—à–∞—Ç–µ–ª–∏ –Ω–∞ –ø–æ–ª—è —Ü–µ–Ω—ã
document.getElementById('coursePrice')?.addEventListener('input', updatePricePreview);
document.getElementById('courseOldPrice')?.addEventListener('input', updatePricePreview);

// ===== –£–†–û–ö–ò =====

function renderLessonsEditor() {
    const container = document.getElementById('lessonsEditorList');
    
    if (editorState.lessons.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">üìö</div>
                <div class="empty-text">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫</div>
            </div>
        `;
        return;
    }
    
    container.innerHTML = editorState.lessons.map((lesson, index) => `
        <div class="lesson-editor-item" onclick="editLesson(${index})">
            <div class="lesson-drag-handle">‚ãÆ‚ãÆ</div>
            <div class="lesson-editor-number">${index + 1}</div>
            <div class="lesson-editor-info">
                <div class="lesson-editor-title">${lesson.title}</div>
                <div class="lesson-editor-meta">
                    <span>${getContentTypeIcon(lesson.type)} ${getContentTypeName(lesson.type)}</span>
                    <span>‚è± ${lesson.duration || 0} –º–∏–Ω</span>
                </div>
            </div>
            <div class="lesson-editor-actions">
                <button class="lesson-action-btn delete" onclick="event.stopPropagation(); deleteLesson(${index})">üóëÔ∏è</button>
            </div>
        </div>
    `).join('');
}

function getContentTypeIcon(type) {
    return { 'video': 'üé¨', 'text': 'üìù', 'quiz': '‚ùì' }[type] || 'üìÑ';
}

function getContentTypeName(type) {
    return { 'video': '–í–∏–¥–µ–æ', 'text': '–¢–µ–∫—Å—Ç', 'quiz': '–¢–µ—Å—Ç' }[type] || '–ö–æ–Ω—Ç–µ–Ω—Ç';
}

function addLesson() {
    hapticFeedback('medium');
    editorState.currentLessonIndex = null;
    editorState.selectedContentType = 'video';
    editorState.quizQuestions = [];
    
    // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
    document.getElementById('lessonTitle').value = '';
    document.getElementById('lessonVideoUrl').value = '';
    document.getElementById('lessonTextContent').value = '';
    document.getElementById('lessonDuration').value = '';
    document.getElementById('lessonDescription').value = '';
    document.getElementById('lessonEditorTitle').textContent = 'üìö –ù–æ–≤—ã–π —É—Ä–æ–∫';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
    updateContentTypeFields();
    renderQuizQuestions();
    
    document.getElementById('lessonEditorModal').classList.add('active');
}

function editLesson(index) {
    hapticFeedback('light');
    
    const lesson = editorState.lessons[index];
    editorState.currentLessonIndex = index;
    editorState.selectedContentType = lesson.type || 'video';
    editorState.quizQuestions = lesson.quiz || [];
    
    document.getElementById('lessonTitle').value = lesson.title || '';
    document.getElementById('lessonVideoUrl').value = lesson.videoUrl || '';
    document.getElementById('lessonTextContent').value = lesson.textContent || '';
    document.getElementById('lessonDuration').value = lesson.duration || '';
    document.getElementById('lessonDescription').value = lesson.description || '';
    document.getElementById('lessonEditorTitle').textContent = '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É—Ä–æ–∫';
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    document.querySelectorAll('.content-type').forEach(el => el.classList.remove('selected'));
    const typeIndex = { 'video': 0, 'text': 1, 'quiz': 2 };
    document.querySelectorAll('.content-type')[typeIndex[editorState.selectedContentType]]?.classList.add('selected');
    
    updateContentTypeFields();
    renderQuizQuestions();
    
    document.getElementById('lessonEditorModal').classList.add('active');
}

function deleteLesson(index) {
    hapticFeedback('medium');
    
    if (confirm('–£–¥–∞–ª–∏—Ç—å —É—Ä–æ–∫?')) {
        editorState.lessons.splice(index, 1);
        renderLessonsEditor();
        showToast('üóëÔ∏è', '–£—Ä–æ–∫ —É–¥–∞–ª—ë–Ω');
    }
}

function selectContentType(type, el) {
    hapticFeedback('light');
    editorState.selectedContentType = type;
    document.querySelectorAll('.content-type').forEach(o => o.classList.remove('selected'));
    el.classList.add('selected');
    updateContentTypeFields();
}

function updateContentTypeFields() {
    document.getElementById('videoUrlField').style.display = 
        editorState.selectedContentType === 'video' ? 'block' : 'none';
    document.getElementById('textContentField').style.display = 
        editorState.selectedContentType === 'text' ? 'block' : 'none';
    document.getElementById('quizEditorField').style.display = 
        editorState.selectedContentType === 'quiz' ? 'block' : 'none';
}

function saveLesson() {
    const title = document.getElementById('lessonTitle').value.trim();
    
    if (!title) {
        showToast('‚ö†Ô∏è', '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞');
        return;
    }
    
    hapticFeedback('success');
    
    const lessonData = {
        title: title,
        type: editorState.selectedContentType,
        videoUrl: document.getElementById('lessonVideoUrl').value,
        textContent: document.getElementById('lessonTextContent').value,
        quiz: editorState.quizQuestions,
        duration: parseInt(document.getElementById('lessonDuration').value) || 10,
        description: document.getElementById('lessonDescription').value
    };
    
    if (editorState.currentLessonIndex !== null) {
        editorState.lessons[editorState.currentLessonIndex] = lessonData;
    } else {
        editorState.lessons.push(lessonData);
    }
    
    closeModal('lessonEditorModal');
    renderLessonsEditor();
    showToast('‚úÖ', '–£—Ä–æ–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
}

// ===== –¢–ï–°–¢ =====

function renderQuizQuestions() {
    const container = document.getElementById('quizQuestionsList');
    
    if (editorState.quizQuestions.length === 0) {
        container.innerHTML = '';
        return;
    }
    
    container.innerHTML = editorState.quizQuestions.map((q, qIndex) => `
        <div class="quiz-question-item">
            <div class="quiz-question-header">
                <span class="quiz-question-number">–í–æ–ø—Ä–æ—Å ${qIndex + 1}</span>
                <button class="quiz-question-delete" onclick="deleteQuizQuestion(${qIndex})">üóëÔ∏è</button>
            </div>
            <input type="text" class="quiz-question-input" 
                value="${q.question}" 
                placeholder="–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞"
                onchange="updateQuizQuestion(${qIndex}, 'question', this.value)">
            <div class="quiz-options-list">
                ${q.options.map((opt, oIndex) => `
                    <div class="quiz-option-row">
                        <input type="text" class="quiz-option-input" 
                            value="${opt}"
                            placeholder="–í–∞—Ä–∏–∞–Ω—Ç ${oIndex + 1}"
                            onchange="updateQuizOption(${qIndex}, ${oIndex}, this.value)">
                        <button class="quiz-correct-btn ${q.correct === oIndex ? 'selected' : ''}" 
                            onclick="setCorrectAnswer(${qIndex}, ${oIndex})">‚úì</button>
                    </div>
                `).join('')}
            </div>
        </div>
    `).join('');
}

function addQuizQuestion() {
    hapticFeedback('light');
    
    editorState.quizQuestions.push({
        question: '',
        options: ['', '', '', ''],
        correct: 0
    });
    
    renderQuizQuestions();
}

function deleteQuizQuestion(index) {
    editorState.quizQuestions.splice(index, 1);
    renderQuizQuestions();
}

function updateQuizQuestion(qIndex, field, value) {
    editorState.quizQuestions[qIndex][field] = value;
}

function updateQuizOption(qIndex, oIndex, value) {
    editorState.quizQuestions[qIndex].options[oIndex] = value;
}

function setCorrectAnswer(qIndex, oIndex) {
    hapticFeedback('light');
    editorState.quizQuestions[qIndex].correct = oIndex;
    renderQuizQuestions();
}

// ===== –°–û–•–†–ê–ù–ï–ù–ò–ï –ö–£–†–°–ê =====

function saveCourse() {
    const title = document.getElementById('courseTitle').value.trim();
    
    if (!title) {
        showToast('‚ö†Ô∏è', '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞');
        switchEditorTab('info');
        return;
    }
    
    hapticFeedback('success');
    
    const courseData = {
        id: editorState.courseId || Date.now(),
        title: title,
        description: document.getElementById('courseDescription').value,
        category: document.getElementById('courseCategory').value,
        icon: editorState.selectedIcon,
        level: editorState.selectedLevel,
        price: editorState.selectedAccessType === 'free' ? 0 : 
            (parseInt(document.getElementById('coursePrice').value) || 0),
        oldPrice: parseInt(document.getElementById('courseOldPrice').value) || null,
        status: editorState.selectedStatus,
        certificate: document.getElementById('courseCertificate').checked,
        comments: document.getElementById('courseComments').checked,
        preview: document.getElementById('coursePreview').checked,
        lessons: editorState.lessons,
        students: 0,
        earnings: 0,
        rating: 0,
        createdAt: editorState.isNewCourse ? new Date().toISOString() : undefined,
        updatedAt: new Date().toISOString()
    };
    
    if (!state.expertData) {
        state.expertData = { courses: [], students: 0, earnings: 0, promoCodes: [] };
    }
    
    if (editorState.isNewCourse) {
        state.expertData.courses.push(courseData);
    } else {
        const index = state.expertData.courses.findIndex(c => c.id === editorState.courseId);
        if (index !== -1) {
            courseData.students = state.expertData.courses[index].students;
            courseData.earnings = state.expertData.courses[index].earnings;
            courseData.rating = state.expertData.courses[index].rating;
            courseData.createdAt = state.expertData.courses[index].createdAt;
            state.expertData.courses[index] = courseData;
        }
    }
    
    saveState();
    
    showToast('‚úÖ', editorState.isNewCourse ? '–ö—É—Ä—Å —Å–æ–∑–¥–∞–Ω!' : '–ö—É—Ä—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
    closeCourseEditor();
}

function deleteCourse() {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;
    
    hapticFeedback('heavy');
    
    if (editorState.courseId) {
        const index = state.expertData.courses.findIndex(c => c.id === editorState.courseId);
        if (index !== -1) {
            state.expertData.courses.splice(index, 1);
            saveState();
        }
    }
    
    showToast('üóëÔ∏è', '–ö—É—Ä—Å —É–¥–∞–ª—ë–Ω');
    closeCourseEditor();
}

// –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫—É—Ä—Å–∞
function editCourse(courseId) {
    openCourseEditor(courseId);
}

// –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Å–æ–∑–¥–∞–Ω–∏—è –∫—É—Ä—Å–∞
function createNewCourse() {
    openCourseEditor(null);
}

// ===== –°–í–ê–ô–ü –î–õ–Ø –ó–ê–ö–†–´–¢–ò–Ø –ú–û–î–ê–õ–û–ö =====
function initModalSwipe() {
    document.querySelectorAll('.modal-content').forEach(content => {
        const dragZone = content.querySelector('.modal-drag-zone');
        if (!dragZone) return;
        
        let startY = 0;
        let currentY = 0;
        let isDragging = false;
        
        dragZone.addEventListener('touchstart', (e) => {
            startY = e.touches[0].clientY;
            isDragging = true;
            content.style.transition = 'none';
        }, { passive: true });
        
        dragZone.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            
            currentY = e.touches[0].clientY;
            const deltaY = currentY - startY;
            
            if (deltaY > 0) {
                content.style.transform = `translateY(${deltaY}px)`;
                
                // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –Ω–∞ –ø–æ–ª–æ—Å–∫–µ
                const handle = dragZone.querySelector('.modal-drag-handle');
                if (handle) {
                    handle.style.width = Math.min(56, 48 + deltaY / 10) + 'px';
                    handle.style.background = `rgba(0, 0, 0, ${0.2 + deltaY / 500})`;
                }
            }
        }, { passive: true });
        
        dragZone.addEventListener('touchend', () => {
            if (!isDragging) return;
            
            const deltaY = currentY - startY;
            content.style.transition = 'transform 0.3s cubic-bezier(0.32, 0.72, 0, 1)';
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ª–æ—Å–∫—É
            const handle = dragZone.querySelector('.modal-drag-handle');
            if (handle) {
                handle.style.width = '';
                handle.style.background = '';
            }
            
            if (deltaY > 120) {
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
                const modal = content.closest('.modal');
                if (modal) {
                    hapticFeedback('light');
                    content.style.transform = 'translateY(100%)';
                    setTimeout(() => {
                        modal.classList.remove('active');
                        content.style.transform = '';
                        content.style.transition = '';
                    }, 300);
                }
            } else {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ –º–µ—Å—Ç–æ
                content.style.transform = '';
            }
            
            isDragging = false;
            startY = 0;
            currentY = 0;
        }, { passive: true });
    });
}

// –í—ã–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
document.addEventListener('DOMContentLoaded', () => {
    setTimeout(initModalSwipe, 500);
});

// ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–õ–ê–í–ò–ê–¢–£–†–û–ô =====

// –°–∫—Ä—ã—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
function hideKeyboard() {
    document.activeElement.blur();
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è iOS
    const inputs = document.querySelectorAll('input, textarea');
    inputs.forEach(input => input.blur());
}

// –°–∫—Ä—ã—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –ø–æ–ª—è –≤–≤–æ–¥–∞
document.addEventListener('touchstart', (e) => {
    if (!e.target.matches('input, textarea')) {
        // –ï—Å–ª–∏ –∫–ª–∏–∫ –Ω–µ –ø–æ –ø–æ–ª—é –≤–≤–æ–¥–∞, —Å–∫—Ä—ã–≤–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
        if (document.activeElement.matches('input, textarea')) {
            // –ù–µ —Å–∫—Ä—ã–≤–∞–µ–º —Å—Ä–∞–∑—É, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–≤–∞–π–ø
        }
    }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ì–æ—Ç–æ–≤–æ" –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ
document.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.target.matches('textarea')) {
        e.preventDefault();
        hideKeyboard();
    }
});

// –°–∫—Ä–æ–ª–ª–∏–º –∫ –ø–æ–ª—é –≤–≤–æ–¥–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ (–¥–ª—è iOS)
document.querySelectorAll('input, textarea').forEach(input => {
    input.addEventListener('focus', () => {
        setTimeout(() => {
            input.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 300);
    });
});
</script>

</body>
</html>
